#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run lint-staged (formats and lints staged files)
pnpm lint-staged

# Run secret scan on staged files
echo "üîç Scanning for secrets..."
node tests/security/secret-scan.cjs

# Validate agent security standards if agent files are modified
AGENT_FILES_CHANGED=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.cursor/agents/.*\.md$' || true)
if [ -n "$AGENT_FILES_CHANGED" ]; then
  echo "üîç Validating agent security standards..."
  if command -v python3 >/dev/null 2>&1; then
    python3 .cursor/scripts/validate_agent_security.py --all --strict || {
      echo "‚ùå Agent security validation failed"
      echo "   Fix the issues above before committing"
      exit 1
    }
  else
    echo "‚ö†Ô∏è  Python3 not found, skipping agent validation"
  fi
fi

