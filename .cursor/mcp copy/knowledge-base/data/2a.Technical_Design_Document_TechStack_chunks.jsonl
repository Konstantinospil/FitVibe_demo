{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_000", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "﻿---\ntitle: \"FitVibe Technical Design Document (TDD): Tech Stack\"\nversion: \"v2.0\"\nstatus: \"Accepted\"\nowner: \"Konstantinos Pilpilidis (Dr.)\"\ndate: \"2025-10-21\"\nlinks:\n  - PRD: docs/1.Product_Requirements_Document.md\n  - QA: docs/3.Testing_and_Quality_Assurance_Plan.md\n  - ADR Index: docs/adr/README.md\nlicense: \"MIT\"\n---\n\n# 0. Introduction\n\n## 0.1 Purpose & Scope\n\nThis TDD specifies **how** the FitVibe system will implement the features and constraints defined in the [PRD](.\\1.Product_Requirements_Document.md) (WHAT/WHY) and satisfy the [QA Plan](4.%20Testing_and_Quality_Assurance_Plan.md) (HOW WELL).\n\n## 0.2 Audience & Reading Guide\n\n- **Engineers** implement according to specs, contracts, and runbooks.\n- **QA** uses RTM links to derive tests and quality gates.\n- **Security/Compliance** verifies controls, data classification, GDPR flows.\n- **Product/Design** confirms that behavior matches PRD intent.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 0, "token_count": 228, "hash_short": "0d781e91", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_001", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "**QA** uses RTM links to derive tests and quality gates.\n- **Security/Compliance** verifies controls, data classification, GDPR flows.\n- **Product/Design** confirms that behavior matches PRD intent.\n\n## 0.3 Assumptions & Constraints\n\n- Monorepo with **pnpm** workspaces; Node.js 20 LTS; React 18; PostgreSQL ≥ 14 (target 16-18 locally).\n- All external calls (email) are **adapterized** and mockable for tests.\n- Privacy-by-design: **private-by-default** content, explicit consent for public sharing.\n- Deployments run behind **TLS** with reverse proxy (NGINX) and **Let's Encrypt** certificates.\n\n## 0.4 Versioning & Changelog\n\n- **Change policy:** Any change to interfaces, schema, or security controls must update TDD and the related ADR, and link into QA RTM.\n\n---\n\n# 1. Traceability & Scope Mapping\n\nThis section provides a **mini RTM** that maps PRD **FR/NFR** - **TDD sections** (where the design lives) - **QA** acceptance and gates (where it is verified).", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 1, "token_count": 240, "hash_short": "b8b9ad64", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_002", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "---\n\n# 1. Traceability & Scope Mapping\n\nThis section provides a **mini RTM** that maps PRD **FR/NFR** - **TDD sections** (where the design lives) - **QA** acceptance and gates (where it is verified). The full RTM remains in the QA Plan; this table ensures the TDD is self-contained.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 2, "token_count": 70, "hash_short": "ea2ba93b", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_003", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "ps PRD **FR/NFR** - **TDD sections** (where the design lives) - **QA** acceptance and gates (where it is verified). The full RTM remains in the QA Plan; this table ensures the TDD is self-contained.\n\n## 1.1 Mini RTM (FR focus)\n\n| PRD FR | Summary              | TDD Sections (design anchors)                             | QA References (tests/gates)                        |\n| ------ | -------------------- | --------------------------------------------------------- | -------------------------------------------------- |\n| FR-1   | Auth & Authorization | §3 (standards), §4.1 (modules), §5.1 (security), §7 (API) | Login/Reg/Verify, 2FA, lockout, brute-force limits |\n| FR-2   | Users & Profiles     | §4.2, §6 (schema), §7 (API)                               | Profile CRUD, alias uniqueness, privacy defaults   |\n| FR-3   | Exercise Library     | §4.3, §6 (schema & indexing), §7 (API)                    | Owner/global admin library, search/perf            |\n| FR-4   | Planning & Sessions  | §4.4, §6 (relations), §7                                  | Create/plan/log, recurrence, idempotency           |\n| FR-5   | Progress & Analytics | §4.5, §6 (views/matlzd), §7                               | Aggregations accuracy/perf budgets                 |\n| FR-6   | Points & Badges      | §4.6, §6, §7                                              | Deterministic rules, anti-cheat                    |\n| FR-7   | Feed & Sharing       | §4.7, §5.1/§5.2, §7                                       | Privacy-by-default, link sharing                   |\n| FR-8   | i18n (static MVP)    | §4.8, §3.5, §5.5                                          | Locale switch, fallback, token coverage            |", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 3, "token_count": 424, "hash_short": "c0d0d155", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_004", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "Privacy-by-default, link sharing                   |\n| FR-8   | i18n (static MVP)    | §4.8, §3.5, §5.5                                          | Locale switch, fallback, token coverage            |\n\n\n## 1.2 Mini RTM (NFR focus)\n\n| NFR           | Target                                      | Design Anchor                      | QA Gate                                 |\n| ------------- | ------------------------------------------- | ---------------------------------- | --------------------------------------- |\n| Performance   | API p95 < 300 ms; LCP < 2.5 s               | §5.3 perf, §6 indexes, §2 topology | k6 thresholds; Lighthouse budget        |\n| Security      | RS256 JWT, refresh rotation, CSRF, CSP/HSTS | §5.1                               | ZAP/OWASP checks; headers verified      |\n| Privacy/GDPR  | DSR export/delete; log redaction            | §5.2; §12 runbooks (later)         | DSR E2E tests; retention checks         |\n| Observability | Logs, metrics, tracing                      | §5.4                               | Prometheus alerts, sampling/cardinality |\n| Accessibility | WCAG 2.1 AA                                 | §5.5                               | Automated checks (CI)                   |\n| Reliability   | Backups; RPO≤24h, RTO≤4h                    | §9 (later), §12 (runbooks later)   | DR drill scripts                        |", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 4, "token_count": 343, "hash_short": "c63fd814", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_005", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "| Automated checks (CI)                   |\n| Reliability   | Backups; RPO≤24h, RTO≤4h                    | §9 (later), §12 (runbooks later)   | DR drill scripts                        |\n\n\n## 1.3 In/Out of Scope (MVP)\n\n- **In:**\n  - static i18n;\n  - basic media upload with AV scan;\n  - RBAC roles (user/admin);\n  - email delivery;\n  - feed with privacy controls;\n  - social interactions (likes, bookmarks, comments);\n  - follow/unfollow;\n  - leaderboards (points weekly/monthly).\n- **Out:**\n  - dynamic AI translation;\n  - wearable sync;\n  - nutrition;\n  - heavy real-time comments;\n  - org/multi-tenant features.\n\n---\n\n# 2. System Architecture\n\n## 2.1 Context Diagram\n\nThe [Context Diagramm](./diagrams/tdd-2-1-context-diagram.mmd) can be found in the diagrams.\n\n**Rationale:**\n\n- Reverse proxy terminates TLS and enforces security headers.\n- Stateless BE with JWT; DB as single write authority.\n- Observability collects logs/metrics/traces; no PII in labels or logs.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 5, "token_count": 242, "hash_short": "ba5a3281", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_006", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "onale:**\n\n- Reverse proxy terminates TLS and enforces security headers.\n- Stateless BE with JWT; DB as single write authority.\n- Observability collects logs/metrics/traces; no PII in labels or logs.\n\n## 2.2 Container / Runtime View\n\nThe [Container / Runtime Diagram](.\\diagrams\\tdd-2-2-container-runtime-view.mmd) can be found in the documentation.\n\n**Key responsibilities**\n\n- **NGINX:** TLS, rate-limiting at edge, CSP/HSTS, gzip/brotli.\n- **API:** REST, RBAC, validation, idempotency, audit logging.\n- **Worker:** async tasks (email, cleanup, aggregation), scheduled with cron-like triggers.\n- **DB:** normalized schema; partitions for large tables; materialized views for analytics.\n\n## 2.3 Deployment Topology & Environments\n\n- **Local:** Docker Compose (API, DB, NGINX, MailHog), seeded demo data.\n- **Staging:** Same composition; points to staging SMTP; feature flags enabled for preview.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 6, "token_count": 223, "hash_short": "ee3ee088", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_007", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "eployment Topology & Environments\n\n- **Local:** Docker Compose (API, DB, NGINX, MailHog), seeded demo data.\n- **Staging:** Same composition; points to staging SMTP; feature flags enabled for preview.\n- **Production:** NGINX at edge with TLS; API behind private network; managed or self-hosted PostgreSQL with automated backups; Prometheus/Grafana/Loki stack.\n\n**Ports & ingress**\n\n- 443 (HTTPS) at edge; 80 only for ACME challenge; internal service ports not exposed publicly.\n  **Certificates** via Let's Encrypt (auto-renew).\n\n## 2.4 Principal Data Flows\n\n- **Auth:** Email verification → Login (access + refresh) → Refresh rotation & revoke on use.\n- **Sessions:** Client submits planned/actual session; server validates DTO → writes transactional rowset; idempotency key avoids duplicates.\n- **Media Upload:** Client → API → AV scan → object stored (disk or S3-compatible) → metadata row; reject on malware.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 7, "token_count": 227, "hash_short": "34b145ec", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_008", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "r validates DTO → writes transactional rowset; idempotency key avoids duplicates.\n- **Media Upload:** Client → API → AV scan → object stored (disk or S3-compatible) → metadata row; reject on malware.\n- **Telemetry:** Structured logs and metrics emitted; correlation IDs propagate across layers.\n\n---\n\n# 3. Technology\n\nThe technology stack is summarized in the Table.\nThe high-level architecture is illustrated in [High Level Architecture](.\\diagrams\\prd-high-level-architecture.mmd).\n\nThis section describes the technology choices that underpin **FitVibe's architecture**.\nIt is divided into four subsections for clarity and separation of concerns:\n\n1. **Backend Technology** - Application runtime, frameworks, libraries, and server-side logic.\n2. **Frontend Technology** - User interface stack, styling, and accessibility libraries.\n3. **Data Technology** - Database engine, schema design, and persistence tooling.\n4. **Infrastructure Technology** - Deployment, CI/CD, monitoring, and scaling.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 8, "token_count": 248, "hash_short": "9dfb0732", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_009", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "styling, and accessibility libraries.\n3. **Data Technology** - Database engine, schema design, and persistence tooling.\n4. **Infrastructure Technology** - Deployment, CI/CD, monitoring, and scaling.\n\nThe objective is to define a **developer-ready technology baseline**, ensuring consistency across the stack, maintainability, and scalability.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 9, "token_count": 85, "hash_short": "6751c8f8", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_010", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "nology** - Deployment, CI/CD, monitoring, and scaling.\n\nThe objective is to define a **developer-ready technology baseline**, ensuring consistency across the stack, maintainability, and scalability.\n\n## 3.1 Technology → Purpose Map (canonical)\n\n### Technology Stack (Master Table)\n\n| Category                          | Technologies & Details                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |\n| --------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| **Frontend (Runtime & UI)**       | - **React 18 + Vite** (SPA shell, fast dev/prod builds)<br>- **React Router DOM** (client routing)<br>- **Axios** with interceptor (`401 → /auth/refresh`)<br>- **State Management**: Zustand (lightweight) or Redux (global orchestration); optional React Query for caching & background refetch<br>- **TailwindCSS** (design system, theming tokens)<br>- **Recharts** (charts for dashboards)<br>- **Lucide React** (icons)<br>- **Accessibility**: WCAG 2.1 AA, ARIA, keyboard navigation<br>- **Internationalization (future)**: EN/DE tokens |\n| **Backend (Runtime & Framework)** | - **Node.js 20 LTS + Express** with modular routers (`auth`, `users`, `exercises`, `sessions`, `progress`, `points`, `feed`)<br>- **Knex.js** for SQL queries, migrations, seeds<br>- **bcryptjs** for password hashing<br>- **jsonwebtoken (RS256)** for short-lived access tokens<br>- **Refresh tokens**: server-stored, rotated by `jti`, revocable on logout<br>- Optional **TOTP 2FA** with backup codes                                                                                                                                      |\n| **Authentication & Security**     | - **Helmet** for HTTP headers<br>- **CORS allowlist** (env-configured)<br>- **express-rate-limit** (per-IP & per-account throttling, optional CAPTCHA)<br>- **CSRF protection** middleware<br>- **httpOnly Secure cookies** for refresh/session<br>- **compression** for gzip responses                                                                                                                                                                                                                                                             |\n| **Validation & Config**           | - **zod** for request DTO and environment schema validation<br>- **dotenv** for environment variables<br>- Strict schema enforcement (`NODE_ENV`, `DATABASE_URL`, `JWT_PRIVATE_KEY`, etc.)                                                                                                                                                                                                                                                                                                                                                          |\n| **Database & Persistence**        | - **PostgreSQL 18** (primary relational datastore)<br>- **Knex.js** migrations (`YYYYMMDDHHMM__*.ts`)<br>- Constraints & indexes (e.g., `lower(username)`, partial indexes, FK cascades)<br>- Soft deletes (`deleted_at`, `archived_at`)<br>- **Backups**: daily encrypted, RPO ≤ 24h, RTO ≤ 4h<br>- **Retention policies** per entity, optional anonymization for analytics                                                                                                                                                                        |\n| **File & Media Storage**          | - Local `/uploads` in dev<br>- Cloud storage (**AWS S3 / GCS**) in production<br>- Excluded from Git/Docker<br>- Optional virus scanning hook<br>- Future: avatar uploads, media constraints (JPEG/PNG/WebP ≤ 5 MB)                                                                                                                                                                                                                                                                                                                                 |\n| **Email & Notifications**         | - Provider-agnostic mailer abstraction (**SMTP, SES, SendGrid, etc.**)<br>- Used for verification, password reset<br>- Backlog: unified notification system (email + push)                                                                                                                                                                                                                                                                                                                                                                          |\n| **Background Jobs & Caching**     | - **Redis** (or LRU fallback in dev) for caching + rate-limit counters (Phase 2+)<br>- **BullMQ / Temporal.io** for async jobs (emails, reports, recalculations, imports)<br>- Retry handling for transient failures with exponential backoff                                                                                                                                                                                                                                                                                                       |\n| **Testing Framework**             | **Jest + ts-jest** - unit and integration testing framework for backend and shared packages", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 10, "token_count": 1532, "hash_short": "7a0ab5e6", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_011", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "|\n| **Testing Framework**             | **Jest + ts-jest** - unit and integration testing framework for backend and shared packages. Optional Cypress/Playwright for E2E in staging.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 11, "token_count": 45, "hash_short": "885408bf", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_012", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "|\n| **Logging & Monitoring**          | - **pino** or **winston** for structured logs<br>- **morgan** for HTTP request logs<br>- Correlation/request IDs propagated FE→BE<br>- GDPR-compliant (exclude PII)<br>- **Metrics dashboards** (latency p95/p99, auth failures, DB saturation)<br>- **Alerting** on 5xx spikes, auth failures<br>- Tracing enabled                                                                                                                                                                                                                                 |\n| **Infrastructure & DevOps**       | - **NGINX** reverse proxy (static assets, HTTPS redirect, HSTS)<br>- **Certbot (Let's Encrypt)** TLS automation & renewal<br>- **Docker / Docker Compose** (multi-stage builds, reproducible dev/prod)<br>- **GitHub Actions CI**: checkout → install (pnpm) → lint → test → build → Docker push (GHCR)<br>- **GitHub Actions CD**: manual approval → SSH deploy → `docker compose up -d`                                                                                                                                                           |\n| **Environments**                  | - **Local (dev):** hot reload, verbose logs, seeded demo data<br>- **Staging (optional):** mirrors prod, pre-release validation<br>- **Production:** optimized builds, strict CORS, reduced logs, monitoring enabled                                                                                                                                                                                                                                                                                                                                |\n| **Build & Release**               | - **Versioning:** `/api/v1` base path with deprecation policy<br>- **Artifacts:** Docker images tagged with commit SHA + semver<br>- **Rollback:** compose retains last good image<br>- **Static assets:** frontend built assets served by NGINX with cache headers                                                                                                                                                                                                                                                                                 |\n| **Data Protection & Privacy**     | - **GDPR compliance**: DSR endpoints (export/delete), privacy notice, minimization<br>- **Cookies:** httpOnly, Secure, SameSite=Lax<br>- Upload scanning optional, user-controlled data management                                                                                                                                                                                                                                                                                                                                                  |\n| **Monorepo Tooling**              | - **pnpm workspaces** for dependency mgmt<br>- **turbo** (optional) for task caching & parallelism<br>- **ESLint & Prettier** configs at root<br>- **TypeScript** base config (`tsconfig.base.json`)                                                                                                                                                                                                                                                                                                                                                |\n\n---", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 12, "token_count": 859, "hash_short": "55555438", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_013", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "|\n\n---\n\n\n## 3.2 Rationale\n\n- **DevSecOps Tools**: **Snyk**, **Trivy/Grype**: Chosen to provide continuous dependency and container vulnerability scanning. Their integration into CI/CD ensures rapid detection of security risks in the supply chain and image builds, reducing the chance of deploying vulnerable components.\n- **Secrets Management**: **Vault/AWS Secrets Manager**: Centralized secrets storage and rotation improves operational security and auditability. These systems eliminate plaintext secrets from repositories or CI environments and provide fine-grained access control with traceability.\n- **Database Performance**:\n  - **pg_stat_statements**: Enables continuous query performance monitoring directly within PostgreSQL.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 13, "token_count": 183, "hash_short": "6c19ad2e", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_014", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "ronments and provide fine-grained access control with traceability.\n- **Database Performance**:\n  - **pg_stat_statements**: Enables continuous query performance monitoring directly within PostgreSQL. This supports evidence-based tuning and early detection of inefficient queries.\n  - **GIN/JSONB**: Selected to accelerate searches in tag arrays and semi-structured data fields without compromising schema normalization.\n  - **Table partitioning**: Ensures scalable query performance for time-series data such as user sessions and history logs by minimizing index bloat and query scope.\n- **Transport Security**:\n  - **TLS 1.3 + OCSP Stapling**: Adopted for best-in-class transport security, forward secrecy, and certificate validity verification at the edge.\n  - Strict **Content Security Policy (CSP)** at edge: Mitigates cross-site scripting and data injection risks by controlling allowed origins and resource types in client browsers.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 14, "token_count": 234, "hash_short": "15b369fd", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_015", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "cation at the edge.\n  - Strict **Content Security Policy (CSP)** at edge: Mitigates cross-site scripting and data injection risks by controlling allowed origins and resource types in client browsers.\n- **Node.js 20 + Express**: Chosen for maturity, wide ecosystem support, and straightforward modularization. Express offers fine-grained control, which is preferable over heavier frameworks for a project emphasizing separation of concerns.\n- **Knex.js over full ORM**: Provides SQL flexibility and performance without ORM abstraction overhead. It ensures maintainability via migrations and seeds while keeping developers close to SQL.\n- **PostgreSQL 18**: Selected for its robustness, JSONB support (for flexible fields), and strong community support. The latest version ensures long-term support.\n- **JWT + refresh rotation**: Access tokens remain short-lived (≤15 min) to minimize compromise risk.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 15, "token_count": 224, "hash_short": "c095c4b7", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_016", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "for flexible fields), and strong community support. The latest version ensures long-term support.\n- **JWT + refresh rotation**: Access tokens remain short-lived (≤15 min) to minimize compromise risk. Refresh tokens are stored server-side, rotated on each use, and revocable per `jti` to guard against theft.\n- **bcryptjs**: A widely adopted password hashing algorithm with proven resilience against brute-force attacks.\n- **TOTP 2FA**: Enhances account security with optional strong second-factor authentication.\n- **zod**: Ensures runtime validation for API inputs and environment variables, reducing runtime errors and misconfigurations.\n- **pino/winston + morgan**: Enable structured logs, traceability, and operational visibility. Logging is GDPR-aware (no PII storage).\n- **Mailer abstraction**: Keeps email logic independent of provider (SMTP, AWS SES, SendGrid), allowing flexible deployments.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 16, "token_count": 225, "hash_short": "685c142d", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_017", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "lity, and operational visibility. Logging is GDPR-aware (no PII storage).\n- **Mailer abstraction**: Keeps email logic independent of provider (SMTP, AWS SES, SendGrid), allowing flexible deployments.\n- **File storage abstraction**: Development uses local storage; production uses cloud object stores (S3/GCS). This separation ensures scalability without complicating dev workflows.\n- **Redis + BullMQ/Temporal (backlog)**: Provide caching and asynchronous job execution.\n- **Supporting libs**: cors, express-rate-limit, compression, uuid, and date/time utilities are battle-tested solutions for common API needs.\n\n---\n\n## 3.3 Frontend Stack\n\n- **App shell & routing:** React + React Router DOM.\n- **State & data:** Zustand/Redux; optional React Query for caching and background refetch.\n- **HTTP:** Axios instance with interceptors (attach access token; handle 401 → refresh).\n- **Styling:** TailwindCSS; component primitives (Navbar, Card, Button, AvatarUpload, Chart) per styling guide.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 17, "token_count": 247, "hash_short": "e4f79ac3", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_018", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "**HTTP:** Axios instance with interceptors (attach access token; handle 401 → refresh).\n- **Styling:** TailwindCSS; component primitives (Navbar, Card, Button, AvatarUpload, Chart) per styling guide.\n- **Charts:** Recharts (line/area, circular progress).\n- **Accessibility:** WCAG 2.1 AA; semantic HTML; ARIA labels; keyboard navigation.\n- **Internationalization (placeholder):** prepare for EN/DE labels (tokens-based).\n- **Performance Enhancements:**\n  - Code-splitting and lazy loading (`React.lazy`, `Suspense`) mandatory for all feature routes.\n  - Critical CSS inlined in `index.html`; other styles loaded asynchronously.\n  - Service worker for static asset caching (PWA baseline).\n  - Use `react-query` for caching of idempotent GETs (feed, progress).\n  - Lighthouse CI integrated into build; budgets enforced.\n  - HTTP cache headers: `immutable, max-age=31536000` for static bundles; API ETags enabled.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 18, "token_count": 227, "hash_short": "d881c78b", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_019", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "r caching of idempotent GETs (feed, progress).\n  - Lighthouse CI integrated into build; budgets enforced.\n  - HTTP cache headers: `immutable, max-age=31536000` for static bundles; API ETags enabled.\n\n---\n\n## 3.4 Backend Stack\n\n- **API:** Express with modular routers per domain (auth, users, exercises, sessions, progress, points, feed).\n- **Security:** Helmet, CORS allowlist, rate limiting, CSRF protection, httpOnly `Secure` cookies.\n- **Auth:** JWT (short-lived access) + **server-stored refresh** tokens with rotation and revocation by `jti`; optional TOTP 2FA with backup codes.\n- **Data access:** Knex query builder; connection pooling; migrations & seeds.\n- **Storage:** Local `/uploads` (dev) and pluggable S3/GCS provider (prod) via abstraction; uploads excluded from VCS and Docker build.\n- **Email:** Verification/reset via provider-agnostic mailer (SMTP/SES/etc.).\n- **Logging:** Structured logs (pino/winston) with correlation IDs; `morgan` for access logs.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 19, "token_count": 242, "hash_short": "38641bc6", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_020", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "from VCS and Docker build.\n- **Email:** Verification/reset via provider-agnostic mailer (SMTP/SES/etc.).\n- **Logging:** Structured logs (pino/winston) with correlation IDs; `morgan` for access logs.\n- **Validation:** zod schemas for request DTOs and environment config.\n- **Background jobs (future):** BullMQ/Temporal for async tasks (emails, reports, imports).\n- **System utilities:** The system shall expose a `GET /health` endpoint for container health-checks and uptime monitoring. It shall return HTTP 200 OK with a JSON payload `{ status: 'ok', timestamp: <ISO8601> }`.\n- **Performance Enhancements:**\n  - Express compression (Brotli/gzip > 1 KB).\n  - Global response size cap = 1 MB.\n  - Route-level rate limiting with `X-RateLimit-*` headers.\n  - Request timeout middleware (10 s).\n  - Async translation and analytics jobs queued via BullMQ when runtime > 800 ms.\n  - Cached endpoints (`GET /feed`, `GET /progress/*`) backed by Redis (or LRU fallback in dev) with 60 s TTL.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 20, "token_count": 245, "hash_short": "6a96a188", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_021", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "0 s).\n  - Async translation and analytics jobs queued via BullMQ when runtime > 800 ms.\n  - Cached endpoints (`GET /feed`, `GET /progress/*`) backed by Redis (or LRU fallback in dev) with 60 s TTL.\n  - Performance middleware exporting per-route latency metrics to Prometheus.\n- **Vault / AWS Secrets Manager:** Handles all sensitive configuration and credentials in production. Chosen for its integration with major cloud providers, secret rotation, and audit logging capabilities. This ensures compliance with least-privilege principles and GDPR data minimization.\n- **Snyk / Trivy / Grype:** Implemented in the CI/CD pipeline to automatically detect vulnerable dependencies and container images. This supports the project's \"security-first\" objective by embedding checks early in development.\n- **pg_stat_statements & Monitoring Stack:** Used to gather query performance metrics, enabling data-driven database optimization and early anomaly detection.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 21, "token_count": 238, "hash_short": "ee07c30c", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_022", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "y embedding checks early in development.\n- **pg_stat_statements & Monitoring Stack:** Used to gather query performance metrics, enabling data-driven database optimization and early anomaly detection.\n- **GIN / JSONB Indexing:** Provides the flexibility to store and query semi-structured data (e.g., tags, attributes) efficiently. Chosen to support future AI-driven search features.\n- **Partitioned Tables:** Keeps database operations efficient as data grows by isolating recent records for faster access and simplifying archival.\n- **Loki + Grafana Integration:** Added for structured log aggregation and visualization, ensuring unified observability across backend, frontend, and infrastructure layers.\n- **Redis + BullMQ/Temporal:** Optional components planned for phase 2 to handle caching, job queues, and background task orchestration, ensuring scalable asynchronous operations.\n\n## 3.5 Languages, Frameworks, Versions\n\n- **Frontend:** TypeScript, React 18, Vite, React Router, i18n library.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 22, "token_count": 249, "hash_short": "cd746899", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_023", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "queues, and background task orchestration, ensuring scalable asynchronous operations.\n\n## 3.5 Languages, Frameworks, Versions\n\n- **Frontend:** TypeScript, React 18, Vite, React Router, i18n library.\n- **Backend:** Node.js 20 LTS, TypeScript, Express, zod (validation), jose (JWT), nodemailer (email), rate-limiter-flexible.\n- **Database:** PostgreSQL (target 16-18; minimum 14), pg, knex (migrations).\n- **Infra/Dev:** Docker, Docker Compose, GitHub Actions, pnpm workspaces, Husky, ESLint/Prettier, Playwright, Jest, k6, Lighthouse, ZAP.\n- **Observability:** Prometheus, Grafana, OpenTelemetry (traces), Loki (logs) or structured JSON logs to filebeat-compatible sink.\n\n## 3.6 Coding Standards\n\n- **TypeScript strict mode**; no `any` in public surfaces.\n- ESLint (recommended + security plugins), Prettier formatting.\n- Folder-by-module for BE (`/modules/<domain>`), co-locating routes, services, schemas, tests.\n- FE feature-sliced architecture; UI components accessible by default (labels/ARIA)", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 23, "token_count": 249, "hash_short": "5fe38b43", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_024", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "Prettier formatting.\n- Folder-by-module for BE (`/modules/<domain>`), co-locating routes, services, schemas, tests.\n- FE feature-sliced architecture; UI components accessible by default (labels/ARIA).\n\n## 3.7 API Style & Conventions\n\n- **REST over HTTPS**, JSON bodies, camelCase in JSON, snake_case in DB.\n- **Pagination:** `?page, ?limit` (default 20, max 100), response `{data, meta: {page, limit, total}}`.\n- **Filtering/Sorting:** explicit allow-list; server rejects unknown filters.\n- **Error Envelope:**\n  ```json\n  { \"error\": { \"code\": \"E.AUTH.INVALID_CREDENTIALS\", \"message\": \"string\", \"details\": {...}, \"requestId\": \"uuid\" } }\n  ```\n- **Idempotency:** Clients may send `Idempotency-Key` header for POST/PATCH on session creation, password reset, feed actions; server persists and deduplicates for 24h.\n- **Rate Limits:** Per IP and per account; stricter on auth endpoints; `Retry-After` on limit breach.\n\n## 3.8 API Versioning & Deprecation Policy\n\n- Base path **`/api/v1`**.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 24, "token_count": 246, "hash_short": "19822b96", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_025", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "and deduplicates for 24h.\n- **Rate Limits:** Per IP and per account; stricter on auth endpoints; `Retry-After` on limit breach.\n\n## 3.8 API Versioning & Deprecation Policy\n\n- Base path **`/api/v1`**.\n- **Additive changes only** (new optional fields) within a major version.\n- Breaking changes demand **new major** (e.g., `/api/v2`) with **2-release deprecation window** for the old version.\n- Deprecations announced via `Deprecation` response header and release notes.\n\n## 3.9 Time, IDs, Locale & Units\n\n- **Time:** All server-side timestamps in **UTC**, RFC 3339; clients display in user's locale.\n- **IDs:** ULIDs or UUIDv7 for time-sortable identifiers; no sequential IDs exposed.\n- **Locale/i18n:** MVP ships **static tokens (EN/DE)**; `Accept-Language` and user settings negotiate locale; fallback to EN; dates/numbers formatted per locale on the client (server provides ISO values + hints where applicable).", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 25, "token_count": 228, "hash_short": "bebf4d7b", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_026", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "*static tokens (EN/DE)**; `Accept-Language` and user settings negotiate locale; fallback to EN; dates/numbers formatted per locale on the client (server provides ISO values + hints where applicable).\n- **Units:** Distances in meters/kilometers; weights in kilograms; durations in seconds; FE renders with locale-specific units/symbols.\n- **i18n scope (MVP):** Only **static token catalogs (EN/DE)** are in scope.\n\n## 3.10 Security & Privacy Baselines (Cross-reference)\n\n- **JWT RS256** with refresh rotation and revocation; CSRF mitigated via same-site cookies (if used) + double-submit pattern for web; strict headers: **CSP**, **HSTS**, **Referrer-Policy**, **Permissions-Policy**.\n- **Secrets management**: env schema validation at boot; rotation procedure via JWKS; no secrets in logs or client bundles.\n- **Uploads:** AV scanning (e.g., clamd) before persistence; size/type allow-list.\n- **Logs/Metrics:** PII never logged; metric label cardinality limited; correlation IDs required.", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 26, "token_count": 247, "hash_short": "d6e0dd4f", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack_chunk_027", "doc_id": ".._.._docs_2.Technical_Design_Document_2a.Technical_Design_Document_TechStack", "text": "r client bundles.\n- **Uploads:** AV scanning (e.g., clamd) before persistence; size/type allow-list.\n- **Logs/Metrics:** PII never logged; metric label cardinality limited; correlation IDs required.\n\n---\n\n- See also [Modules](./2b.Technical_Design_Document_Modules.md)\n- See also [Data](./2c.Technical_Design_Document_Data.md)\n- See also [Design & Architecture](./2d.Technical_Design_Document_APIDesign.md)\n- See also [Other](./2e.Technical_Design_Document_misc.md)", "source_file": "../../docs/2.Technical_Design_Document/2a.Technical_Design_Document_TechStack.md", "category": "technical", "chunk_index": 27, "token_count": 116, "hash_short": "f15b986c", "version": 1.0, "title": "0. Introduction", "mtime": "2025-10-24T18:57:42.626214", "ingested_at": "2025-11-30T04:00:42.014652", "tags": ["technical", "md"]}
