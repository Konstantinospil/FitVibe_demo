{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_000", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "# NGINX Security Configuration Guide\n\n**Version:** 1.0\n**Last Updated:** 2025-11-11\n**Owner:** DevOps & Security Team\n\nThis document provides the canonical NGINX configuration for FitVibe, including security headers, TLS settings, OCSP stapling, and edge protection controls.\n\n---\n\n\n## Table of Contents\n\n- [Overview](#overview)\n- [TLS Configuration](#tls-configuration)\n- [Security Headers](#security-headers)\n- [Rate Limiting](#rate-limiting)\n- [OCSP Stapling](#ocsp-stapling)\n- [Complete Configuration Example](#complete-configuration-example)\n- [Verification](#verification)\n- [Troubleshooting](#troubleshooting)\n\n---\n\n## Overview\n\nFitVibe uses NGINX as a reverse proxy and edge layer to:\n\n1. Terminate TLS 1.3 connections with modern cipher suites\n2. Apply defense-in-depth security headers (CSP, HSTS, etc.)\n3. Rate-limit and throttle abusive clients\n4. Enable OCSP stapling for certificate validation\n5. Compress and cache static assets\n6.", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 0, "token_count": 236, "hash_short": "36702159", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_001", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "uites\n2. Apply defense-in-depth security headers (CSP, HSTS, etc.)\n3. Rate-limit and throttle abusive clients\n4. Enable OCSP stapling for certificate validation\n5. Compress and cache static assets\n6.", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 1, "token_count": 49, "hash_short": "d7a40214", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_002", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "Route requests to the backend application server\n\n**Architecture:**\n\n```\nInternet → Cloudflare/CDN → NGINX (TLS termination + headers) → Backend (Node.js/Express)\n```\n\n---\n\n## TLS Configuration\n\n### Minimum Requirements\n\n- **Protocol:** TLS 1.3 only (TLS 1.2 fallback permitted with strict ciphers)\n- **Certificate:** Let's Encrypt or commercial CA with automatic renewal\n- **Key Size:** RSA 2048-bit minimum; ECDSA P-256 preferred\n- **HSTS:** Enabled with `max-age=31536000; includeSubDomains; preload`\n\n### NGINX TLS Block\n\n```nginx\n# TLS 1.3 with TLS 1.2 fallback\nssl_protocols TLSv1.2 TLSv1.3;\nssl_prefer_server_ciphers off;\n\n# Modern cipher suite (TLS 1.2 + 1.3)\nssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';\n\n# SSL session settings\nssl_session_cache shared:SSL:10m;\nssl_session_timeout 1d;\nssl_session_tickets off;", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 2, "token_count": 253, "hash_short": "88bb6c0d", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_003", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "0-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';\n\n# SSL session settings\nssl_session_cache shared:SSL:10m;\nssl_session_timeout 1d;\nssl_session_tickets off;\n\n\n# Certificate paths\nssl_certificate /etc/letsencrypt/live/api.fitvibe.app/fullchain.pem;\nssl_certificate_key /etc/letsencrypt/live/api.fitvibe.app/privkey.pem;\nssl_trusted_certificate /etc/letsencrypt/live/api.fitvibe.app/chain.pem;\n\n# Diffie-Hellman parameters (2048-bit minimum)\nssl_dhparam /etc/nginx/dhparam.pem;\n```\n\n### Certificate Renewal\n\nCertificates are automatically renewed via `certbot`:\n\n```bash\n# Install certbot\napt-get install certbot python3-certbot-nginx\n\n# Obtain certificate\ncertbot --nginx -d api.fitvibe.app -d staging.fitvibe.app\n\n# Automatic renewal (systemd timer)\nsystemctl enable certbot.timer\nsystemctl start certbot.timer\n\n# Test renewal\ncertbot renew --dry-run\n```\n\n---\n\n## Security Headers\n\n### Content Security Policy (CSP)\n\n**Production CSP:**\n\n```nginx\nadd_header Content-Security-Policy \"default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self' https://api.fitvibe.app; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;\" always;\n```\n\n**Key Directives:**\n\n- `default-src 'self'` — Only allow resources from same origin\n- `script-src 'self'` — Block inline scripts and eval()\n- `style-src 'self' 'unsafe-inline'` — Allow inline styles (required for some libraries)\n- `img-src 'self' data: https:` — Images from self, data URIs, and HTTPS sources\n- `connect-src 'self' https://api.fitvibe.app` — API calls to backend only\n- `frame-ancestors 'none'` — Prevent clickjacking\n- `upgrade-insecure-requests` — Auto-upgrade HTTP to HTTPS", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 3, "token_count": 446, "hash_short": "42a19fb8", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_004", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "d HTTPS sources\n- `connect-src 'self' https://api.fitvibe.app` — API calls to backend only\n- `frame-ancestors 'none'` — Prevent clickjacking\n- `upgrade-insecure-requests` — Auto-upgrade HTTP to HTTPS\n\n\n### HTTP Strict Transport Security (HSTS)\n\n```nginx\nadd_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\" always;\n```\n\n**Configuration:**\n\n- `max-age=31536000` — 1 year duration\n- `includeSubDomains` — Apply to all subdomains\n- `preload` — Eligible for HSTS preload list\n\n**Preload List Submission:**\n\nSubmit to https://hstspreload.org/ after verifying:\n\n1. Valid HTTPS certificate\n2. HTTPS redirect from HTTP (301)\n3. HSTS header on base domain\n\n### X-Frame-Options\n\n```nginx\nadd_header X-Frame-Options \"DENY\" always;\n```\n\nPrevents the site from being embedded in `<iframe>`, `<frame>`, or `<object>` tags.\n\n### X-Content-Type-Options\n\n```nginx\nadd_header X-Content-Type-Options \"nosniff\" always;\n```\n\nPrevents MIME-type sniffing attacks.", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 4, "token_count": 242, "hash_short": "29da4148", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_005", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "from being embedded in `<iframe>`, `<frame>`, or `<object>` tags.\n\n### X-Content-Type-Options\n\n```nginx\nadd_header X-Content-Type-Options \"nosniff\" always;\n```\n\nPrevents MIME-type sniffing attacks.\n\n### Referrer-Policy\n\n```nginx\nadd_header Referrer-Policy \"strict-origin-when-cross-origin\" always;\n```\n\nSends full referrer for same-origin, origin only for HTTPS→HTTPS, nothing for HTTPS→HTTP.\n\n### Permissions-Policy\n\n```nginx\nadd_header Permissions-Policy \"geolocation=(), microphone=(), camera=(), payment=()\" always;\n```\n\nDisables sensitive browser features by default.", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 5, "token_count": 143, "hash_short": "2ed9f082", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_006", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "ng for HTTPS→HTTP.\n\n### Permissions-Policy\n\n```nginx\nadd_header Permissions-Policy \"geolocation=(), microphone=(), camera=(), payment=()\" always;\n```\n\nDisables sensitive browser features by default.", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 6, "token_count": 49, "hash_short": "39a603f8", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_007", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "### Complete Header Block\n\n```nginx\n# Security Headers\nadd_header X-Frame-Options \"DENY\" always;\nadd_header X-Content-Type-Options \"nosniff\" always;\nadd_header X-XSS-Protection \"1; mode=block\" always;\nadd_header Referrer-Policy \"strict-origin-when-cross-origin\" always;\nadd_header Permissions-Policy \"geolocation=(), microphone=(), camera=(), payment=()\" always;\nadd_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\" always;\nadd_header Content-Security-Policy \"default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self' https://api.fitvibe.app; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;\" always;\n```\n\n---\n\n## Rate Limiting\n\n### Global Rate Limits\n\n```nginx\n# Define rate limit zones (10MB memory = ~160k IPs)\nlimit_req_zone $binary_remote_addr zone=global:10m rate=120r/m;\nlimit_req_zone $binary_remote_addr zone=auth:10m rate=10r/m;\nlimit_req_zone $binary_remote_addr zone=api:10m rate=60r/m;", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 7, "token_count": 262, "hash_short": "2c7ce244", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_008", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "y = ~160k IPs)\nlimit_req_zone $binary_remote_addr zone=global:10m rate=120r/m;\nlimit_req_zone $binary_remote_addr zone=auth:10m rate=10r/m;\nlimit_req_zone $binary_remote_addr zone=api:10m rate=60r/m;\n\n\n# Apply to location blocks\nlocation / {\n    limit_req zone=global burst=20 nodelay;\n    proxy_pass http://backend;\n}\n\nlocation ~ ^/api/v1/auth/(login|register|refresh) {\n    limit_req zone=auth burst=5 nodelay;\n    proxy_pass http://backend;\n}\n\nlocation /api/ {\n    limit_req zone=api burst=10 nodelay;\n    proxy_pass http://backend;\n}\n```\n\n**Configuration:**\n\n- `global` zone: 120 requests/minute (2 req/sec) with burst of 20\n- `auth` zone: 10 requests/minute for auth endpoints with burst of 5\n- `api` zone: 60 requests/minute for general API with burst of 10\n\n### Connection Limits\n\n```nginx\n# Limit connections per IP\nlimit_conn_zone $binary_remote_addr zone=conn_limit:10m;\n\nlocation / {\n    limit_conn conn_limit 10;\n}\n```\n\n---\n\n## OCSP Stapling\n\nOCSP (Online Certificate Status Protocol) stapling allows NGINX to cache certificate revocation status and serve it to clients, reducing TLS handshake latency", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 8, "token_count": 278, "hash_short": "63ebe1b4", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_009", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "n_limit 10;\n}\n```\n\n---\n\n## OCSP Stapling\n\nOCSP (Online Certificate Status Protocol) stapling allows NGINX to cache certificate revocation status and serve it to clients, reducing TLS handshake latency.", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 9, "token_count": 50, "hash_short": "7c9177a0", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_010", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "imit 10;\n}\n```\n\n---\n\n## OCSP Stapling\n\nOCSP (Online Certificate Status Protocol) stapling allows NGINX to cache certificate revocation status and serve it to clients, reducing TLS handshake latency.\n\n### Configuration\n\n```nginx\n# Enable OCSP stapling\nssl_stapling on;\nssl_stapling_verify on;\n\n# Trusted certificate for verification\nssl_trusted_certificate /etc/letsencrypt/live/api.fitvibe.app/chain.pem;\n\n# DNS resolver (Google Public DNS)\nresolver 8.8.8.8 8.8.4.4 valid=300s;\nresolver_timeout 5s;\n```\n\n### Verification\n\nTest OCSP stapling:\n\n```bash\necho | openssl s_client -connect api.fitvibe.app:443 -status -servername api.fitvibe.app 2>&1 | grep \"OCSP Response Status\"\n```\n\nExpected output:\n\n```\nOCSP Response Status: successful (0x0)\n```\n\n---\n\n## Complete Configuration Example\n\n### `/etc/nginx/sites-available/fitvibe-api`\n\n```nginx\n# Upstream backend servers\nupstream backend {\n    server 127.0.0.1:4000;\n    keepalive 32;\n}\n\n# Rate limit zones\nlimit_req_zone $binary_remote_addr zone=global:10m rate=120r/m;\nlimit_req_zone $binary_remote_addr zone=auth:10m rate=10r/m;\nlimit_req_zone $binary_remote_addr zone=api:10m rate=60r/m;\nlimit_conn_zone $binary_remote_addr zone=conn_limit:10m;", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 10, "token_count": 298, "hash_short": "a82b8bcb", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_011", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "obal:10m rate=120r/m;\nlimit_req_zone $binary_remote_addr zone=auth:10m rate=10r/m;\nlimit_req_zone $binary_remote_addr zone=api:10m rate=60r/m;\nlimit_conn_zone $binary_remote_addr zone=conn_limit:10m;\n\n\n# HTTP → HTTPS redirect\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name api.fitvibe.app;\n\n    # ACME challenge for Let's Encrypt\n    location /.well-known/acme-challenge/ {\n        root /var/www/certbot;\n    }\n\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\n# HTTPS server\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name api.fitvibe.app;\n\n    # TLS configuration\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers off;\n    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';\n\n    ssl_certificate /etc/letsencrypt/live/api.fitvibe.app/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/api.fitvibe.app/privkey.pem;\n    ssl_trusted_certificate /etc/letsencrypt/live/api.fitvibe.app/chain.pem;\n\n    ssl_session_cache shared:SSL:10m;\n    ssl_session_timeout 1d;\n    ssl_session_tickets off;\n    ssl_dhparam /etc/nginx/dhparam.pem;\n\n    # OCSP stapling\n    ssl_stapling on;\n    ssl_stapling_verify on;\n    resolver 8.8.8.8 8.8.4.4 valid=300s;\n    resolver_timeout 5s;\n\n    # Security headers\n    add_header X-Frame-Options \"DENY\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n    add_header Referrer-Policy \"strict-origin-when-cross-origin\" always;\n    add_header Permissions-Policy \"geolocation=(), microphone=(), camera=(), payment=()\" always;\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\" always;\n    add_header Content-Security-Policy \"default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self' https://api.fitvibe.app; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;\" always;\n\n    # Logging\n    access_log /var/log/nginx/fitvibe-api-access.log combined;\n    error_log /var/log/nginx/fitvibe-api-error.log warn;\n\n    # Connection limits\n    limit_conn conn_limit 10;\n\n    # Health check (bypass rate limiting)\n    location = /health {\n        access_log off;\n        proxy_pass http://backend;\n        proxy_http_version 1.1;\n        proxy_set_header Connection \"\";\n    }\n\n    # Metrics endpoint (restrict to internal monitoring)\n    location = /metrics {\n        access_log off;\n        allow 10.0.0.0/8;      # Internal network\n        allow 172.16.0.0/12;   # Docker networks\n        deny all;\n        proxy_pass http://backend;\n        proxy_http_version 1.1;\n        proxy_set_header Connection \"\";\n    }\n\n    # Auth endpoints (strict rate limiting)\n    location ~ ^/api/v1/auth/(login|register|refresh|verify|password) {\n        limit_req zone=auth burst=5 nodelay;\n\n        proxy_pass http://backend;\n        proxy_http_version 1.1;\n        proxy_set_header Connection \"\";\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header X-Request-Id $request_id;\n\n        # Timeouts\n        proxy_connect_timeout 5s;\n        proxy_send_timeout 10s;\n        proxy_read_timeout 10s;\n    }\n\n    # General API endpoints\n    location /api/ {\n        limit_req zone=api burst=10 nodelay;\n\n        proxy_pass http://backend;\n        proxy_http_version 1.1;\n        proxy_set_header Connection \"\";\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header X-Request-Id $request_id;\n\n        # Timeouts\n        proxy_connect_timeout 5s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n\n    # Static files (if serving from NGINX)\n    location /static/ {\n        alias /var/www/fitvibe/static/;\n        expires 1y;\n        add_header Cache-Control \"public, immutable\";\n        access_log off;\n    }\n\n    # Deny access to hidden files\n    location ~ /\\", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 11, "token_count": 1109, "hash_short": "6f0b00d9", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_012", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "/ {\n        alias /var/www/fitvibe/static/;\n        expires 1y;\n        add_header Cache-Control \"public, immutable\";\n        access_log off;\n    }\n\n    # Deny access to hidden files\n    location ~ /\\. {\n        deny all;\n        access_log off;\n        log_not_found off;\n    }\n}\n```\n\n---\n\n## Verification\n\n### Test Configuration\n\n```bash\n# Test NGINX configuration syntax\nnginx -t\n\n# Reload NGINX\nsystemctl reload nginx\n```\n\n### Security Headers Check\n\n```bash\n# Check all security headers\ncurl -I https://api.fitvibe.app\n\n# Expected headers:\n\n# Strict-Transport-Security: max-age=31536000; includeSubDomains; preload\n\n# Content-Security-Policy: default-src 'self'; ...", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 12, "token_count": 167, "hash_short": "ea0dd767", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_013", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "l security headers\ncurl -I https://api.fitvibe.app\n\n# Expected headers:\n\n# Strict-Transport-Security: max-age=31536000; includeSubDomains; preload\n\n# Content-Security-Policy: default-src 'self'; ...\n\n# X-Frame-Options: DENY\n\n# X-Content-Type-Options: nosniff\n\n# Referrer-Policy: strict-origin-when-cross-origin\n```\n\n\n### SSL Labs Test\n\nTest TLS configuration at: https://www.ssllabs.com/ssltest/\n\n**Target Grade:** A+ with the following:\n\n- TLS 1.3 support\n- Forward secrecy\n- HSTS enabled\n- No weak ciphers\n\n### Security Headers Check\n\nUse https://securityheaders.com/ to verify all headers are correctly set.\n\n**Target Grade:** A+\n\n---\n\n## Troubleshooting\n\n### Issue: OCSP Stapling Not Working\n\n**Symptoms:**\n\n```bash\necho | openssl s_client -connect api.fitvibe.app:443 -status\n# Shows: OCSP response: no response sent\n```\n\n**Solutions:**\n\n1. Check resolver configuration:\n\n   ```nginx\n   resolver 8.8.8.8 8.8.4.4 valid=300s;\n   ```\n\n2.", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 13, "token_count": 234, "hash_short": "c5c46a48", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_014", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "ent -connect api.fitvibe.app:443 -status\n# Shows: OCSP response: no response sent\n```\n\n**Solutions:**\n\n1. Check resolver configuration:\n\n   ```nginx\n   resolver 8.8.8.8 8.8.4.4 valid=300s;\n   ```\n\n2. Verify certificate chain is complete:\n\n   ```bash\n   openssl verify -CAfile /etc/letsencrypt/live/api.fitvibe.app/chain.pem \\\n                  /etc/letsencrypt/live/api.fitvibe.app/cert.pem\n   ```\n\n3. Check NGINX error logs:\n   ```bash\n   tail -f /var/log/nginx/error.log | grep -i ocsp\n   ```\n\n### Issue: Rate Limiting Too Aggressive\n\n**Symptoms:** Legitimate users getting 429 Too Many Requests\n\n**Solutions:**\n\n1. Increase burst size:\n\n   ```nginx\n   limit_req zone=api burst=20 nodelay;  # Increase from 10 to 20\n   ```\n\n2.", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 14, "token_count": 182, "hash_short": "f23f95c0", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_015", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "essive\n\n**Symptoms:** Legitimate users getting 429 Too Many Requests\n\n**Solutions:**\n\n1. Increase burst size:\n\n   ```nginx\n   limit_req zone=api burst=20 nodelay;  # Increase from 10 to 20\n   ```\n\n2. Whitelist trusted IPs:\n\n   ```nginx\n   geo $limit {\n       default 1;\n       10.0.0.0/8 0;      # Internal network\n       1.2.3.4 0;         # Monitoring service\n   }\n\n   map $limit $limit_key {\n       0 \"\";\n       1 $binary_remote_addr;\n   }\n\n   limit_req_zone $limit_key zone=api:10m rate=60r/m;\n   ```\n\n### Issue: CSP Blocking Required Resources\n\n**Symptoms:** Browser console shows CSP violations\n\n**Solutions:**\n\n1. Add specific origins to CSP directives:\n\n   ```nginx\n   add_header Content-Security-Policy \"default-src 'self'; script-src 'self' https://trusted-cdn.com; ...\" always;\n   ```\n\n2. Use CSP report-only mode during testing:\n\n   ```nginx\n   add_header Content-Security-Policy-Report-Only \"...\" always;\n   ```\n\n3.", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 15, "token_count": 232, "hash_short": "8f185660", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
{"chunk_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration_chunk_016", "doc_id": ".._.._docs_5.Policies_5.a.Ops_NGINX_Security_Configuration", "text": "f'; script-src 'self' https://trusted-cdn.com; ...\" always;\n   ```\n\n2. Use CSP report-only mode during testing:\n\n   ```nginx\n   add_header Content-Security-Policy-Report-Only \"...\" always;\n   ```\n\n3. Implement CSP reporting endpoint to monitor violations\n\n---\n\n## References\n\n- [NGINX Security Headers](https://nginx.org/en/docs/http/ngx_http_headers_module.html)\n- [Mozilla SSL Configuration Generator](https://ssl-config.mozilla.org/)\n- [OWASP Secure Headers Project](https://owasp.org/www-project-secure-headers/)\n- [Content Security Policy Reference](https://content-security-policy.com/)\n- [HSTS Preload List](https://hstspreload.org/)", "source_file": "../../docs/5.Policies/5.a.Ops/NGINX_Security_Configuration.md", "category": "policies", "chunk_index": 16, "token_count": 160, "hash_short": "2667a1a0", "version": 1.0, "title": "NGINX Security Configuration Guide", "mtime": "2025-11-15T07:01:39.660041", "ingested_at": "2025-11-30T04:00:44.007236", "tags": ["policies", "md"]}
