{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure_chunk_000", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure", "text": "# ADR-012: Monorepo Structure, Tooling, and Governance\n\n**Date:** 2025-10-14  \n**Status:** Accepted  \n**Author:** Reviewer  \n**Cross-References:** PRD §7 Engineering Standards; TDD §0–§2 (stack & repo); QA §2–§9 (CI pipeline gates)\n\n---\n\n\n## Context\n\nWe maintain a single codebase that hosts backend, frontend, shared libraries, infra code, and test harnesses. The PRD and TDD establish **pnpm workspaces** as the standard, with optional **Turborepo** for task orchestration and caching, and **Docker Compose** for local orchestration. QA requires CI stages (lint → typecheck → unit/integration/E2E), coverage reporting, performance/a11y/security gates, and artifactized Docker images.\n\nThe decision must optimize for: fast local dev, reproducible CI, cacheable builds, clear boundaries, and auditability (CODEOWNERS, changesets, and release notes).\n\n---\n\n## Decision\n\n1.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-012-monorepo-structure.md", "category": "technical", "chunk_index": 0, "token_count": 217, "hash_short": "2f795399", "version": 1.0, "title": "ADR-012: Monorepo Structure, Tooling, and Governance", "mtime": "2025-10-18T10:54:49.913035", "ingested_at": "2025-11-30T04:00:44.114038", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure_chunk_001", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure", "text": "ocker images.\n\nThe decision must optimize for: fast local dev, reproducible CI, cacheable builds, clear boundaries, and auditability (CODEOWNERS, changesets, and release notes).\n\n---\n\n## Decision\n\n1. **Repository Layout (top-level)**\n\n```\nfitvibe/\n├─ apps/\n│  ├─ backend/            # Node.js (Express) API\n│  └─ frontend/           # React + Vite SPA\n├─ packages/\n│  ├─ shared/             # TS utilities, domain types, API SDK\n│  └─ i18n/               # token catalogs and tooling\n├─ tests/                 # e2e (Playwright), perf (k6), security configs\n├─ infra/                 # docker-compose, k8s manifests (if any), scripts\n├─ .github/               # workflows, CODEOWNERS, issue templates\n└─ docs/                  # ADR index, architecture diagrams\n```\n\n2. **Package Management & Orchestration**\n\n- **pnpm workspaces** with `link-workspace-packages=true` and `shared-workspace-lockfile=true`.\n- **Turborepo** optional but recommended for pipeline caching (`turbo run build --filter=...`)", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-012-monorepo-structure.md", "category": "technical", "chunk_index": 1, "token_count": 250, "hash_short": "d4c49c9b", "version": 1.0, "title": "ADR-012: Monorepo Structure, Tooling, and Governance", "mtime": "2025-10-18T10:54:49.913035", "ingested_at": "2025-11-30T04:00:44.114038", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure_chunk_002", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure", "text": "ration**\n\n- **pnpm workspaces** with `link-workspace-packages=true` and `shared-workspace-lockfile=true`.\n- **Turborepo** optional but recommended for pipeline caching (`turbo run build --filter=...`).\n- Enforce Node/PNPM versions via `.nvmrc` and `packageManager` field.\n\n3. **TypeScript Project References**\n\n- Each app/package is a TS project with references to enable incremental builds (`tsc -b`).\n- Disallow cross-layer imports that bypass public APIs via ESLint boundaries.\n\n4. **Build & Run**\n\n- Local: `docker compose up` provides Postgres, Redis, mailhog, and object storage (e.g., MinIO).\n- Apps can run outside Docker during dev, but **CI builds Docker images** using deterministic multi-stage Dockerfiles.\n\n5. **Governance**\n\n- **CODEOWNERS** per directory; **conventional commits**; **changesets** for versioning of published packages.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-012-monorepo-structure.md", "category": "technical", "chunk_index": 2, "token_count": 212, "hash_short": "c2181a31", "version": 1.0, "title": "ADR-012: Monorepo Structure, Tooling, and Governance", "mtime": "2025-10-18T10:54:49.913035", "ingested_at": "2025-11-30T04:00:44.114038", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure_chunk_003", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure", "text": "builds Docker images** using deterministic multi-stage Dockerfiles.\n\n5. **Governance**\n\n- **CODEOWNERS** per directory; **conventional commits**; **changesets** for versioning of published packages.\n- **Feature flags** centralized in `packages/shared/flags.ts`; defaults set by env and validated in CI (e.g., `FEATURE_UGC_AI_TRANSLATION=false` in prod).\n- ADR index maintained under `docs/` with bidirectional links to PRD/TDD sections.\n\n6. **Environment & Secrets**\n\n- Non-production secrets managed via `.env.example` and GitHub Environments; production via secrets manager (referenced by CI).\n- No secrets in repo; CI blocks on secret scanning hits.\n\n7. **Caching & Artifacts**\n\n- Turbo/pnpm cache in CI; Docker layer caching for images; test and coverage artifacts uploaded per job.\n- Reproducible builds pinned by lockfile; CI fails on lockfile drift.\n\n8.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-012-monorepo-structure.md", "category": "technical", "chunk_index": 3, "token_count": 215, "hash_short": "141bc291", "version": 1.0, "title": "ADR-012: Monorepo Structure, Tooling, and Governance", "mtime": "2025-10-18T10:54:49.913035", "ingested_at": "2025-11-30T04:00:44.114038", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure_chunk_004", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure", "text": "ching & Artifacts**\n\n- Turbo/pnpm cache in CI; Docker layer caching for images; test and coverage artifacts uploaded per job.\n- Reproducible builds pinned by lockfile; CI fails on lockfile drift.\n\n8. **Testing & CI Pipeline (summary)**\n\n- **lint** → **typecheck** → **unit** (vitest/jest) → **integration** (ephemeral DB) → **e2e** (Playwright) → **coverage upload** (Codecov) → **lighthouse** (CI) → **security scan** (deps + ZAP baseline) → **docker build & GHCR push** → **perf k6 smoke** with budgets → **policy gates**.\n- Budgets: API p95 < 300 ms; LCP < 2.5 s; CI fails on >10% perf regression.\n\n9. **Release & Deployment**\n\n- Backend/frontend images pushed to **GHCR** with semver tags; SBOM and provenance (SLSA generator) attached.\n- Manual approval gate for production; CD reads feature-flag defaults from environment configuration.\n\n---\n\n## Consequences\n\n**Positive**\n\n- Predictable local and CI builds; clear ownership and publish rules; cacheable tasks.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-012-monorepo-structure.md", "category": "technical", "chunk_index": 4, "token_count": 241, "hash_short": "edb4dd3c", "version": 1.0, "title": "ADR-012: Monorepo Structure, Tooling, and Governance", "mtime": "2025-10-18T10:54:49.913035", "ingested_at": "2025-11-30T04:00:44.114038", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure_chunk_005", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure", "text": "production; CD reads feature-flag defaults from environment configuration.\n\n---\n\n## Consequences\n\n**Positive**\n\n- Predictable local and CI builds; clear ownership and publish rules; cacheable tasks.\n- Strong alignment to PRD/TDD standards; QA gates enforce quality and budgets.\n\n**Negative / Trade-offs**\n\n- Turborepo adds one more layer of configuration (mitigated with templates).\n- Strict boundaries can slow ad-hoc cross-package imports (by design).\n\n**Operational**\n\n- Maintain workspace health checks (orphaned deps, circular refs).\n- Nightly job runs `pnpm dedupe`, dependency audit, and license checks.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-012-monorepo-structure.md", "category": "technical", "chunk_index": 5, "token_count": 152, "hash_short": "99c8b385", "version": 1.0, "title": "ADR-012: Monorepo Structure, Tooling, and Governance", "mtime": "2025-10-18T10:54:49.913035", "ingested_at": "2025-11-30T04:00:44.114038", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure_chunk_006", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure", "text": "ad-hoc cross-package imports (by design).\n\n**Operational**\n\n- Maintain workspace health checks (orphaned deps, circular refs).\n- Nightly job runs `pnpm dedupe`, dependency audit, and license checks.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-012-monorepo-structure.md", "category": "technical", "chunk_index": 6, "token_count": 49, "hash_short": "a22a69dd", "version": 1.0, "title": "ADR-012: Monorepo Structure, Tooling, and Governance", "mtime": "2025-10-18T10:54:49.913035", "ingested_at": "2025-11-30T04:00:44.114038", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure_chunk_007", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-012-monorepo-structure", "text": "---\n\n## Alternatives Considered\n\n| Option              | Description                                | Reason Rejected                                                           |\n| ------------------- | ------------------------------------------ | ------------------------------------------------------------------------- |\n| Yarn workspaces     | Use Yarn instead of pnpm                   | Not aligned with PRD/TDD; slower cold installs in CI                      |\n| Polyrepo            | Separate repos for backend, frontend, libs | Complicates shared types, versioning, and coordinated releases            |\n| Nx instead of Turbo | Use Nx for orchestration                   | Added complexity for our current scope; Turbo meets needs with less setup |\n\n---\n\n## References\n\n- PRD §7 Engineering standards (monorepo, tooling alignment)\n- TDD §0–§2 Repository, stack, and build contracts\n- QA §2–§9 CI pipeline, budgets, and gates\n\n---\n\n## Status Log\n\n| Version | Date       | Change                                                                  | Author   |\n| ------- | ---------- | ----------------------------------------------------------------------- | -------- |\n| v1.0    | 2025-10-14 | Initial ADR using pnpm workspaces + optional Turbo; CI/QA gates defined | Reviewer |", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-012-monorepo-structure.md", "category": "technical", "chunk_index": 7, "token_count": 321, "hash_short": "83b6d00c", "version": 1.0, "title": "ADR-012: Monorepo Structure, Tooling, and Governance", "mtime": "2025-10-18T10:54:49.913035", "ingested_at": "2025-11-30T04:00:44.114038", "tags": ["technical", "md"]}
