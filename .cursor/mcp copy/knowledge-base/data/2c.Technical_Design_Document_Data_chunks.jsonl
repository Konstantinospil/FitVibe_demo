{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_000", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "﻿---\ntitle: \"FitVibe Technical Design Document (TDD): Data\"\nversion: \"v2.0\"\nstatus: \"Accepted\"\nowner: \"Konstantinos Pilpilidis (Dr.)\"\ndate: \"2025-10-21\"\nlinks:\n  - PRD: docs/1.Product_Requirements_Document.md\n  - QA: docs/3.Testing_and_Quality_Assurance_Plan.md\n  - ADR Index: docs/adr/README.md\nlicense: \"MIT\"\n---\n\n# 0. Introduction\n\n## 0.1 Purpose & Scope\n\nThis TDD specifies **how** the FitVibe system will implement the features and constraints defined in the [PRD](.\\1.Product_Requirements_Document.md) (WHAT/WHY) and satisfy the [QA Plan](4.%20Testing_and_Quality_Assurance_Plan.md) (HOW WELL).\n\n## 0.2 Audience & Reading Guide\n\n- **Engineers** implement according to specs, contracts, and runbooks.\n- **QA** uses RTM links to derive tests and quality gates.\n- **Security/Compliance** verifies controls, data classification, GDPR flows.\n- **Product/Design** confirms that behavior matches PRD intent.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 0, "token_count": 226, "hash_short": "830a567f", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_001", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "**QA** uses RTM links to derive tests and quality gates.\n- **Security/Compliance** verifies controls, data classification, GDPR flows.\n- **Product/Design** confirms that behavior matches PRD intent.\n\n## 0.3 Assumptions & Constraints\n\n- Monorepo with **pnpm** workspaces; Node.js 20 LTS; React 18; PostgreSQL = 14 (target 16-18 locally).\n- All external calls (email) are **adapterized** and mockable for tests.\n- Privacy-by-design: **private-by-default** content, explicit consent for public sharing.\n- Deployments run behind **TLS** with reverse proxy (NGINX) and **Let's Encrypt** certificates.\n\n## 0.4 Versioning & Changelog\n\n- **Change policy:** Any change to interfaces, schema, or security controls must update TDD and the related ADR, and link into QA RTM.\n\n---\n\n# 6. Data Design\n\nThis section defines the **logical schema**, **entity dictionary**, **indexing strategy**, **partitioning/archival**, **retention & classification**, and the **migrations plan**.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 1, "token_count": 241, "hash_short": "5c947584", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_002", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "# 6. Data Design\n\nThis section defines the **logical schema**, **entity dictionary**, **indexing strategy**, **partitioning/archival**, **retention & classification**, and the **migrations plan**.\n\nThis chapter describes the **current** FitVibe data model after the refactor to support:\n\n- strict keys and referential integrity,\n- **extensible enumerations** via `code_sets` / `code_values`,\n- **typed attributes** (EAV) for fast schema evolution,\n- consistent soft-delete/archival semantics,\n- i18n via `translations`/`translation_fields`.\n\nIt is optimized for day-1 developer experience, long-term evolvability, and operational safety (clear ON DELETE policies, indices for hot paths, and partitioning guidance).\n\n> Conventions: snake_case for DB identifiers; UTC timestamps; soft-delete via `deleted_at` where needed; `uuid` (preferably UUIDv7) primary keys unless noted.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 2, "token_count": 218, "hash_short": "bec3ecb2", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_003", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "hot paths, and partitioning guidance).\n\n> Conventions: snake_case for DB identifiers; UTC timestamps; soft-delete via `deleted_at` where needed; `uuid` (preferably UUIDv7) primary keys unless noted.\n>\n> **Enumerations:** The live schema currently stores domain enums (status, visibility, kinds) as constrained text columns with partial indexes. References to shared `code_sets` / `code_values` capture the target design tracked in ADR-007.\n\n---\n\n## 6.1 Architectural Overview\n\nThe model is organized into seven layers:\n\n1. **Identity & Security** � users, roles, sessions, tokens, profiles.\n2. **Catalog & i18n** � exercises, categories, tags, translations.\n3. **Planning & Logging** � plans, templates, sessions, per-set logs.\n4. **Progress & Recovery** � personal records, body measurements, recovery logs.\n5. **Social & Gamification** � feed, comments, followers/likes, badges/points.\n6. **Media & Operations** � media assets, idempotency, audit logs.\n7.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 3, "token_count": 239, "hash_short": "9b3648cd", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_004", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "ersonal records, body measurements, recovery logs.\n5. **Social & Gamification** � feed, comments, followers/likes, badges/points.\n6. **Media & Operations** � media assets, idempotency, audit logs.\n7. **Extensibility** � `code_sets` / `code_values` for enums; `attributes` / `attribute_values` for new metrics without schema churn.\n\n**Keys & types:** all entity IDs are `uuid`; timestamps are `timestamptz (UTC)`.\n**Visibility & statuses:** currently represented as text columns with validation + partial indices; migration to shared `code_values` is tracked as follow-up (ref. ADR-007).\n\n---\n\n## 6.2 ERD\n\nSee [ERD](./diagrams/prd-7-2-1-erd-mermaid.mmd)\n\n> Global exercises are represented with `owner_id = NULL` (admin-owned global records) and an additional check constraint.\n\n---\n\n## 6.3 Core Entities (day-to-day)\n\nBelow are the **interfaces teams build against**. Each entity lists its key constraints and noteworthy fields. Detailed column lists are in the ERD above.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 4, "token_count": 243, "hash_short": "3648e4ed", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_005", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "t.\n\n---\n\n## 6.3 Core Entities (day-to-day)\n\nBelow are the **interfaces teams build against**. Each entity lists its key constraints and noteworthy fields. Detailed column lists are in the ERD above.\n\n### 6.3.1 Identity & Security\n\n- **users** � account record. `status_id ? code_values(user_status)`. Soft delete via `deleted_at`.\n- **profiles** � 1:1 user profile; preferences as FKs to code values (gender/units/visibility).\n- **roles, user_roles** � RBAC mapping with `(user_id, role_id)` as PK.\n- **user_sessions** � auth device sessions with `refresh_jti` and IP/user-agent trail.\n- **verification_tokens, reset_tokens** � short-lived tokens. `ON DELETE SET NULL` preserves auditability.\n\n### 6.3.2 Catalog & i18n\n\n- **exercise_categories, exercises** � user-owned or global exercises; archived via `archived_at`.\n  Type/muscle/equipment are FKs to `code_values` (no in-table enums).\n- **tags, exercise_tags** � tagging bridge.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 5, "token_count": 233, "hash_short": "e01e01b8", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_006", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "categories, exercises** � user-owned or global exercises; archived via `archived_at`.\n  Type/muscle/equipment are FKs to `code_values` (no in-table enums).\n- **tags, exercise_tags** � tagging bridge.\n- **translations, translation_fields** � field-level i18n with allow-list enforcement.\n- **translation_cache** � optional cache (may be user-scoped).\n\n### 6.3.3 Planning & Logging\n\n- **plans** � user plans; `status_id` is a code value.\n- **workout_templates** � reusable workouts; difficulty & visibility via code values.\n  - **template_muscle_groups** � multi-select targeting (FK to `code_values(muscle_group)`).\n  - **template_exercises** � ordered content of a template.\n  - **template_ratings** � per-user 1�5 with `UNIQUE(template_id, user_id)`.\n- **sessions** � planned/started/completed with lifecycle checks; visibility via code values.\n- **session_exercises** � ordered list of exercises performed in a session.\n- **exercise_sets** � set-level data incl.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 6, "token_count": 241, "hash_short": "64b53e1e", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_007", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "* � planned/started/completed with lifecycle checks; visibility via code values.\n- **session_exercises** � ordered list of exercises performed in a session.\n- **exercise_sets** � set-level data incl. `rpe`, `set_type_id` (warmup, working, dropset, etc.), `tempo`, `rest_sec`, `completed`.\n\n### 6.3.4 Progress & Recovery\n\n- **personal_records** � time-series PRs; `is_current` partial unique ensures a single current record per `(user, exercise, metric)`.\n- **body_measurements** � daily snapshot table (hot fields like weight BF%).\n- **recovery_logs** � daily wellness inputs (sleep, soreness, stress, etc.).\n\n### 6.3.5 Social & Gamification\n\n- **feed_items** � activity feed entries (sessions, badges, milestones) with visibility stored as constrained text values (public, \ffollowers, link, private).\n- **feed_comments**, **feed_likes**, **session_bookmarks** – social interactions on feed content.\n- **followers** – user following relationships with composite PK on (follower_id, following_id).", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 7, "token_count": 249, "hash_short": "e87ba677", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_008", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "te).\n- **feed_comments**, **feed_likes**, **session_bookmarks** – social interactions on feed content.\n- **followers** – user following relationships with composite PK on (follower_id, following_id).\n- **share_links** – revocable share links for sessions or feed items with XOR constraint ensuring exactly one target.\n- **user_blocks** – user blocking relationships to support content filtering.\n- **feed_reports** – content moderation reports with status tracking (pending/under_review/resolved/rejected).\n- **badge_catalog**, **badges** � badge definitions and awarded instances (metadata captures unlock context).\n- **user_points** � append-only ledger of points with partitioning on \u0007awarded_at; includes source_id for deduplication.\n- **mv_leaderboard** – materialized view aggregating points by period (week/month) with badge counts.\n- **notifications** � typed notifications (backlog for future release).", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 8, "token_count": 227, "hash_short": "790420b0", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_009", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "ce_id for deduplication.\n- **mv_leaderboard** – materialized view aggregating points by period (week/month) with badge counts.\n- **notifications** � typed notifications (backlog for future release).\n\n### 6.3.6 Media & Operations\n\n- **media_assets** � owned objects with target typing via code values.\n- **idempotency_keys** � request dedupe with TTL.\n- **audit_log** � PII-free metadata; actor optional.\n\n---\n\n## 6.2 Entity Dictionary\n\n### 6.2.1 Identity & Security\n\n#### 6.2.1.1 users\n\n| Column         | Type        | Constraints / Notes                         |\n| -------------- | ----------- | ------------------------------------------- |\n| id             | uuid        | **pk**                                      |\n| username       | text        | **unique**                                  |\n| display_name   | text        | 0�120 chars                                 |\n| password_hash  | text        | required                                    |\n| status_id      | uuid        | **fk", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 9, "token_count": 249, "hash_short": "590e55fe", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_010", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| display_name   | text        | 0�120 chars                                 |\n| password_hash  | text        | required                                    |\n| status_id      | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 10, "token_count": 49, "hash_short": "ee6b3963", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_011", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| display_name   | text        | 0�120 chars                                 |\n| password_hash  | text        | required                                    |\n| status_id      | uuid        | **fk ? code_values.id** (set=`user_status`) |\n| locale         | text        | e.g., `en`, `de-DE`                         |\n| preferred_lang | text        | ISO 639-1                                   |\n| created_at     | timestamptz | default `now()`                             |\n| deleted_at     | timestamptz | soft-delete                                 |\n\n---\n\n#### 6.2.1.2 roles\n\n| Column      | Type | Constraints / Notes |\n| ----------- | ---- | ------------------- |\n| id          | uuid | **pk**              |\n| code        | text | **unique**          |\n| name        | text | not null            |\n| description | text | nullable            |\n\n---\n\n#### 6.2.1.3 user_roles\n\n| Column      | Type        | Constraints / Notes                           |\n| ----------- | ----------- | --------------------------------------------- |\n| user_id     | uuid        | **pk**, **fk", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 11, "token_count": 270, "hash_short": "90d27489", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_012", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| Column      | Type        | Constraints / Notes                           |\n| ----------- | ----------- | --------------------------------------------- |\n| user_id     | uuid        | **pk**, **fk ? users.id (ON DELETE CASCADE)** |\n| role_id     | uuid        | **pk**, **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 12, "token_count": 69, "hash_short": "ad8e7051", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_013", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "----------- | ----------- | --------------------------------------------- |\n| user_id     | uuid        | **pk**, **fk ? users.id (ON DELETE CASCADE)** |\n| role_id     | uuid        | **pk**, **fk ? roles.id (ON DELETE CASCADE)** |\n| assigned_at | timestamptz | default `now()`                               |\n\n---\n\n#### 6.2.1.4 profiles\n\n**Design Note:** The profile data is normalized across three tables for better performance and data integrity:\n\n- **profiles** - Static profile data (immutable fields, preferences)\n- **user_contacts** - Contact information (email, phone) with verification status\n- **user_metrics** - Time-series metrics (weight, fitness_level over time)\n\nThis normalized design provides:\n\n- Better query performance (can query contacts/metrics independently)\n- Proper normalization (users can have multiple contacts)\n- Time-series separation (metrics vs static data)\n- Reduced table size for hot-path queries\n\n| Column           | Type        | Constraints / Notes                                                        |\n| ---------------- | ----------- | -------------------------------------------------------------------------- |\n| user_id          | uuid        | **pk**, **fk", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 13, "token_count": 301, "hash_short": "2d1189ac", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_014", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| ---------------- | ----------- | -------------------------------------------------------------------------- |\n| user_id          | uuid        | **pk**, **fk ? users.id (ON DELETE CASCADE)**, **unique** (1:1)            |\n| alias            | citext      | **unique**, nullable; public profile identifier                            |\n| avatar_asset_id  | uuid        | **fk ? media_assets.id** (nullable, ON DELETE SET NULL)                    |\n| bio              | text        | 0-500 chars (CHECK constraint)                                             |\n| date_of_birth    | date        | **immutable after first non-null set**                                     |\n| gender_code      | text        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 14, "token_count": 178, "hash_short": "86f8f4bf", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_015", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| date_of_birth    | date        | **immutable after first non-null set**                                     |\n| gender_code      | text        | **fk ? genders.code** (ON DELETE SET NULL) (**immutable after first set**) |\n| visibility       | text        | **CHECK** IN ('private', 'link', 'public'); default 'private'              |\n| timezone         | text        | e.g., `Europe/Berlin`                                                      |\n| unit_preferences | jsonb       | default `{}`; e.g., `{\"weight\":\"kg\",\"distance\":\"km\"}`                      |\n| created_at       | timestamptz | default `now()`                                                            |\n| updated_at       | timestamptz | default `now()`                                                            |\n\n**Indexes:** `idx_profiles_alias` on `alias` WHERE `alias IS NOT NULL`, `idx_profiles_visibility` on `visibility` WHERE `visibility = 'public'`.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 15, "token_count": 232, "hash_short": "35837870", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_016", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n\n**Indexes:** `idx_profiles_alias` on `alias` WHERE `alias IS NOT NULL`, `idx_profiles_visibility` on `visibility` WHERE `visibility = 'public'`.\n\n**Related Tables:**\n\n- **user_contacts** - Email, phone, verification status (see 6.2.1.5)\n- **user_metrics** - Time-series weight, fitness_level, training_frequency (see 6.2.1.6)\n\n---\n\n#### 6.2.1.5 user_contacts\n\n**Design Note:** Contact information is normalized into a separate table to support:\n\n- Multiple contact methods per user (email, phone, etc.)\n- Verification status tracking per contact\n- Primary/recovery contact designation\n- Historical verification records\n\n| Column      | Type        | Constraints / Notes                                            |\n| ----------- | ----------- | -------------------------------------------------------------- |\n| id          | uuid        | **pk**                                                         |\n| user_id     | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 16, "token_count": 236, "hash_short": "d2b9cb6b", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_017", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| -------------------------------------------------------------- |\n| id          | uuid        | **pk**                                                         |\n| user_id     | uuid        | **fk ? users.id (ON DELETE CASCADE)**                          |\n| type        | text        | not null; e.g., 'email', 'phone'                               |\n| value       | text        | not null; **unique** (email/phone value)                       |\n| is_primary  | boolean     | default `false`; **unique** per user WHERE `is_primary = true` |\n| is_recovery | boolean     | default `false`; for password recovery                         |\n| is_verified | boolean     | default `false`; verification status                           |\n| verified_at | timestamptz | nullable; when verification completed                          |\n| created_at  | timestamptz | default `now()`                                                |\n\n**Indexes:** `user_contacts_user_id_idx` on `(user_id)`, `user_contacts_primary_unique` UNIQUE on `(user_id)` WHERE `is_primary IS TRUE`", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 17, "token_count": 264, "hash_short": "d4433f50", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_018", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "fault `now()`                                                |\n\n**Indexes:** `user_contacts_user_id_idx` on `(user_id)`, `user_contacts_primary_unique` UNIQUE on `(user_id)` WHERE `is_primary IS TRUE`.\n\n---\n\n#### 6.2.1.6 user_metrics\n\n**Design Note:** Time-series metrics are separated from static profile data for:\n\n- Historical tracking (weight over time, fitness level changes)\n- Better query performance (can query latest vs historical)\n- Proper normalization (metrics change, static data doesn't)\n\n| Column             | Type         | Constraints / Notes                                         |\n| ------------------ | ------------ | ----------------------------------------------------------- |\n| id                 | uuid         | **pk**                                                      |\n| user_id            | uuid         | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 18, "token_count": 211, "hash_short": "e8a47238", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_019", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "---------------------------------------------------- |\n| id                 | uuid         | **pk**                                                      |\n| user_id            | uuid         | **fk ? users.id (ON DELETE CASCADE)**                       |\n| weight             | numeric(6,2) | nullable; weight in kg (normalized)                         |\n| unit               | text         | default 'kg'; unit for weight                               |\n| fitness_level_code | text         | **fk ? fitness_levels.code** (nullable, ON DELETE SET NULL) |\n| training_frequency | text         | nullable; e.g., 'rarely', '1_2_per_week', etc.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 19, "token_count": 159, "hash_short": "568598f8", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_020", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| fitness_level_code | text         | **fk ? fitness_levels.code** (nullable, ON DELETE SET NULL) |\n| training_frequency | text         | nullable; e.g., 'rarely', '1_2_per_week', etc.              |\n| photo_url          | text         | nullable; deprecated (use media_assets)                     |\n| recorded_at        | timestamptz  | not null; default `now()`; when metric was recorded         |\n| created_at         | timestamptz  | default `now()`                                             |\n\n**Indexes:** `user_metrics_user_id_recorded_at_idx` on `(user_id, recorded_at)` for time-series queries.\n\n---\n\n#### 6.2.1.7 user_sessions\n\n| Column       | Type        | Constraints / Notes                   |\n| ------------ | ----------- | ------------------------------------- |\n| id           | uuid        | **pk**                                |\n| user_id      | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 20, "token_count": 223, "hash_short": "659d11f7", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_021", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| ------------ | ----------- | ------------------------------------- |\n| id           | uuid        | **pk**                                |\n| user_id      | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 21, "token_count": 45, "hash_short": "d8a729b8", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_022", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "users.id (ON DELETE CASCADE)** |\n| refresh_jti  | uuid        | **unique** (refresh token family id)  |\n| device_id    | text        | nullable                              |\n| user_agent   | text        | nullable                              |\n| ip           | inet        | PII-S                                 |\n| created_at   | timestamptz | default `now()`                       |\n| last_used_at | timestamptz | not null                              |\n| expires_at   | timestamptz | not null                              |\n| revoked_at   | timestamptz | nullable                              |\n\n---\n\n#### 6.2.1.8 verification_tokens\n\n| Column      | Type        | Constraints / Notes                                                             |\n| ----------- | ----------- | ------------------------------------------------------------------------------- |\n| id          | uuid        | **pk**                                                                          |\n| user_id     | uuid        | **fk", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 22, "token_count": 252, "hash_short": "db6f287b", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_023", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "-------------------------------------------------- |\n| id          | uuid        | **pk**                                                                          |\n| user_id     | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 23, "token_count": 50, "hash_short": "b37a0606", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_024", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "------------------------------------------------ |\n| id          | uuid        | **pk**                                                                          |\n| user_id     | uuid        | **fk ? users.id (ON DELETE SET NULL)**                                          |\n| token       | text        | **unique**                                                                      |\n| purpose     | text        | values in `code_values` or constrained app-side (`email_verify`,`phone_verify`) |\n| expires_at  | timestamptz | not null                                                                        |\n| consumed_at | timestamptz | nullable                                                                        |\n| created_at  | timestamptz | default `now()`                                                                 |\n\n---\n\n#### 6.2.1.9 reset_tokens\n\n| Column      | Type        | Constraints / Notes                    |\n| ----------- | ----------- | -------------------------------------- |\n| id          | uuid        | **pk**                                 |\n| user_id     | uuid        | **fk", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 24, "token_count": 278, "hash_short": "ef3ae0e9", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_025", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "s                    |\n| ----------- | ----------- | -------------------------------------- |\n| id          | uuid        | **pk**                                 |\n| user_id     | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 25, "token_count": 50, "hash_short": "a694a51f", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_026", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| ----------- | ----------- | -------------------------------------- |\n| id          | uuid        | **pk**                                 |\n| user_id     | uuid        | **fk ? users.id (ON DELETE SET NULL)** |\n| token       | text        | **unique**                             |\n| expires_at  | timestamptz | not null                               |\n| consumed_at | timestamptz | nullable                               |\n| created_at  | timestamptz | default `now()`                        |\n\n---\n\n### 6.3 Catalog & i18n\n\n#### 6.3.1 exercise_categories\n\n| Column     | Type        | Constraints / Notes |\n| ---------- | ----------- | ------------------- |\n| id         | uuid        | **pk**              |\n| slug       | text        | **unique**          |\n| title      | text        | not null            |\n| created_at | timestamptz | default `now()`     |\n\n---\n\n#### 6.3.2 exercises\n\n| Column          | Type        | Constraints / Notes                            |\n| --------------- | ----------- | ---------------------------------------------- |\n| id              | uuid        | **pk**                                         |\n| owner_id        | uuid        | **fk", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 26, "token_count": 295, "hash_short": "b92bafe2", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_027", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "------------ | ----------- | ---------------------------------------------- |\n| id              | uuid        | **pk**                                         |\n| owner_id        | uuid        | **fk ? users.id** (nullable = global exercise) |\n| name            | text        | not null                                       |\n| category_id     | uuid        | **fk ? exercise_categories.id**                |\n| type_id         | uuid        | **fk ? code_values.id** (set=`exercise_type`)  |\n| muscle_group_id | uuid        | **fk ? code_values.id** (set=`muscle_group`)   |\n| equipment_id    | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 27, "token_count": 154, "hash_short": "15611e33", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_028", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "id         | uuid        | **fk ? code_values.id** (set=`exercise_type`)  |\n| muscle_group_id | uuid        | **fk ? code_values.id** (set=`muscle_group`)   |\n| equipment_id    | uuid        | **fk ? code_values.id** (set=`equipment`)      |\n| is_public       | boolean     | default `false`                                |\n| created_at      | timestamptz | default `now()`                                |\n| updated_at      | timestamptz | default `now()`                                |\n| archived_at     | timestamptz | soft archive                                   |\n\n**Indexes:** `(owner_id, is_public)`, `(category_id)` where `archived_at IS NULL`.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 28, "token_count": 164, "hash_short": "f7f74a31", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_029", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| archived_at     | timestamptz | soft archive                                   |\n\n**Indexes:** `(owner_id, is_public)`, `(category_id)` where `archived_at IS NULL`.\n\n---\n\n#### 6.3.2.3 tags\n\n| Column | Type | Constraints / Notes |\n| ------ | ---- | ------------------- |\n| id     | uuid | **pk**              |\n| slug   | text | **unique**          |\n| label  | text | not null            |\n\n---\n\n#### 6.3.2.4 exercise_tags\n\n| Column      | Type | Constraints / Notes           |\n| ----------- | ---- | ----------------------------- |\n| exercise_id | uuid | **pk**, **fk ? exercises.id** |\n| tag_id      | uuid | **pk**, **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 29, "token_count": 157, "hash_short": "26d908c7", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_030", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "olumn      | Type | Constraints / Notes           |\n| ----------- | ---- | ----------------------------- |\n| exercise_id | uuid | **pk**, **fk ? exercises.id** |\n| tag_id      | uuid | **pk**, **fk ? tags.id**      |\n\n---\n\n#### 6.3.2.5 translation_fields\n\n| Column      | Type | Constraints / Notes                     |\n| ----------- | ---- | --------------------------------------- |\n| entity_type | text | **pk** (composite)                      |\n| field_key   | text | **pk** (composite); allow-listed fields |\n\n---\n\n#### 6.3.2.6 translations\n\n| Column      | Type        | Constraints / Notes                 |\n| ----------- | ----------- | ----------------------------------- |\n| id          | uuid        | **pk**                              |\n| entity_type | text        | constrained by `translation_fields` |\n| entity_id   | uuid        | target entity id                    |\n| lang        | text        | ISO 639-1                           |\n| field_key   | text        | allowed per `translation_fields`    |\n| value       | text        | localized text                      |\n| created_at  | timestamptz | default `now()`                     |\n| updated_at  | timestamptz | default `now()`                     |\n\n**Uniques:** `(entity_type, entity_id, lang, field_key)`", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 30, "token_count": 321, "hash_short": "8ef1c3f1", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_031", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| created_at  | timestamptz | default `now()`                     |\n| updated_at  | timestamptz | default `now()`                     |\n\n**Uniques:** `(entity_type, entity_id, lang, field_key)`.\n\n---\n\n#### 6.3.2.7 translation_cache\n\n| Column     | Type        | Constraints / Notes                      |\n| ---------- | ----------- | ---------------------------------------- |\n| id         | uuid        | **pk**                                   |\n| owner_id   | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 31, "token_count": 121, "hash_short": "c44f0f63", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_032", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| ---------- | ----------- | ---------------------------------------- |\n| id         | uuid        | **pk**                                   |\n| owner_id   | uuid        | **fk ? users.id** (nullable)             |\n| hash       | uuid        | **unique** (computed md5 of source+lang) |\n| source     | text        | raw source                               |\n| lang       | text        | ISO 639-1                                |\n| translated | text        | translated output                        |\n| created_at | timestamptz | default `now()`                          |\n| expires_at | timestamptz | optional TTL                             |\n\n---\n\n### 6.3.4 Planning & Logging\n\n#### 6.3.4.1 plans\n\n| Column          | Type        | Constraints / Notes                         |\n| --------------- | ----------- | ------------------------------------------- |\n| id              | uuid        | **pk**                                      |\n| user_id         | uuid        | **fk", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 32, "token_count": 246, "hash_short": "e8275527", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_033", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| --------------- | ----------- | ------------------------------------------- |\n| id              | uuid        | **pk**                                      |\n| user_id         | uuid        | **fk ? users.id**                           |\n| title           | text        | not null                                    |\n| status_id       | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 33, "token_count": 90, "hash_short": "6f2450ef", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_034", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "user_id         | uuid        | **fk ? users.id**                           |\n| title           | text        | not null                                    |\n| status_id       | uuid        | **fk ? code_values.id** (set=`plan_status`) |\n| recurrence_rule | text        | RFC 5545 RRULE                              |\n| notes           | text        | nullable                                    |\n| created_at      | timestamptz | default `now()`                             |\n| updated_at      | timestamptz | default `now()`                             |\n| archived_at     | timestamptz | soft archive                                |\n\n---\n\n#### 6.3.4.2 workout_templates\n\n| Column                 | Type         | Constraints / Notes                        |\n| ---------------------- | ------------ | ------------------------------------------ |\n| id                     | uuid         | **pk**                                     |\n| user_id                | uuid         | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 34, "token_count": 246, "hash_short": "fcc92972", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_035", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "- | ------------ | ------------------------------------------ |\n| id                     | uuid         | **pk**                                     |\n| user_id                | uuid         | **fk ? users.id**                          |\n| name                   | text         | not null                                   |\n| description            | text         | nullable                                   |\n| estimated_duration_min | smallint     | duration minutes                           |\n| difficulty_id          | uuid         | **fk ? code_values.id** (set=`difficulty`) |\n| times_used             | smallint     | default 0                                  |\n| avg_rating             | numeric(3,2) | nullable (denormalized)                    |\n| is_public              | boolean      | default `false`                            |\n| visibility_id          | uuid         | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 35, "token_count": 223, "hash_short": "82682aa7", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_036", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| numeric(3,2) | nullable (denormalized)                    |\n| is_public              | boolean      | default `false`                            |\n| visibility_id          | uuid         | **fk ? code_values.id** (set=`visibility`) |\n| created_at             | timestamptz  | default `now()`                            |\n| updated_at             | timestamptz  | default `now()`                            |\n| archived_at            | timestamptz  | soft archive                               |\n\n---\n\n#### 6.3.4.3 template_muscle_groups\n\n| Column          | Type | Constraints / Notes                                       |\n| --------------- | ---- | --------------------------------------------------------- |\n| template_id     | uuid | **pk**, **fk ? workout_templates.id (ON DELETE CASCADE)** |\n| muscle_group_id | uuid | **pk**, **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 36, "token_count": 210, "hash_short": "d9489812", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_037", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "- | ---- | --------------------------------------------------------- |\n| template_id     | uuid | **pk**, **fk ? workout_templates.id (ON DELETE CASCADE)** |\n| muscle_group_id | uuid | **pk**, **fk ? code_values.id** (set=`muscle_group`)      |\n\n---\n\n#### 6.3.4.4 template_exercises\n\n| Column      | Type        | Constraints / Notes                                    |\n| ----------- | ----------- | ------------------------------------------------------ |\n| id          | uuid        | **pk**                                                 |\n| template_id | uuid        | **fk ? workout_templates.id (ON DELETE CASCADE)**      |\n| exercise_id | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 37, "token_count": 167, "hash_short": "61e46a14", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_038", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| uuid        | **pk**                                                 |\n| template_id | uuid        | **fk ? workout_templates.id (ON DELETE CASCADE)**      |\n| exercise_id | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 38, "token_count": 49, "hash_short": "ee8da15c", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_039", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "exercises.id**                                  |\n| order_index | int         | not null; **unique** with `(template_id, order_index)` |\n| target_sets | int         | nullable                                               |\n| target_reps | text        | e.g., `\"8-12\"`                                         |\n| target_rest | text        | e.g., `\"90s\"`                                          |\n| notes       | text        | nullable                                               |\n| updated_at  | timestamptz | default `now()`                                        |\n\n---\n\n#### 6.3.4.5 template_ratings\n\n| Column      | Type        | Constraints / Notes                               |\n| ----------- | ----------- | ------------------------------------------------- |\n| id          | uuid        | **pk**                                            |\n| template_id | uuid        | **fk ? workout_templates.id (ON DELETE CASCADE)** |\n| user_id     | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 39, "token_count": 243, "hash_short": "e21bd144", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_040", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "id          | uuid        | **pk**                                            |\n| template_id | uuid        | **fk ? workout_templates.id (ON DELETE CASCADE)** |\n| user_id     | uuid        | **fk ? users.id (ON DELETE CASCADE)**             |\n| rating      | smallint    | **check** 1..5                                    |\n| review      | text        | nullable                                          |\n| created_at  | timestamptz | default `now()`                                   |\n| updated_at  | timestamptz | default `now()`                                   |\n\n**Unique:** `(template_id, user_id)`.\n\n---\n\n#### 6.3.4.6 sessions\n\n| Column            | Type        | Constraints / Notes                            |\n| ----------------- | ----------- | ---------------------------------------------- |\n| id                | uuid        | **pk**                                         |\n| owner_id          | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 40, "token_count": 234, "hash_short": "508d6557", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_041", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "------ | ----------- | ---------------------------------------------- |\n| id                | uuid        | **pk**                                         |\n| owner_id          | uuid        | **fk ? users.id**                              |\n| plan_id           | uuid        | **fk ? plans.id** (nullable)                   |\n| template_id       | uuid        | **fk ? workout_templates.id** (nullable)       |\n| source_session_id | uuid        | **fk ? sessions.id** (nullable; copied from)   |\n| title             | text        | nullable                                       |\n| planned_at        | timestamptz | not null                                       |\n| recurrence_rule   | text        | RFC 5545 RRULE                                 |\n| started_at        | timestamptz | nullable                                       |\n| completed_at      | timestamptz | nullable                                       |\n| status_id         | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 41, "token_count": 241, "hash_short": "574c770d", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_042", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| timestamptz | nullable                                       |\n| completed_at      | timestamptz | nullable                                       |\n| status_id         | uuid        | **fk ? code_values.id** (set=`session_status`) |\n| visibility_id     | uuid        | **fk ? code_values.id** (set=`visibility`)     |\n| calories          | int         | nullable                                       |\n| notes             | text        | nullable                                       |\n| created_at        | timestamptz | default `now()`                                |\n| updated_at        | timestamptz | default `now()`                                |\n| deleted_at        | timestamptz | soft-delete                                    |\n\n**Checks:** lifecycle coherence (planned/in_progress/completed); timestamp ordering (`completed_at >= started_at >= planned_at`).", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 42, "token_count": 218, "hash_short": "2dc4875d", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_043", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| timestamptz | soft-delete                                    |\n\n**Checks:** lifecycle coherence (planned/in_progress/completed); timestamp ordering (`completed_at >= started_at >= planned_at`).\n\n---\n\n#### 6.3.4.7 session_exercises\n\n| Column      | Type        | Constraints / Notes                                   |\n| ----------- | ----------- | ----------------------------------------------------- |\n| id          | uuid        | **pk**                                                |\n| session_id  | uuid        | **fk ? sessions.id (ON DELETE CASCADE)**              |\n| exercise_id | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 43, "token_count": 153, "hash_short": "7af054c4", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_044", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| uuid        | **pk**                                                |\n| session_id  | uuid        | **fk ? sessions.id (ON DELETE CASCADE)**              |\n| exercise_id | uuid        | **fk ? exercises.id**                                 |\n| order_index | int         | not null; **unique** with `(session_id, order_index)` |\n| notes       | text        | nullable                                              |\n| created_at  | timestamptz | default `now()`                                       |\n| updated_at  | timestamptz | default `now()`                                       |\n\n---\n\n#### 6.3.4.8 exercise_sets\n\n| Column              | Type          | Constraints / Notes                                            |\n| ------------------- | ------------- | -------------------------------------------------------------- |\n| id                  | uuid          | **pk**                                                         |\n| session_exercise_id | uuid          | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 44, "token_count": 245, "hash_short": "74c4de10", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_045", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "--------------------------------------------- |\n| id                  | uuid          | **pk**                                                         |\n| session_exercise_id | uuid          | **fk ? session_exercises.id (ON DELETE CASCADE)**              |\n| order_index         | int           | not null; **unique** with `(session_exercise_id, order_index)` |\n| reps                | smallint      | nullable                                                       |\n| weight_kg           | numeric(10,2) | nullable                                                       |\n| distance_m          | int           | nullable                                                       |\n| duration_sec        | int           | nullable                                                       |\n| rpe                 | smallint      | **check** 1..10                                                |\n| set_type_id         | uuid          | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 45, "token_count": 233, "hash_short": "00cc0805", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_046", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| rpe                 | smallint      | **check** 1..10                                                |\n| set_type_id         | uuid          | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 46, "token_count": 38, "hash_short": "c38df9b5", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_047", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "code_values.id** (set=`set_type`)                       |\n| tempo               | text          | e.g., `3-0-1-0`                                                |\n| rest_sec            | smallint      | actual rest                                                    |\n| completed           | boolean       | default `true`; `false` if skipped                             |\n| notes               | text          | nullable                                                       |\n| created_at          | timestamptz   | default `now()`                                                |\n| updated_at          | timestamptz   | default `now()`                                                |\n\n---\n\n### 6.3.5 Progress & Recovery\n\n#### 6.3.5.1 personal_records\n\n**Design Note:** Uses ENUM for `pr_type` instead of text `metric` for:\n\n- Better performance (ENUM is more efficient than text)\n- Database-level constraint enforcement\n- Type safety in application code\n- Clearer domain model\n\n| Column       | Type          | Constraints / Notes                                                                          |\n| ------------ | ------------- | -------------------------------------------------------------------------------------------- |\n| id           | uuid          | **pk**                                                                                       |\n| user_id      | uuid          | **fk", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 47, "token_count": 350, "hash_short": "ea054677", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_048", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "------------------------------- |\n| id           | uuid          | **pk**                                                                                       |\n| user_id      | uuid          | **fk ? users.id**                                                                            |\n| exercise_id  | uuid          | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 48, "token_count": 82, "hash_short": "e486eb8c", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_049", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| user_id      | uuid          | **fk ? users.id**                                                                            |\n| exercise_id  | uuid          | **fk ? exercises.id**                                                                        |\n| pr_type      | enum          | **ENUM** ('1rm', 'volume', 'reps', 'duration'); not null                                     |\n| value        | numeric(10,2) | not null                                                                                     |\n| reps         | integer       | nullable; for 1RM calculation context                                                        |\n| weight_kg    | numeric(10,2) | nullable; weight used for the PR                                                             |\n| duration_sec | integer       | nullable; duration for time-based exercises                                                  |\n| session_id   | uuid          | nullable; FK to sessions(id) - enforced at application level per ADR-005                     |\n| set_id       | uuid          | nullable; reference to specific set (no FK for manual entry flexibility)                     |\n| achieved_at  | timestamptz   | not null; default `now()`                                                                    |\n| is_current   | boolean       | default `true`; partial **unique** `(user_id, exercise_id, pr_type) WHERE is_current = true` |\n| notes        | text          | nullable; additional context                                                                 |\n| created_at   | timestamptz   | default `now()`                                                                              |\n\n**Indexes:** `(user_id, exercise_id, pr_type, is_current)`, `(user_id, is_current)`, `(achieved_at)`", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 49, "token_count": 441, "hash_short": "b6903891", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_050", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| default `now()`                                                                              |\n\n**Indexes:** `(user_id, exercise_id, pr_type, is_current)`, `(user_id, is_current)`, `(achieved_at)`.\n\n---\n\n#### 6.3.5.2 body_measurements\n\n| Column           | Type         | Constraints / Notes                   |\n| ---------------- | ------------ | ------------------------------------- |\n| id               | uuid         | **pk**                                |\n| user_id          | uuid         | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 50, "token_count": 127, "hash_short": "68b9820f", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_051", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| ---------------- | ------------ | ------------------------------------- |\n| id               | uuid         | **pk**                                |\n| user_id          | uuid         | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 51, "token_count": 49, "hash_short": "16021a16", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_052", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "users.id (ON DELETE CASCADE)** |\n| measurement_date | date         | **unique** with `user_id`             |\n| weight_kg        | numeric(6,2) | nullable                              |\n| body_fat_pct     | numeric(4,2) | nullable                              |\n| chest_cm         | numeric(6,2) | nullable                              |\n| waist_cm         | numeric(6,2) | nullable                              |\n| hips_cm          | numeric(6,2) | nullable                              |\n| thigh_cm         | numeric(6,2) | nullable                              |\n| bicep_cm         | numeric(6,2) | nullable                              |\n| notes            | text         | nullable                              |\n| created_at       | timestamptz  | default `now()`                       |\n\n---\n\n#### 6.3.5.3 recovery_logs\n\n| Column         | Type        | Constraints / Notes                   |\n| -------------- | ----------- | ------------------------------------- |\n| id             | uuid        | **pk**                                |\n| user_id        | uuid        | **fk", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 52, "token_count": 270, "hash_short": "21904445", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_053", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| -------------- | ----------- | ------------------------------------- |\n| id             | uuid        | **pk**                                |\n| user_id        | uuid        | **fk ? users.id (ON DELETE CASCADE)** |\n| log_date       | date        | **unique** with `user_id`             |\n| sleep_hours    | smallint    | 0�24                                  |\n| sleep_quality  | smallint    | 1�10                                  |\n| soreness_level | smallint    | 1�10                                  |\n| stress_level   | smallint    | 1�10                                  |\n| energy_level   | smallint    | 1�10                                  |\n| notes          | text        | nullable                              |\n| created_at     | timestamptz | default `now()`                       |\n\n---\n\n### 6.3.6.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 53, "token_count": 205, "hash_short": "03168928", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_054", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "0                                  |\n| notes          | text        | nullable                              |\n| created_at     | timestamptz | default `now()`                       |\n\n---\n\n### 6.3.6. Social & Gamification\n\n#### 6.3.6.1 badge_catalog\n\n| Column      | Type        | Constraints / Notes                                        |\n| ----------- | ----------- | ---------------------------------------------------------- |\n| code        | text        | **pk**                                                     |\n| name        | text        | not null                                                   |\n| description | text        | not null                                                   |\n| category    | text        | not null; taxonomy (e.g., `milestone`, `streak`, `legacy`) |\n| icon        | text        | nullable; optional asset key                               |\n| priority    | integer     | not null; default `0`; determines surfacing order          |\n| criteria    | jsonb       | not null; default `{}`; machine-readable unlock rules      |\n| created_at  | timestamptz | not null; default `now()`                                  |\n\nReference catalog that defines available badge types", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 54, "token_count": 303, "hash_short": "9de8282c", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_055", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "ull; default `{}`; machine-readable unlock rules      |\n| created_at  | timestamptz | not null; default `now()`                                  |\n\nReference catalog that defines available badge types. Seeded via migration; admins manage additional badges offline. Each badge type is referenced by the `badges` table via `badge_type` foreign key.\n\n---\n\n#### 6.3.6.2 badges\n\n| Column     | Type        | Constraints / Notes                                               |\n| ---------- | ----------- | ----------------------------------------------------------------- |\n| id         | uuid        | **pk**                                                            |\n| user_id    | uuid        | **fk ? users.id (ON DELETE CASCADE)**                             |\n| badge_type | text        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 55, "token_count": 199, "hash_short": "4ee917fd", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_056", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "*pk**                                                            |\n| user_id    | uuid        | **fk ? users.id (ON DELETE CASCADE)**                             |\n| badge_type | text        | **fk ? badge_catalog.code (ON UPDATE CASCADE ON DELETE CASCADE)** |\n| metadata   | jsonb       | not null; default `{}`; unlock context snapshot                   |\n| awarded_at | timestamptz | not null; default `now()`                                         |\n\n**Unique:** `(user_id, badge_type)` prevents duplicates (index: `badges_user_badge_unique_idx`).\n\n---\n\n#### 6.3.6.3 user_points\n\n| Column            | Type        | Constraints / Notes                                                     |\n| ----------------- | ----------- | ----------------------------------------------------------------------- |\n| id                | uuid        | **pk**                                                                  |\n| user_id           | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 56, "token_count": 239, "hash_short": "c9c3917f", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_057", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "-------------------------------------------- |\n| id                | uuid        | **pk**                                                                  |\n| user_id           | uuid        | **fk ? users.id (ON DELETE CASCADE)**                                   |\n| source_type       | text        | not null; `session.completed`, `streak`, `referral`, etc.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 57, "token_count": 90, "hash_short": "d6670d38", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_058", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| uuid        | **fk ? users.id (ON DELETE CASCADE)**                                   |\n| source_type       | text        | not null; `session.completed`, `streak`, `referral`, etc.               |\n| source_id         | uuid        | nullable; optional dedupe key                                           |\n| algorithm_version | text        | not null; scoring model identifier                                      |\n| points            | integer     | not null                                                                |\n| calories          | integer     | nullable; optional payload (added in 202510260103)                      |\n| metadata          | jsonb       | not null; default `{}`; extensible context blob (added in 202510260103) |\n| awarded_at        | timestamptz | not null; default `now()`; **partition key** (monthly range)            |\n| created_at        | timestamptz | not null; default `now()` (added in 202510260103)                       |\n\n**Index:** `(user_id, awarded_at DESC)`", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 58, "token_count": 252, "hash_short": "bf66f121", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_059", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "`; **partition key** (monthly range)            |\n| created_at        | timestamptz | not null; default `now()` (added in 202510260103)                       |\n\n**Index:** `(user_id, awarded_at DESC)`. Partial index `user_points_source_unique_idx` on `(user_id, source_type, source_id) WHERE source_id IS NOT NULL` for deduplication. Note: Cannot enforce UNIQUE constraint on partitioned table without including `awarded_at`; uniqueness enforced at application level per ADR-005.\n\n---\n\n#### 6.3.6.4 feed_items\n\n| Column       | Type          | Constraints / Notes                                                           |\n| ------------ | ------------- | ----------------------------------------------------------------------------- |\n| id           | uuid          | **pk**; default `gen_random_uuid()`                                           |\n| owner_id     | uuid          | not null; **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 59, "token_count": 224, "hash_short": "b2c76df6", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_060", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "---------------------------------- |\n| id           | uuid          | **pk**; default `gen_random_uuid()`                                           |\n| owner_id     | uuid          | not null; **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)**             |\n| session_id   | uuid          | nullable; FK to sessions(id) - enforced at application level per ADR-005      |\n| kind         | text          | not null; default `session`; values: `session`, `badge`, `milestone`, etc.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 60, "token_count": 120, "hash_short": "1b30489d", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_061", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| nullable; FK to sessions(id) - enforced at application level per ADR-005      |\n| kind         | text          | not null; default `session`; values: `session`, `badge`, `milestone`, etc.    |\n| target_type  | text          | nullable; optional discriminator                                              |\n| target_id    | uuid          | nullable; optional target reference                                           |\n| visibility   | text          | not null; default `private`; values: `public`, `followers`, `link`, `private` |\n| score        | numeric(10,2) | not null; default `0`; ranking weight                                         |\n| published_at | timestamptz   | nullable                                                                      |\n| created_at   | timestamptz   | not null; default `now()`                                                     |\n| updated_at   | timestamptz   | not null; default `now()`                                                     |\n| deleted_at   | timestamptz   | nullable                                                                      |\n\nIndexes: `idx_feed_items_visibility_published` on `(visibility, published_at)` for public feed queries; `idx_feed_items_owner` on `(owner_id, published_at)` for personal view", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 61, "token_count": 318, "hash_short": "f4f5a583", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_062", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n\nIndexes: `idx_feed_items_visibility_published` on `(visibility, published_at)` for public feed queries; `idx_feed_items_owner` on `(owner_id, published_at)` for personal view. Created in migration 202510260105.\n\n---\n\n#### 6.3.6.5 feed_likes\n\n| Column       | Type        | Constraints / Notes                                                              |\n| ------------ | ----------- | -------------------------------------------------------------------------------- |\n| feed_item_id | uuid        | **pk** (composite); **fk ? feed_items.id (ON UPDATE CASCADE ON DELETE CASCADE)** |\n| user_id      | uuid        | **pk** (composite); **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)**      |\n| created_at   | timestamptz | not null; default `now()`                                                        |\n\nComposite **pk** `(feed_item_id, user_id)`. Index: `idx_feed_likes_item` on `(feed_item_id, created_at)`. Created in migration 202510260105.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 62, "token_count": 239, "hash_short": "f761080c", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_063", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n\nComposite **pk** `(feed_item_id, user_id)`. Index: `idx_feed_likes_item` on `(feed_item_id, created_at)`. Created in migration 202510260105.\n\n---\n\n#### 6.3.6.6 session_bookmarks\n\n| Column     | Type        | Constraints / Notes                                                                |\n| ---------- | ----------- | ---------------------------------------------------------------------------------- |\n| session_id | uuid        | **pk** (composite); FK to sessions(id) - enforced at application level per ADR-005 |\n| user_id    | uuid        | **pk** (composite); **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)**        |\n| created_at | timestamptz | not null; default `now()`                                                          |\n\nComposite **pk** `(session_id, user_id)`. Created in migration 202510260105.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 63, "token_count": 207, "hash_short": "c0291711", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_064", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| created_at | timestamptz | not null; default `now()`                                                          |\n\nComposite **pk** `(session_id, user_id)`. Created in migration 202510260105.\n\n---\n\n#### 6.3.6.7 feed_comments\n\n| Column       | Type        | Constraints / Notes                                                                         |\n| ------------ | ----------- | ------------------------------------------------------------------------------------------- |\n| id           | uuid        | **pk**; default `gen_random_uuid()`                                                         |\n| feed_item_id | uuid        | not null; **fk ? feed_items.id (ON UPDATE CASCADE ON DELETE CASCADE)**                      |\n| user_id      | uuid        | not null; **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)**                           |\n| parent_id    | uuid        | nullable; **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 64, "token_count": 225, "hash_short": "187cab48", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_065", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": ")**                      |\n| user_id      | uuid        | not null; **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)**                           |\n| parent_id    | uuid        | nullable; **fk ? feed_comments.id (ON UPDATE CASCADE ON DELETE SET NULL)** (self-reference) |\n| body         | text        | not null                                                                                    |\n| created_at   | timestamptz | not null; default `now()`                                                                   |\n| edited_at    | timestamptz | nullable                                                                                    |\n| deleted_at   | timestamptz | nullable (tombstone for soft delete)                                                        |\n\nIndex: `idx_feed_comments_item` on `(feed_item_id, created_at)`. Created in migration 202510260105.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 65, "token_count": 219, "hash_short": "941a1e89", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_066", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "z | nullable (tombstone for soft delete)                                                        |\n\nIndex: `idx_feed_comments_item` on `(feed_item_id, created_at)`. Created in migration 202510260105.\n\n---\n\n#### 6.3.6.8 share_links\n\n| Column       | Type        | Constraints / Notes                                                         |\n| ------------ | ----------- | --------------------------------------------------------------------------- |\n| id           | uuid        | **pk**; default `gen_random_uuid()`                                         |\n| session_id   | uuid        | nullable; FK to sessions(id) - enforced at application level per ADR-005    |\n| feed_item_id | uuid        | nullable; **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 66, "token_count": 178, "hash_short": "7a9ebb12", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_067", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| session_id   | uuid        | nullable; FK to sessions(id) - enforced at application level per ADR-005    |\n| feed_item_id | uuid        | nullable; **fk ? feed_items.id (ON UPDATE CASCADE ON DELETE SET NULL)**     |\n| token        | text        | not null; **unique** (index: `share_links_token_unique`); unguessable token |\n| view_count   | integer     | not null; default `0`                                                       |\n| max_views    | integer     | nullable; optional view limit                                               |\n| expires_at   | timestamptz | nullable; optional expiration                                               |\n| revoked_at   | timestamptz | nullable; marks link as revoked                                             |\n| created_at   | timestamptz | not null; default `now()`                                                   |\n| created_by   | uuid        | not null; **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 67, "token_count": 230, "hash_short": "aeb8e63a", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_068", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| created_at   | timestamptz | not null; default `now()`                                                   |\n| created_by   | uuid        | not null; **fk ? users.id (ON DELETE CASCADE)**                             |\n\n**Check:** `share_links_target_check` ensures `(feed_item_id IS NOT NULL AND session_id IS NULL) OR (session_id IS NOT NULL)` - at least one target must be set. Index `share_links_session_idx` on `(session_id)` supports lookup. Created in migration 202510260104; enhanced in 202510260105 to support feed items.\n\n---\n\n#### 6.3.6.9 followers\n\n| Column       | Type        | Constraints / Notes                                                         |\n| ------------ | ----------- | --------------------------------------------------------------------------- |\n| follower_id  | uuid        | **pk** (composite); **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)** |\n| following_id | uuid        | **pk** (composite); **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 68, "token_count": 236, "hash_short": "57e644bd", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_069", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "------------------------------ |\n| follower_id  | uuid        | **pk** (composite); **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)** |\n| following_id | uuid        | **pk** (composite); **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)** |\n| created_at   | timestamptz | not null; default `now()`                                                   |\n\nComposite **pk** `followers_pk (follower_id, following_id)`. **Check:** `followers_no_self` ensures `follower_id <> following_id`. Updated in migration 202510260105 to use composite PK (previously had separate `id` column).\n\n---\n\n#### 6.3.6.10 user_blocks\n\n| Column     | Type        | Constraints / Notes                                                         |\n| ---------- | ----------- | --------------------------------------------------------------------------- |\n| blocker_id | uuid        | **pk** (composite); **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)** |\n| blocked_id | uuid        | **pk** (composite); **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 69, "token_count": 248, "hash_short": "06b0aecf", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_070", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "---------------------------------- |\n| blocker_id | uuid        | **pk** (composite); **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)** |\n| blocked_id | uuid        | **pk** (composite); **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)** |\n| created_at | timestamptz | not null; default `now()`                                                   |\n\nComposite **pk** `user_blocks_pk (blocker_id, blocked_id)`. **Check:** `user_blocks_no_self` ensures `blocker_id <> blocked_id`. Indexes: `user_blocks_blocker_idx` on `(blocker_id)` and `user_blocks_blocked_idx` on `(blocked_id)` for enforcement queries. Created in migration 202510260105.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 70, "token_count": 162, "hash_short": "a50d2e36", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_071", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "` ensures `blocker_id <> blocked_id`. Indexes: `user_blocks_blocker_idx` on `(blocker_id)` and `user_blocks_blocked_idx` on `(blocked_id)` for enforcement queries. Created in migration 202510260105.\n\n---\n\n#### 6.3.6.11 feed_reports\n\n| Column       | Type        | Constraints / Notes                                                                    |\n| ------------ | ----------- | -------------------------------------------------------------------------------------- |\n| id           | uuid        | **pk**; default `gen_random_uuid()`                                                    |\n| reporter_id  | uuid        | not null; **fk ? users.id (ON UPDATE CASCADE ON DELETE CASCADE)**                      |\n| feed_item_id | uuid        | nullable; **fk ? feed_items.id (ON UPDATE CASCADE ON DELETE SET NULL)**                |\n| comment_id   | uuid        | nullable; **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 71, "token_count": 220, "hash_short": "4e01a963", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_072", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "SCADE)**                      |\n| feed_item_id | uuid        | nullable; **fk ? feed_items.id (ON UPDATE CASCADE ON DELETE SET NULL)**                |\n| comment_id   | uuid        | nullable; **fk ? feed_comments.id (ON UPDATE CASCADE ON DELETE SET NULL)**             |\n| reason       | text        | not null; normalized reason code                                                       |\n| details      | text        | nullable; optional additional context                                                  |\n| status       | text        | not null; default `pending`; values: `pending`, `under_review`, `resolved`, `rejected` |\n| created_at   | timestamptz | not null; default `now()`                                                              |\n| resolved_at  | timestamptz | nullable; timestamp of resolution                                                      |\n| resolved_by  | uuid        | nullable; **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 72, "token_count": 229, "hash_short": "aec04567", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_073", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| resolved_at  | timestamptz | nullable; timestamp of resolution                                                      |\n| resolved_by  | uuid        | nullable; **fk ? users.id (ON UPDATE CASCADE ON DELETE SET NULL)**                     |\n\nIndexes: `feed_reports_item_idx` on `(feed_item_id, status)` and `feed_reports_comment_idx` on `(comment_id, status)` support moderation queue views. Created in migration 202510260105.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 73, "token_count": 106, "hash_short": "cbe6a7f7", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_074", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n\nIndexes: `feed_reports_item_idx` on `(feed_item_id, status)` and `feed_reports_comment_idx` on `(comment_id, status)` support moderation queue views. Created in migration 202510260105.\n\n---\n\n#### 6.3.6.12 mv_leaderboard (materialized view)\n\n| Column       | Type    | Description                                     |\n| ------------ | ------- | ----------------------------------------------- |\n| period_type  | text    | `week` or `month`                               |\n| period_start | date    | Start date of the period (week/month truncated) |\n| user_id      | uuid    | User identifier                                 |\n| username     | text    | User's username                                 |\n| display_name | text    | User's display name                             |\n| points       | integer | Total points earned in the period               |\n| badges_count | integer | Total badges earned by user (across all time)   |\n\nPre-aggregated leaderboard view that groups `user_points` by period (week/month)", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 74, "token_count": 254, "hash_short": "768e7bc5", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_075", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "ints earned in the period               |\n| badges_count | integer | Total badges earned by user (across all time)   |\n\nPre-aggregated leaderboard view that groups `user_points` by period (week/month). Includes badge counts from the `badges` table. Refreshed by `refresh-materialized.ts` script.\n\n**Indexes:**\n\n- `mv_leaderboard_unique_idx`: UNIQUE on `(period_type, period_start, user_id)`\n- `mv_leaderboard_sort_idx`: on `(period_type, period_start DESC, points DESC)` for efficient ranking queries\n\nCreated in migration 202510270104.\n\n#### 6.3.7.1 media_assets\n\n| Column         | Type        | Constraints / Notes                         |\n| -------------- | ----------- | ------------------------------------------- |\n| id             | uuid        | **pk**                                      |\n| owner_id       | uuid        | **fk ? users.id (ON DELETE CASCADE)**       |\n| target_type_id | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 75, "token_count": 230, "hash_short": "7191f5f0", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_076", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| id             | uuid        | **pk**                                      |\n| owner_id       | uuid        | **fk ? users.id (ON DELETE CASCADE)**       |\n| target_type_id | uuid        | **fk ? code_values.id** (set=`target_type`) |\n| target_id      | uuid        | entity id                                   |\n| object_key     | text        | **unique** path/key                         |\n| mime_type      | text        | allow-list enforced                         |\n| kind_id        | uuid        | **fk ? code_values.id** (set=`media_kind`)  |\n| size_bytes     | int         | not null                                    |\n| width_px       | int         | nullable                                    |\n| height_px      | int         | nullable                                    |\n| duration_sec   | int         | nullable                                    |\n| av_scan_passed | boolean     | default `false` ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 76, "token_count": 230, "hash_short": "1ad59b0c", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_077", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "px      | int         | nullable                                    |\n| duration_sec   | int         | nullable                                    |\n| av_scan_passed | boolean     | default `false` ? set `true` on clean       |\n| created_at     | timestamptz | default `now()`                             |\n| updated_at     | timestamptz | default `now()`                             |\n\n**Index:** `(target_type_id, target_id)`.\n\n---\n\n#### 6.3.7.2 audit_log\n\n| Column      | Type        | Constraints / Notes                       |\n| ----------- | ----------- | ----------------------------------------- |\n| id          | uuid        | **pk**                                    |\n| actor_id    | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 77, "token_count": 179, "hash_short": "14c3d291", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_078", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| ----------- | ----------- | ----------------------------------------- |\n| id          | uuid        | **pk**                                    |\n| actor_id    | uuid        | **fk ? users.id** (nullable)              |\n| action      | text        | e.g., `user.created`, `session.completed` |\n| entity_type | text        | domain string                             |\n| entity_id   | uuid        | entity id                                 |\n| request_id  | uuid        | correlation id                            |\n| meta        | jsonb       | PII-free metadata                         |\n| created_at  | timestamptz | default `now()`                           |\n\n**Indexes:** `(entity_type, entity_id, created_at DESC)`, `(actor_id, created_at DESC)` partial where actor exists.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 78, "token_count": 196, "hash_short": "49f35caa", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_079", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| created_at  | timestamptz | default `now()`                           |\n\n**Indexes:** `(entity_type, entity_id, created_at DESC)`, `(actor_id, created_at DESC)` partial where actor exists.\n\n---\n\n#### 6.3.7.3 idempotency_keys\n\n| Column        | Type        | Constraints / Notes                   |\n| ------------- | ----------- | ------------------------------------- |\n| key           | uuid        | **pk**                                |\n| user_id       | uuid        | **fk ? users.id** (nullable)          |\n| fingerprint   | text        | not null (hash of normalized request) |\n| status        | text        | `stored; completed; expired; failed`  |\n| response_hash | text        | nullable                              |\n| expires_at    | timestamptz | not null                              |\n| created_at    | timestamptz | default `now()`                       |\n\n**Index:** `(expires_at)` partial where `status != 'expired'`.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 79, "token_count": 235, "hash_short": "2f6a20d8", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_080", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "_at    | timestamptz | not null                              |\n| created_at    | timestamptz | default `now()`                       |\n\n**Index:** `(expires_at)` partial where `status != 'expired'`.\n\n---\n\n### 6.3.8 Extensibility (Enums & Attributes)\n\n#### 6.3.8.1 code_sets\n\n| Column      | Type        | Constraints / Notes |\n| ----------- | ----------- | ------------------- |\n| id          | uuid        | **pk**              |\n| key         | text        | **unique**          |\n| description | text        | nullable            |\n| created_at  | timestamptz | default `now()`     |\n\n---\n\n#### 6.3.8.2 code_values\n\n| Column     | Type | Constraints / Notes              |\n| ---------- | ---- | -------------------------------- |\n| id         | uuid | **pk**                           |\n| set_id     | uuid | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 80, "token_count": 204, "hash_short": "282d1077", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_081", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "| Column     | Type | Constraints / Notes              |\n| ---------- | ---- | -------------------------------- |\n| id         | uuid | **pk**                           |\n| set_id     | uuid | **fk ? code_sets.id**            |\n| code       | text | **unique** with `(set_id, code)` |\n| label      | text | display label                    |\n| sort_order | int  | for ordering                     |\n| is_active  | bool | default `true`                   |\n\n**Index:** `(set_id, sort_order)`.\n\n---\n\n#### 6.3.8.3 code_value_i18n\n\n| Column   | Type | Constraints / Notes                         |\n| -------- | ---- | ------------------------------------------- |\n| value_id | uuid | **pk** (composite), **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 81, "token_count": 176, "hash_short": "ed181daa", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_082", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "8.3 code_value_i18n\n\n| Column   | Type | Constraints / Notes                         |\n| -------- | ---- | ------------------------------------------- |\n| value_id | uuid | **pk** (composite), **fk ? code_values.id** |\n| lang     | text | **pk** (composite)                          |\n| label    | text | localized label                             |\n\n---\n\n#### 6.3.8.4 attributes\n\n| Column         | Type        | Constraints / Notes                                    |\n| -------------- | ----------- | ------------------------------------------------------ | ------- | ---- | ------- | ---- | ----------- | ----- | ----------- |\n| id             | uuid        | **pk**                                                 |\n| key            | text        | **unique**                                             |\n| label          | text        | not null                                               |\n| data_type      | text        | `int                                                   | numeric | text | boolean | date | timestamptz | jsonb | code_value` |\n| unit_set_key   | text        | nullable (links to `code_sets.key` if using unit sets) |\n| min_value      | numeric     | nullable                                               |\n| max_value      | numeric     | nullable                                               |\n| is_time_series | boolean     | default `true`                                         |\n| created_at     | timestamptz | default `now()`                                        |\n\n---", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 82, "token_count": 379, "hash_short": "66d3cee9", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_083", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| is_time_series | boolean     | default `true`                                         |\n| created_at     | timestamptz | default `now()`                                        |\n\n---\n\n\n#### 6.3.8.5 attribute_scopes\n\n| Column       | Type | Constraints / Notes                                     |\n| ------------ | ---- | ------------------------------------------------------- |\n| attribute_id | uuid | **pk** (composite), **fk ? attributes.id**              |\n| entity_type  | text | **pk** (composite); e.g., `body_measurement`, `session` |\n\n---\n\n#### 6.3.8.6 attribute_values\n\n| Column        | Type        | Constraints / Notes                   |\n| ------------- | ----------- | ------------------------------------- |\n| id            | uuid        | **pk**                                |\n| attribute_id  | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 83, "token_count": 209, "hash_short": "00afb102", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_084", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n| ------------- | ----------- | ------------------------------------- |\n| id            | uuid        | **pk**                                |\n| attribute_id  | uuid        | **fk ? attributes.id**                |\n| entity_type   | text        | scoped per `attribute_scopes`         |\n| entity_id     | uuid        | target entity id                      |\n| measured_at   | timestamptz | not null                              |\n| unit_value_id | uuid        | **fk ?", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 84, "token_count": 118, "hash_short": "7b1a904f", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_085", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "copes`         |\n| entity_id     | uuid        | target entity id                      |\n| measured_at   | timestamptz | not null                              |\n| unit_value_id | uuid        | **fk ? code_values.id** (unit)        |\n| int_value     | bigint      | one-of value columns                  |\n| numeric_value | numeric     | one-of                                |\n| text_value    | text        | one-of                                |\n| bool_value    | boolean     | one-of                                |\n| date_value    | date        | one-of                                |\n| ts_value      | timestamptz | one-of                                |\n| json_value    | jsonb       | one-of                                |\n| code_value_id | uuid        | **fk ? code_values.id** (coded value) |\n\n**Checks:** exactly one value column is non-null; value domain matches `attributes.data_type`.\n**Index:** `(entity_type, entity_id, attribute_id, measured_at DESC)`.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 85, "token_count": 243, "hash_short": "809819e0", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_086", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "ode_values.id** (coded value) |\n\n**Checks:** exactly one value column is non-null; value domain matches `attributes.data_type`.\n**Index:** `(entity_type, entity_id, attribute_id, measured_at DESC)`.\n\n---\n\n## 6.4 Extensibility Layer\n\n### 6.4.1 Enumerations ? `code_sets` / `code_values`\n\nAll former enums (status, visibility, difficulty, set types, etc.) are **data-driven**:\n\n- `code_sets(key)` ? set (e.g., `session_status`, `visibility`, `muscle_group`).\n- `code_values(set_id, code, label)` ? values within a set.\n- Domain tables reference **`code_values.id`** (e.g., `sessions.status_id`).\n\n**Benefits:** runtime additions, localization via `code_value_i18n`, central governance, consistent analytics.\n\n### 6.4.2 Attributes (typed EAV) ? `attributes` / `attribute_values`\n\nFast expansion for metrics without migrations:\n\n- `attributes` defines a key, label, type (`int|numeric|text|boolean|date|timestamptz|jsonb|code_value`), optional unit set.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 86, "token_count": 237, "hash_short": "95ea5fe8", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_087", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "tes` / `attribute_values`\n\nFast expansion for metrics without migrations:\n\n- `attributes` defines a key, label, type (`int|numeric|text|boolean|date|timestamptz|jsonb|code_value`), optional unit set.\n- `attribute_scopes` restricts valid entity types (e.g., `body_measurement`, `recovery_log`, `exercise_set`).\n- `attribute_values` stores **exactly one** of the typed value columns per row (enforced by a CHECK).\n- Units and coded values link to **`code_values`**.\n\n**Recommended use:**\n\n- Keep **hot fields** in base tables (e.g., `weight_kg`, `rpe`).\n- Put **expanding/long-tail** metrics in attributes (e.g., HRV, circumference variants, readiness scores).\n\n---\n\n## 6.5 Internationalization\n\n- `translation_fields(entity_type, field_key)` is the **allow-list** to prevent junk keys.\n- `translations` stores localized text per field (unique on `entity_type, entity_id, lang, field_key`).\n- `translation_cache` may store pre-rendered or AI-generated translations; not SoT.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 87, "token_count": 243, "hash_short": "a7c1886e", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_088", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "junk keys.\n- `translations` stores localized text per field (unique on `entity_type, entity_id, lang, field_key`).\n- `translation_cache` may store pre-rendered or AI-generated translations; not SoT.\n\n---\n\n## 6.6 Data Integrity & Constraints\n\n**Keys & constraints**\n\n- All IDs `uuid`, timestamps `timestamptz`.\n- Composite PKs: `user_roles(user_id, role_id)`, `exercise_tags(exercise_id, tag_id)`, `followers(follower_id, followee_id)`, etc.\n- Partial unique: `personal_records(user_id, exercise_id, metric) WHERE is_current=true`.\n- Ordering uniques: `session_exercises(session_id, order_index)` and `exercise_sets(session_exercise_id, order_index)`.\n\n**ON DELETE policies (high-level)**\n\n- **CASCADE** for dependent private data: `profiles`, `user_sessions`, `followers`, `likes`, `bookmarks`, `badges`, etc.\n- **SET NULL** where history should persist detached: `verification_tokens.user_id`, `reset_tokens.user_id`, `share_links` targets.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 88, "token_count": 235, "hash_short": "03317745", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_089", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "`user_sessions`, `followers`, `likes`, `bookmarks`, `badges`, etc.\n- **SET NULL** where history should persist detached: `verification_tokens.user_id`, `reset_tokens.user_id`, `share_links` targets.\n- **No cascade** for historical facts that must remain unless specifically noted.\n\n**Critical CHECKs**\n\n- `followers`: `follower_id != followee_id`.\n- `share_links`: exactly one of (`feed_item_id`, `session_id`) is set.\n- `exercise_sets.rpe`: 1..10.\n- **Session lifecycle** (application/DB):\n  - `planned`: `started_at IS NULL AND completed_at IS NULL`\n  - `in_progress`: `started_at IS NOT NULL AND completed_at IS NULL`\n  - `completed`: `started_at IS NOT NULL AND completed_at IS NOT NULL`\n\n---\n\n## 6.7 Indexing & Partitioning\n\n**Hot-path indices**\n\n- Sessions: `(owner_id, status, planned_at DESC)` and partial `WHERE deleted_at IS NULL`.\n- Feed: `(visibility_id, published_at DESC)` and public partial index.\n- PRs: partial `WHERE is_current=true` on `(user_id, exercise_id, metric)`.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 89, "token_count": 247, "hash_short": "3b6796f4", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_090", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "ed_at DESC)` and partial `WHERE deleted_at IS NULL`.\n- Feed: `(visibility_id, published_at DESC)` and public partial index.\n- PRs: partial `WHERE is_current=true` on `(user_id, exercise_id, metric)`.\n- Notifications: `(user_id, created_at DESC) WHERE is_read=false AND (expires_at IS NULL OR expires_at>now())`.\n- Translations: `(lang, entity_type, entity_id)`.\n- Attributes: `(entity_type, entity_id, attribute_id, measured_at DESC)`.\n\n**Partitioning**\n\n- **sessions**: monthly range partitions on `planned_at` (or `started_at` if present). Keep a **default** partition. Archive or detach partitions = 24 months old.\n- **audit_log**, **user_points**: consider monthly partitions at scale; else retain single table + time-based retention and vacuum tuning.\n- Optional: cold partitions on cheaper storage; keep query router aware of active windows.\n\n---\n\n## 6.8 Soft-Delete, Archival & Retention\n\n- **Soft delete**: `users.deleted_at`, `feed_items.deleted_at`, `sessions.deleted_at`.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 90, "token_count": 245, "hash_short": "73406072", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_091", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "s on cheaper storage; keep query router aware of active windows.\n\n---\n\n## 6.8 Soft-Delete, Archival & Retention\n\n- **Soft delete**: `users.deleted_at`, `feed_items.deleted_at`, `sessions.deleted_at`.\n- **Archive**: content catalogs like `exercises.archived_at`, `workout_templates.archived_at`.\n- **GDPR / DSR**: private user content cascaded or anonymized per controller policy; backup purge = 14 days.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 91, "token_count": 100, "hash_short": "ef2c4858", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_092", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "rchive**: content catalogs like `exercises.archived_at`, `workout_templates.archived_at`.\n- **GDPR / DSR**: private user content cascaded or anonymized per controller policy; backup purge = 14 days.\n\n| Table                          | Classification                 | Default Retention       | Delete / DSR Behavior                                                              |\n| ------------------------------ | ------------------------------ | ----------------------- | ---------------------------------------------------------------------------------- |\n| users                          | PII-S                          | Lifetime of account     | Tombstone then hard-delete after grace; cascade/anonymize children per table rules |\n| profiles                       | PII-B                          | Lifetime                | Hard-delete with user                                                              |\n| user_sessions                  | PII-S                          | 90d active, 30d revoked | Hard-delete                                                                        |\n| verification_tokens            | PII-S                          | TTL (e.g., 15m/1h)      | Auto-purge on expire/consume                                                       |\n| reset_tokens                   | PII-S                          | TTL (e.g., 15m/24h)     | Auto-purge                                                                         |\n| exercise_categories            | Public/Admin                   | N/A                     | Keep                                                                               |\n| tags                           | Public/Admin                   | N/A                     | Keep                                                                               |\n| exercises (global)             | Public/Admin                   | N/A                     | Archive via `archived_at`                                                          |\n| exercises (user-owned)         | Usage/PII-B                    | Lifetime of user        | Hard-delete on DSR                                                                 |\n| exercise_tags                  | Usage                          | Lifetime of parent      | Cascade with `exercises`                                                           |\n| plans                          | Usage                          | Lifetime of user        | Hard-delete on DSR                                                                 |\n| workout_templates              | Usage                          | Lifetime of user        | Soft archive or hard-delete on DSR                                                 |\n| template_muscle_groups         | Usage                          | Lifetime of parent      | Cascade with `workout_templates`                                                   |\n| template_exercises             | Usage                          | Lifetime of parent      | Cascade with `workout_templates`                                                   |\n| template_ratings               | Usage/PII-B                    | Lifetime of user        | Hard-delete on DSR                                                                 |\n| sessions                       | Usage (may include sensitive)  | Lifetime of user        | Hard-delete on DSR                                                                 |\n| session_exercises / sets       | Usage                          | Lifetime of session     | Cascade with session                                                               |\n| personal_records               | Usage/PII-B                    | Lifetime of user        | Hard-delete on DSR                                                                 |\n| body_measurements              | PII-B                          | Lifetime of user        | Hard-delete on DSR                                                                 |\n| recovery_logs                  | PII-B                          | Lifetime of user        | Hard-delete on DSR                                                                 |\n| user_points                    | Usage                          | Lifetime of user        | Hard-delete on DSR                                                                 |\n| badge_catalog                  | Public/Admin                   | N/A                     | Keep                                                                               |\n| badges (awarded)               | Usage                          | Lifetime of user        | Hard-delete on DSR                                                                 |\n| feed_items                     | Usage/PII-B                    | Lifetime of user        | Hard-delete on DSR (soft delete via `deleted_at`)                                  |\n| feed_likes                     | Usage                          | Lifetime of user        | Cascade with user                                                                  |\n| feed_comments                  | Usage/PII-B                    | Lifetime of user        | Hard-delete on DSR (soft delete via `deleted_at`)                                  |\n| session_bookmarks              | Usage                          | Lifetime of user        | Cascade with user                                                                  |\n| share_links                    | Usage                          | Lifetime of user        | Cascade with creator (`created_by`)                                                |\n| followers                      | Usage                          | Lifetime of user        | Cascade with user                                                                  |\n| user_blocks                    | Usage                          | Lifetime of user        | Cascade with user                                                                  |\n| feed_reports                   | Operational/PII-B              | 24 months               | Preserve for moderation audit; anonymize reporter on DSR if needed                 |\n| mv_leaderboard                 | Cache                          | 30-90d                  | Refresh via job; purgeable                                                         |\n| code_sets / code_values / i18n | System config                  | Lifetime                | Keep                                                                               |\n| attributes / scopes / values   | Usage/PII-B (depends on scope) | Lifetime of user        | Hard-delete on DSR                                                                 |\n\n> **Backups:** ensure purge **= 14 days** after DSR hard-delete finalization", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 92, "token_count": 1680, "hash_short": "323853ec", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_093", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "on scope) | Lifetime of user        | Hard-delete on DSR                                                                 |\n\n> **Backups:** ensure purge **= 14 days** after DSR hard-delete finalization.\n\n---\n\n## 6.9 Migration\n\n1. **Enums ? code values**\n   Add `*_id` FK columns, backfill from old text codes, then make `NOT NULL` and (optionally) drop legacy text columns.\n\n2. **Attributes enablement**\n   Seed `attributes` and `attribute_scopes`; start writing new metrics to `attribute_values`.\n   Keep existing hot columns for performance.\n\n3. **Integrity**\n   Ensure all composite PKs/uniques are created; enforce session lifecycle checks and `share_links` XOR check.\n\n4. **Indexes**\n   Create the hot-path indices; run `EXPLAIN ANALYZE` on feed and sessions queries to validate plans.\n\n## 6.9.1 Migrations Strategy (Knex)\n\n- **Pattern**: _expand/contract_. Forward migrations add schema + backfill; destructive changes guarded and scheduled. Prod down-migrations may be no-op.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 93, "token_count": 245, "hash_short": "df387e97", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_094", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "plans.\n\n## 6.9.1 Migrations Strategy (Knex)\n\n- **Pattern**: _expand/contract_. Forward migrations add schema + backfill; destructive changes guarded and scheduled. Prod down-migrations may be no-op.\n- **Naming**: `YYYYMMDDHHMM__description.sql`\n- **Transactional**: use transactional DDL where supported.\n- **Seeds**: only global/config (no PII).\n\n### 6.9.2 Ordered Migration List (MVP+)\n\n1. `...__create_extensions_uuid_citext_trgm.sql`\n2. `...__code_sets_values_i18n.sql` _(seed core sets)_\n3. `...__users_roles_profiles_sessions.sql`\n4. `...__tokens_verify_reset.sql`\n5. `...__catalog_categories_tags.sql`\n6. `...__exercises_core.sql`\n7. `...__i18n_translation_fields_and_translations.sql` _(seed allow-list)_\n8. `...__planning_plans_templates.sql` _(workout_templates, template_muscle_groups, template_exercises, template_ratings)_\n9. `...__sessions_details.sql` _(session_exercises, exercise_sets)_\n10. `...__progress_personal_records_body_recovery.sql`\n11.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 94, "token_count": 240, "hash_short": "b1d7de95", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_095", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "emplates, template_muscle_groups, template_exercises, template_ratings)_\n9. `...__sessions_details.sql` _(session_exercises, exercise_sets)_\n10. `...__progress_personal_records_body_recovery.sql`\n11. `...__social_graph_and_feed.sql` _(followers, feed_items, likes, bookmarks, comments, share_links, notifications)_\n12. `...__points_and_badges.sql` _(user_points, mv_leaderboard, badges, badges)_\n13. `...__media_assets.sql`\n14. `...__leaderboards_global_scoped.sql`\n15. `...__attributes_scopes_values.sql`\n16. `...__idempotency_and_audit.sql`\n17. `...__indexes_and_constraints_pass.sql` _(all partial/unique/check indexes)_\n18. `...__policies_and_retention.sql` _(optional, RLS/TTL/cron)_\n\n---\n\n## 6.10 Entity Cheat-Sheet (selected)\n\n- **User profile visibility** ? `profiles.visibility_id ? code_values(visibility)`.\n- **Session status/visibility** ? `sessions.status_id`, `sessions.visibility_id`.\n- **Exercise typing** ? `exercises.type_id`, `muscle_group_id`, `equipment_id`.\n- **Set metadata**", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 95, "token_count": 249, "hash_short": "497e91b9", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_096", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "lues(visibility)`.\n- **Session status/visibility** ? `sessions.status_id`, `sessions.visibility_id`.\n- **Exercise typing** ? `exercises.type_id`, `muscle_group_id`, `equipment_id`.\n- **Set metadata** ? `exercise_sets.set_type_id` (+ `tempo`, `rest_sec`, `completed`).\n- **Template difficulty** ? `workout_templates.difficulty_id`.\n- **Notifications** ? `type_id`, `priority_id`, `target_type_id`.\n- **Leaderboards** ? global and scoped variants; `scope_type_id` classifies scope.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 96, "token_count": 119, "hash_short": "2a703d34", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_097", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "difficulty** ? `workout_templates.difficulty_id`.\n- **Notifications** ? `type_id`, `priority_id`, `target_type_id`.\n- **Leaderboards** ? global and scoped variants; `scope_type_id` classifies scope.\n\n---\n\n## 6.11 Indexing Strategy & Hot Query Map\n\n| Endpoint / Query          | Purpose                           | Suggested Index / Note                                                                                                                                                                                              |\n| ------------------------- | --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| GET `/sessions?from..to`  | List by owner + time + status     | `CREATE INDEX idx_sessions_owner_status_time ON sessions(owner_id, status_id, planned_at DESC) WHERE deleted_at IS NULL;`                                                                                           |\n| GET `/sessions?completed` | Completed by owner (recent first) | `CREATE INDEX idx_sessions_completed ON sessions(owner_id, completed_at DESC) WHERE status_id = <completed_id>;`                                                                                                    |\n| GET `/exercises/search`   | Text + tag filter                 | Enable `pg_trgm`: `CREATE EXTENSION IF NOT EXISTS pg_trgm;`<br>`CREATE INDEX idx_exercises_name_trgm ON exercises USING gin (name gin_trgm_ops);`<br>`CREATE INDEX idx_exercise_tags_tag ON exercise_tags(tag_id);` |\n| GET `/feed` (public)      | Public timeline                   | `CREATE INDEX idx_feed_public_recent ON feed_items(published_at DESC) WHERE visibility_id = <public_id> AND deleted_at IS NULL;`                                                                                    |\n| GET `/users/:alias`       | Resolve profile by alias          | Prefer `citext`: `ALTER TABLE profiles ALTER COLUMN alias TYPE citext;` + `CREATE UNIQUE INDEX profiles_alias_key ON profiles(alias);`                                                                              |\n| Points ledger by period   | User points paging                | `CREATE INDEX idx_points_user_created ON user_points(user_id, created_at DESC);`                                                                                                                                    |\n| Badge awards by user      | Profile badges                    | `CREATE INDEX idx_badges_user ON badges(user_id, awarded_at DESC);`                                                                                                                                                 |\n| Media by target           | Attachments listing               | `CREATE INDEX idx_media_target ON media_assets(target_type_id, target_id);`                                                                                                                                         |\n| Notifications (unread)    | Polling latest                    | `CREATE INDEX idx_notifications_user_unread ON notifications(user_id, created_at DESC) WHERE is_read = FALSE AND (expires_at IS NULL OR expires_at > NOW());`                                                       |\n| Attributes readback       | Latest time-series values         | `CREATE INDEX idx_attr_values_read ON attribute_values(entity_type, entity_id, attribute_id, measured_at DESC);`                                                                                                    |\n\n> Validate with `EXPLAIN ANALYZE` during load tests", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 97, "token_count": 915, "hash_short": "011db2ca", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_098", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": ", entity_id, attribute_id, measured_at DESC);`                                                                                                    |\n\n> Validate with `EXPLAIN ANALYZE` during load tests. Balance read speed vs. write cost; avoid redundant multicolumn indexes when single-column + sort is enough.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 98, "token_count": 77, "hash_short": "94415359", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_099", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "|\n\n> Validate with `EXPLAIN ANALYZE` during load tests. Balance read speed vs. write cost; avoid redundant multicolumn indexes when single-column + sort is enough.\n\n---\n\n## 6.12 Seed Data Policy\n\n- **code_sets/code_values (minimum):**\n  - `visibility`: `private`, `link`, `follower`, `public`\n  - `session_status`: `planned`, `in_progress`, `completed`, `canceled`\n  - `user_status`: `active`, `suspended`, `deleted`\n  - `gender`: `man`, `woman`, `diverse`, `prefer_not_to_say`\n  - `measurement_system`: `metric`, `imperial`, `mixed`\n  - `weight_unit`: `kg`, `lb`\n  - `fitness_level`: `beginner`, `intermediate`, `advanced`, `elite`\n  - `training_frequency`: `rarely`, `1_2_per_week`, `3_4_per_week`, `5_plus_per_week`\n  - `exercise_type`, `muscle_group`, `equipment`\n  - `set_type`: `working`, `warmup`, `dropset`, `amrap`, `failure`\n  - `feed_kind`, `target_type`, `media_kind`\n  - `notification_type`: `like`, `comment`, `follow`, `pr`, `badge`, `mention`\n  - `priority`: `low`, `normal`, `high`\n  - `leaderboard_scope_type`: `club`, `challenge`, `group`\n- **translation_fields** (allow-list):\n  `(exercise, name)`, `(exercise, description)`, `(exercise, instructions)`, `(badge, title)`, `(badge, description)`, `(workout_template, name)`, `(workout_template, description)`, `(exercise_category, title)`", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 99, "token_count": 326, "hash_short": "d6d198c9", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_100", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "se, name)`, `(exercise, description)`, `(exercise, instructions)`, `(badge, title)`, `(badge, description)`, `(workout_template, name)`, `(workout_template, description)`, `(exercise_category, title)`.\n- **exercise_categories**: seed minimal curated set.\n- **global exercises** (admin-owned): Squat, Bench Press, Deadlift, Run, Ride, Plank (minimal, high-quality).\n\n> All seeds are **idempotent** and environment-scoped.\n\n---\n\n## 6.13 Data Quality & Integrity Rules\n\n- **Referential integrity**: FKs with explicit `ON DELETE` (cascade for session children; set-null where audit needs to persist).\n- **Enumerations via FKs**: prefer `code_values` over CHECKs for domain lists. Use CHECKs for invariants (e.g., `rpe BETWEEN 1 AND 10`, session lifecycle timestamps, `share_links` XOR FK rule).\n- **Soft-delete discipline**: all queries include `deleted_at IS NULL` where applicable; define partial indexes for hot paths.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 100, "token_count": 229, "hash_short": "1ba0afd9", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_101", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "EEN 1 AND 10`, session lifecycle timestamps, `share_links` XOR FK rule).\n- **Soft-delete discipline**: all queries include `deleted_at IS NULL` where applicable; define partial indexes for hot paths.\n- **Text search**: `pg_trgm` for fuzzy name search; consider tsvector if we expand full-text.\n- **Caching/derived**: keep `mv_leaderboard`, leaderboard caches, and translation cache rebuildable; document refresh cadence.\n- **Transactions**: nested session writes are atomic; idempotency enforced via `(user_id, source, source_id)` in `user_points`.\n\n---\n\n## 6.14 Backups, Restore & DR (Pointers)\n\n- Automated daily full backups; PITR if supported.\n- Verify restores monthly in staging; document RPO=24h/RTO=4h in �12 runbooks.\n- Encryption at rest for backups; access controlled and audited.\n\n---\n\n**Compliance**: This schema realizes PRD FR-1...FR-8 with GDPR-aligned classification and retention. Changes require accompanying ADRs and updated QA RTM rows.", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 101, "token_count": 239, "hash_short": "c7b208a1", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data_chunk_102", "doc_id": ".._.._docs_2.Technical_Design_Document_2c.Technical_Design_Document_Data", "text": "; access controlled and audited.\n\n---\n\n**Compliance**: This schema realizes PRD FR-1...FR-8 with GDPR-aligned classification and retention. Changes require accompanying ADRs and updated QA RTM rows.\n\n---\n\n- See also [Tech Stack](./2a.Technical_Design_Document_TechStack.md)\n- See also [Modules](./2b.Technical_Design_Document_Modules.md)\n- See also [Design & Architecture](./2d.Technical_Design_Document_APIDesign.md)\n- See also [Other](./2e.Technical_Design_Document_misc.md)", "source_file": "../../docs/2.Technical_Design_Document/2c.Technical_Design_Document_Data.md", "category": "technical", "chunk_index": 102, "token_count": 119, "hash_short": "4ea2d74c", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-24T01:07:01.683042", "ingested_at": "2025-11-30T04:00:42.046516", "tags": ["technical", "md"]}
