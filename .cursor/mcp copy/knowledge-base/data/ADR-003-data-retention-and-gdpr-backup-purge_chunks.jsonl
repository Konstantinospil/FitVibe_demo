{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge_chunk_000", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge", "text": "# ADR-003 — Data Retention & GDPR Backup Purge Window\n\n> **File:** docs/adr/ADR-003-data-retention-and-gdpr-backup-purge.md  \n> **Purpose:** Define lawful data retention, deletion, and backup purge policies to meet GDPR and FitVibe’s PRD/SEC requirements.\n\n---\n\nid: ADR-003\ntitle: \"Data Retention & GDPR Backup Purge Window\"\nstatus: \"Accepted\"\ndate: \"2025-10-14\"\nowners: [\"Dr. Konstantinos Pilpilidis\"]\nversion: \"1.0\"\nlinks:\n\n- PRD: \"docs/1. Product Requirements Document.md#security--privacy-gdpr\"\n- TDD: \"docs/2. Technical Design Document v2.md#data-model--persistence\"\n- QA: \"docs/3. Testing and Quality Assurance Plan.md#compliance-and-data-governance-tests\"\n- Related:\n  - \"docs/adr/ADR-002-authentication-token-strategy.md\"\n  - \"docs/adr/ADR-005-partitioning-sessions-audit-log.md\"\n\n---\n\n\n## Context\n\nFitVibe processes user accounts, session logs, health-related workout data, and device/session metadata.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-003-data-retention-and-gdpr-backup-purge.md", "category": "technical", "chunk_index": 0, "token_count": 227, "hash_short": "02d6c765", "version": 1.0, "title": "ADR-003 — Data Retention & GDPR Backup Purge Window", "mtime": "2025-10-18T10:54:49.806900", "ingested_at": "2025-11-30T04:00:44.074618", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge_chunk_001", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge", "text": "oken-strategy.md\"\n  - \"docs/adr/ADR-005-partitioning-sessions-audit-log.md\"\n\n---\n\n\n## Context\n\nFitVibe processes user accounts, session logs, health-related workout data, and device/session metadata. GDPR requires **purpose limitation**, **data minimization**, **storage limitation**, and **the right to erasure** (Art. 5 & 17). We must define concrete **retention windows**, a **backup purge policy**, and a **restorable deletion** model that keeps backups lawful while enabling operational recovery.\n\n## Decision\n\nAdopt a **two‑phase deletion** (soft → hard) with **anonymization/pseudonymization** for analytics, and a **time‑boxed backup purge window**. Backups are encrypted and rotated; PII is purged from restorable media after the purge horizon.\n\n### Retention & Deletion Model\n\n- **Soft delete** user‑facing aggregates (e.g., sessions) via `deleted_at`.\n- **Hard delete** PII after grace periods; replace with anonymized aggregates when useful.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-003-data-retention-and-gdpr-backup-purge.md", "category": "technical", "chunk_index": 1, "token_count": 238, "hash_short": "285852e0", "version": 1.0, "title": "ADR-003 — Data Retention & GDPR Backup Purge Window", "mtime": "2025-10-18T10:54:49.806900", "ingested_at": "2025-11-30T04:00:44.074618", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge_chunk_002", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge", "text": "### Retention & Deletion Model\n\n- **Soft delete** user‑facing aggregates (e.g., sessions) via `deleted_at`.\n- **Hard delete** PII after grace periods; replace with anonymized aggregates when useful.\n- **User Account Deletion (Right to Erasure)**:\n  - Immediate **account lock**, sessions revoked.\n  - Within **T+7 days**: hard delete credentials (`auth.credentials`), refresh tokens, access grants.\n  - Within **T+30 days**: hard delete PII in `auth.users` (email, names). Keep non‑identifying aggregates only if anonymized (e.g., workout stats without links to `user_id`).\n  - **Backup purge horizon**: **35 days** after T (≥ the longest online backup retention) to ensure erased data ages out from rotation.\n- **Device/session metadata**: retain **90 days** for security/audit, then purge or anonymize (IP hashes truncated).\n- **Audit trail for admin/security** (non‑content): retain **365 days**, then aggregate counts + drop PII.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-003-data-retention-and-gdpr-backup-purge.md", "category": "technical", "chunk_index": 2, "token_count": 233, "hash_short": "f90167a0", "version": 1.0, "title": "ADR-003 — Data Retention & GDPR Backup Purge Window", "mtime": "2025-10-18T10:54:49.806900", "ingested_at": "2025-11-30T04:00:44.074618", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge_chunk_003", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge", "text": "ta**: retain **90 days** for security/audit, then purge or anonymize (IP hashes truncated).\n- **Audit trail for admin/security** (non‑content): retain **365 days**, then aggregate counts + drop PII.\n\n### Backup & Restore Policy\n\n- **Backups**: Daily logical backups (pg_dump) + weekly base with daily WAL (if PITR enabled). **AES‑256** at rest; keys in KMS.\n- **Retention**: **14 days** rolling window. After day 35, backups containing erased PII are no longer retained.\n- **Restore Handling**: On restore older than T+35, a **post‑restore erasure job** re-applies tombstones from `system.erasure_ledger` to ensure previously erased subjects stay erased.\n- **Retention**: **14 days** rolling window. After day 14, backups containing erased PII are no longer retained.\n- **Restore Handling**: On restore older than T+14, a **post-restore erasure job** re-applies tombstones from `system.erasure_ledger` to ensure previously erased subjects stay erased.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-003-data-retention-and-gdpr-backup-purge.md", "category": "technical", "chunk_index": 3, "token_count": 237, "hash_short": "db80bc27", "version": 1.0, "title": "ADR-003 — Data Retention & GDPR Backup Purge Window", "mtime": "2025-10-18T10:54:49.806900", "ingested_at": "2025-11-30T04:00:44.074618", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge_chunk_004", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge", "text": "nger retained.\n- **Restore Handling**: On restore older than T+14, a **post-restore erasure job** re-applies tombstones from `system.erasure_ledger` to ensure previously erased subjects stay erased.\n\n### Data Map & Windows (MVP)\n\n| Domain   | Table(s)                               | Data Type                   | Retention                                                      | Deletion Mode                              |\n| -------- | -------------------------------------- | --------------------------- | -------------------------------------------------------------- | ------------------------------------------ |\n| Identity | `auth.users` (PII), `auth.credentials` | Email, names, password hash | Delete on request; otherwise **active + 24 months** inactivity | Hard delete PII; pseudonymize references   |\n| Sessions | `core.sessions`, `core.sets`           | Workout logs                | User delete → soft (immediate), hard at **30 days**            | Soft→Hard, aggregate anonymized stats kept |\n| Security | `auth.sessions`, `auth.refresh_tokens` | Device/session              | **90 days** rolling                                            | Hard delete                                |\n| Audit    | `system.audit_trails`                  | Events (low PII)            | **365 days**                                                   | Aggregate & drop PII                       |\n| Metrics  | time‑series                            | Non‑PII labels              | **13 months**                                                  | Natural TTL in TSDB                        |", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-003-data-retention-and-gdpr-backup-purge.md", "category": "technical", "chunk_index": 4, "token_count": 396, "hash_short": "7ec7ebdb", "version": 1.0, "title": "ADR-003 — Data Retention & GDPR Backup Purge Window", "mtime": "2025-10-18T10:54:49.806900", "ingested_at": "2025-11-30T04:00:44.074618", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge_chunk_005", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge", "text": "|\n| Metrics  | time‑series                            | Non‑PII labels              | **13 months**                                                  | Natural TTL in TSDB                        |\n\n\n### Anonymization & Pseudonymization\n\n- Replace `user_id` with random surrogate keys in analytics tables.\n- Hash emails for dedup where strictly needed (salted).\n- Drop or bin precise timestamps when aggregating (e.g., day‑level).\n\n### Operational Controls\n\n- **Erasure Ledger**: `system.erasure_ledger(subject_id, issued_at, completed_at, scope)` used to replay deletes after restores.\n- **DPO Review**: Changes to retention windows require DPO approval and ADR amendment.\n- **Access Controls**: Only compliance role can view `erasure_ledger` contents.\n\n## Consequences\n\n- Satisfies storage minimization and erasure obligations while remaining operable.\n- Backup purge horizon prevents indefinite storage of PII in cold media.\n- Extra operational complexity (erasure replay on restores).", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-003-data-retention-and-gdpr-backup-purge.md", "category": "technical", "chunk_index": 5, "token_count": 246, "hash_short": "c8630359", "version": 1.0, "title": "ADR-003 — Data Retention & GDPR Backup Purge Window", "mtime": "2025-10-18T10:54:49.806900", "ingested_at": "2025-11-30T04:00:44.074618", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge_chunk_006", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-003-data-retention-and-gdpr-backup-purge", "text": "e minimization and erasure obligations while remaining operable.\n- Backup purge horizon prevents indefinite storage of PII in cold media.\n- Extra operational complexity (erasure replay on restores).\n\n## Alternatives Considered\n\n- **Immediate hard deletion incl. backups**: Non‑viable with realistic restore needs.\n- **Indefinite backups**: Non‑compliant (storage limitation).\n\n## QA & Acceptance\n\n- Unit/integration tests for erasure flow.\n- Quarterly restore drill must replay `erasure_ledger` without residual PII.\n- Compliance checks confirming retention jobs remove data by schedule.\n\n## Backout Plan\n\nIf purge horizon causes operational risk, temporarily extend to **45 days** and document; never reduce without ensuring all existing rotations meet the new shorter window.\n\n## Change Log\n\n- **1.0 (2025-10-14)** Initial acceptance.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-003-data-retention-and-gdpr-backup-purge.md", "category": "technical", "chunk_index": 6, "token_count": 209, "hash_short": "6eacc152", "version": 1.0, "title": "ADR-003 — Data Retention & GDPR Backup Purge Window", "mtime": "2025-10-18T10:54:49.806900", "ingested_at": "2025-11-30T04:00:44.074618", "tags": ["technical", "md"]}
