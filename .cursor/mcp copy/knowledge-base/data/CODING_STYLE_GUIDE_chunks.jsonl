{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_000", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "# FitVibe Coding Style Guide\n\n**Version:** 2.1  \n**Last Updated:** 2025-01-20  \n**Scope:** React (Frontend) & Express (Backend)  \n**Status:** ✅ Complete - All high-priority enhancements added\n\nThis guide establishes coding standards and best practices for the FitVibe codebase. All code should follow these conventions to ensure consistency, maintainability, and quality.\n\n---\n\n\n## Table of Contents\n\n1. [TypeScript Conventions](#typescript-conventions)\n2. [React Patterns](#react-patterns)\n3. [Express Patterns](#express-patterns)\n4. [File Organization](#file-organization)\n5. [Naming Conventions](#naming-conventions)\n6. [Code Formatting](#code-formatting)\n7. [Error Handling](#error-handling)\n8. [Testing Patterns](#testing-patterns)\n9. [Security Guidelines](#security-guidelines)\n10. [Performance Best Practices](#performance-best-practices)\n11. [Validation Patterns](#validation-patterns)\n12. [Database Patterns](#database-patterns)\n13. [React Query Patterns](#react-query-patterns)\n14.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 0, "token_count": 247, "hash_short": "dedca8c6", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_001", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "formance Best Practices](#performance-best-practices)\n11. [Validation Patterns](#validation-patterns)\n12. [Database Patterns](#database-patterns)\n13. [React Query Patterns](#react-query-patterns)\n14. [State Management Patterns](#state-management-patterns)\n15. [API Client Patterns](#api-client-patterns)\n16. [Internationalization (i18n)](#internationalization-i18n)\n17. [Form Handling Patterns](#form-handling-patterns)\n18. [Environment Variables](#environment-variables)\n19. [Component Library Patterns](#component-library-patterns)\n20. [E2E Testing Patterns](#e2e-testing-patterns)\n21. [Code Review Guidelines](#code-review-guidelines)\n22. [Structured Logging Patterns](#structured-logging-patterns)\n23. [API Versioning Strategy](#api-versioning-strategy)\n24. [Observability Patterns](#observability-patterns)\n\n---\n\n## TypeScript Conventions\n\n### Type System\n\n- **Strict Mode**: Always use TypeScript strict mode. No `any` types in public surfaces.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 1, "token_count": 237, "hash_short": "c149872c", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_002", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "ategy)\n24. [Observability Patterns](#observability-patterns)\n\n---\n\n## TypeScript Conventions\n\n### Type System\n\n- **Strict Mode**: Always use TypeScript strict mode. No `any` types in public surfaces.\n- **Type Inference**: Prefer type inference where possible, but be explicit for public APIs.\n- **Interfaces vs Types**:\n  - Use `interface` for object shapes that may be extended\n  - Use `type` for unions, intersections, and computed types\n\n```typescript\n// ✅ Good: Interface for object shape\ninterface User {\n  id: string;\n  email: string;\n  role: \"user\" | \"admin\";\n}\n\n// ✅ Good: Type for union\ntype HttpMethod = \"GET\" | \"POST\" | \"PUT\" | \"DELETE\";\n\n// ✅ Good: Type for intersection\ntype AuthenticatedRequest = Request & { user: User };\n```\n\n### Import Organization\n\n1. External dependencies (React, Express, etc.)\n2. Internal modules (from `@fitvibe/*` or relative paths)\n3.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 2, "token_count": 218, "hash_short": "593a269a", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_003", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "ection\ntype AuthenticatedRequest = Request & { user: User };\n```\n\n### Import Organization\n\n1. External dependencies (React, Express, etc.)\n2. Internal modules (from `@fitvibe/*` or relative paths)\n3.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 3, "token_count": 49, "hash_short": "135249d0", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_004", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "Type-only imports (use `import type`)\n\n```typescript\n// ✅ Good: Organized imports\nimport React, { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport type { Request, Response } from \"express\";\n\nimport { logger } from \"../utils/logger.js\";\nimport type { User } from \"../types/user.js\";\n```\n\n### Type Imports\n\nAlways use `import type` for type-only imports to enable tree-shaking:\n\n```typescript\n// ✅ Good: Type-only import\nimport type { Request, Response, RequestHandler } from \"express\";\n\n// ❌ Bad: Regular import for types\nimport { Request, Response } from \"express\";\n```\n\n### Consistent Type Imports\n\nUse `@typescript-eslint/consistent-type-imports` rule (enforced):\n\n```typescript\n// ✅ Good\nimport type { User } from \"./types.js\";\nimport { createUser } from \"./service.js\";\n\n// ❌ Bad\nimport { User, createUser } from \"./service.js\";\n```\n\n---\n\n## React Patterns\n\n### Component Structure\n\n1. **Imports** (external → internal → types)\n2.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 4, "token_count": 244, "hash_short": "380d5448", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_005", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "rt { createUser } from \"./service.js\";\n\n// ❌ Bad\nimport { User, createUser } from \"./service.js\";\n```\n\n---\n\n## React Patterns\n\n### Component Structure\n\n1. **Imports** (external → internal → types)\n2. **Type definitions** (interfaces, types)\n3. **Constants** (if any)\n4. **Component definition**\n5.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 5, "token_count": 74, "hash_short": "0d4f88b1", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_006", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "```\n\n---\n\n## React Patterns\n\n### Component Structure\n\n1. **Imports** (external → internal → types)\n2. **Type definitions** (interfaces, types)\n3. **Constants** (if any)\n4. **Component definition**\n5. **Exports**\n\n```typescript\n// ✅ Good: Component structure\nimport React, { useState, useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport type { User } from \"../types/user\";\n\ninterface HomeProps {\n  userId: string;\n}\n\nconst Home: React.FC<HomeProps> = ({ userId }) => {\n  const { t } = useTranslation();\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = useCallback(async () => {\n    // Handler logic\n  }, []);\n\n  return <div>{/* JSX */}</div>;\n};\n\nexport default Home;\n```\n\n### Component Naming\n\n- **PascalCase** for component names\n- **Descriptive names** that indicate purpose\n- **Suffix with purpose** when needed: `Button`, `ButtonGroup`, `UserCard`\n\n```typescript\n// ✅ Good\nconst UserProfile: React.FC = () => {\n  /* ...", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 6, "token_count": 244, "hash_short": "d7f6e1ac", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_007", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "names\n- **Descriptive names** that indicate purpose\n- **Suffix with purpose** when needed: `Button`, `ButtonGroup`, `UserCard`\n\n```typescript\n// ✅ Good\nconst UserProfile: React.FC = () => {\n  /* ... */\n};\nconst AdminDashboard: React.FC = () => {\n  /* ... */\n};\n\n// ❌ Bad\nconst Profile: React.FC = () => {\n  /* ... */\n}; // Too generic\nconst Admin: React.FC = () => {\n  /* ...", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 7, "token_count": 93, "hash_short": "fa83ca5c", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_008", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": ".FC = () => {\n  /* ... */\n};\nconst AdminDashboard: React.FC = () => {\n  /* ... */\n};\n\n// ❌ Bad\nconst Profile: React.FC = () => {\n  /* ... */\n}; // Too generic\nconst Admin: React.FC = () => {\n  /* ...", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 8, "token_count": 49, "hash_short": "45f86725", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_009", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "*/\n}; // Unclear\n```\n\n### Hooks\n\n- **Custom hooks** start with `use` prefix\n- **Extract complex logic** into custom hooks\n- **Use `useCallback` and `useMemo`** appropriately (don't over-optimize)\n\n```typescript\n// ✅ Good: Custom hook\nfunction useUserData(userId: string) {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Fetch logic\n  }, [userId]);\n\n  return { user, loading };\n}\n\n// ✅ Good: Memoization when needed\nconst expensiveValue = useMemo(() => {\n  return computeExpensiveValue(data);\n}, [data]);\n\nconst handleClick = useCallback(() => {\n  doSomething(id);\n}, [id]);\n```\n\n### Props and State\n\n- **Explicit prop types** (no `any`)\n- **Default props** using default parameters\n- **State initialization** with proper types\n\n```typescript\n// ✅ Good: Explicit types and defaults\ninterface ButtonProps {\n  label: string;\n  onClick: () => void;\n  disabled?: boolean;\n  variant?: \"primary\" | \"secondary\";\n}\n\nconst Button: React.FC<ButtonProps> = ({\n  label,\n  onClick,\n  disabled = false,\n  variant = \"primary\",\n}) => {\n  // Component logic\n};\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 9, "token_count": 282, "hash_short": "4b440f5f", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_010", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "disabled?: boolean;\n  variant?: \"primary\" | \"secondary\";\n}\n\nconst Button: React.FC<ButtonProps> = ({\n  label,\n  onClick,\n  disabled = false,\n  variant = \"primary\",\n}) => {\n  // Component logic\n};\n```\n\n\n### Lazy Loading\n\nUse `React.lazy` for code splitting on route-level components:\n\n```typescript\n// ✅ Good: Lazy loading routes\nconst Home = lazy(() => import(\"../pages/Home\"));\nconst Sessions = lazy(() => import(\"../pages/Sessions\"));\n\n// Always wrap with Suspense\n<Suspense fallback={<LoadingSpinner />}>\n  <Routes>\n    <Route path=\"/\" element={<Home />} />\n  </Routes>\n</Suspense>\n```\n\n### Accessibility\n\n- **ARIA labels** for interactive elements\n- **Semantic HTML** (use `<button>`, not `<div>` with onClick)\n- **Keyboard navigation** support\n- **Focus management** for modals and dynamic content\n\n```typescript\n// ✅ Good: Accessible component\n<button\n  type=\"button\"\n  onClick={handleClick}\n  aria-label={t(\"common.submit\")}\n  aria-disabled={disabled}\n>\n  {label}\n</button>\n\n// ✅ Good: Loading state with ARIA\n<div role=\"status\" aria-live=\"polite\">\n  {loading", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 10, "token_count": 266, "hash_short": "9bdb7ff8", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_011", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "utton\"\n  onClick={handleClick}\n  aria-label={t(\"common.submit\")}\n  aria-disabled={disabled}\n>\n  {label}\n</button>\n\n// ✅ Good: Loading state with ARIA\n<div role=\"status\" aria-live=\"polite\">\n  {loading ? \"Loading...\" : content}\n</div>\n```\n\n---\n\n## Express Patterns\n\n### Route Handler Structure\n\n1. **Route definition** with middleware\n2. **Controller functions** (async, use `asyncHandler`)\n3. **Service layer** for business logic\n4.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 11, "token_count": 107, "hash_short": "e642d1de", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_012", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "```\n\n---\n\n## Express Patterns\n\n### Route Handler Structure\n\n1. **Route definition** with middleware\n2. **Controller functions** (async, use `asyncHandler`)\n3. **Service layer** for business logic\n4.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 12, "token_count": 49, "hash_short": "b22c021b", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_013", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "**Repository layer** for data access\n\n```typescript\n// ✅ Good: Route definition\nimport { Router } from \"express\";\nimport { requireAuth } from \"../users/users.middleware.js\";\nimport { requireRole } from \"../common/rbac.middleware.js\";\nimport { asyncHandler } from \"../../utils/async-handler.js\";\nimport * as controller from \"./logs.controller.js\";\n\nexport const logsRouter = Router();\n\nlogsRouter.use(requireAuth);\nlogsRouter.use(requireRole(\"admin\"));\n\nlogsRouter.get(\"/\", asyncHandler(controller.listLogsHandler));\nlogsRouter.get(\"/recent-activity\", asyncHandler(controller.recentActivityHandler));\n```\n\n### Controller Functions\n\n- **Async functions** that return `Promise<void>`\n- **Extract query/body/params** at the start\n- **Validate input** with Zod schemas\n- **Call service layer**, not repository directly\n- **Return JSON responses** with consistent structure\n\n```typescript\n// ✅ Good: Controller pattern\nimport type { Request, Response } from \"express\";\nimport * as service from \"./logs.service.js\";\nimport { validate } from \"../../utils/validation.js\";\nimport { listLogsSchema } from \"./logs.schemas.js\";\n\nexport async function listLogsHandler(req: Request, res: Response): Promise<void> {\n  // Extract and validate\n  const query = validate(listLogsSchema, \"query\")(req, res, () => {});\n\n  // Call service\n  const logs = await service.listLogs(query);\n\n  // Return response\n  res.json({ logs });\n}\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 13, "token_count": 352, "hash_short": "0d7252cf", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_014", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "and validate\n  const query = validate(listLogsSchema, \"query\")(req, res, () => {});\n\n  // Call service\n  const logs = await service.listLogs(query);\n\n  // Return response\n  res.json({ logs });\n}\n```\n\n\n### Middleware\n\n- **Type as `RequestHandler`** for consistency\n- **Use `asyncHandler`** wrapper for async middleware\n- **Return early** on errors (don't call `next()` after sending response)\n\n```typescript\n// ✅ Good: Middleware pattern\nimport type { Request, Response, NextFunction, RequestHandler } from \"express\";\n\nexport const requireAuth: RequestHandler = (req: Request, res: Response, next: NextFunction) => {\n  const header = req.headers.authorization;\n  if (!header || !header.startsWith(\"Bearer \")) {\n    return res.status(401).json({ error: \"Missing token\" });\n  }\n\n  try {\n    const token = header.split(\" \")[1];\n    const decoded = verifyAccess(token);\n    req.user = decoded;\n    next();\n  } catch {\n    return res.status(401).json({ error: \"Invalid token\" });\n  }\n};\n```\n\n### Service Layer\n\n- **Pure business logic** (no HTTP concerns)\n- **Async functions** returning typed results\n- **Error handling** with domain-specific errors\n- **Call repository layer** for data access\n\n```typescript\n// ✅ Good: Service pattern\nimport * as repo from \"./logs.repository.js\";\nimport type { AuditLogEntry, ListAuditLogsQuery } from \"./logs.types.js\";\n\nexport async function listLogs(query: ListAuditLogsQuery): Promise<AuditLogEntry[]> {\n  // Business logic here\n  return await repo.listAuditLogs(query);\n}\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 14, "token_count": 377, "hash_short": "6c003718", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_015", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "uditLogsQuery } from \"./logs.types.js\";\n\nexport async function listLogs(query: ListAuditLogsQuery): Promise<AuditLogEntry[]> {\n  // Business logic here\n  return await repo.listAuditLogs(query);\n}\n```\n\n\n### Repository Layer\n\n- **Database queries only** (use Knex.js)\n- **Type conversions** (snake_case → camelCase)\n- **Query building** with proper filtering\n- **No business logic**\n\n```typescript\n// ✅ Good: Repository pattern\nimport { db } from \"../../db/index.js\";\nimport type { AuditLogEntry, ListAuditLogsQuery } from \"./logs.types.js\";\n\nexport async function listAuditLogs(query: ListAuditLogsQuery): Promise<AuditLogEntry[]> {\n  let queryBuilder = db(\"audit_log as al\")\n    .select(\"al.id\", \"al.actor_user_id as actorUserId\" /* ...", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 15, "token_count": 184, "hash_short": "02b0e7aa", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_016", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "\";\n\nexport async function listAuditLogs(query: ListAuditLogsQuery): Promise<AuditLogEntry[]> {\n  let queryBuilder = db(\"audit_log as al\")\n    .select(\"al.id\", \"al.actor_user_id as actorUserId\" /* ...", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 16, "token_count": 49, "hash_short": "90a6a9ed", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_017", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "*/)\n    .orderBy(\"al.created_at\", \"desc\")\n    .limit(Math.min(query.limit || 100, 500))\n    .offset(query.offset || 0);\n\n  if (query.action) {\n    queryBuilder = queryBuilder.where(\"al.action\", query.action);\n  }\n\n  const rows = await queryBuilder;\n  return rows as AuditLogEntry[];\n}\n```\n\n### Error Handling\n\n- **Use `asyncHandler`** wrapper for route handlers\n- **Throw domain errors** in service layer\n- **Centralized error handler** middleware\n- **Consistent error response format**\n\n```typescript\n// ✅ Good: Error handling\nimport { asyncHandler } from \"../../utils/async-handler.js\";\nimport { HttpError } from \"../../utils/errors.js\";\n\nexport async function createUserHandler(req: Request, res: Response): Promise<void> {\n  const userData = req.body;\n\n  // Service throws HttpError on validation failure\n  const user = await userService.create(userData);\n\n  res.status(201).json({ user });\n}\n\n// Route uses asyncHandler\nrouter.post(\"/\", asyncHandler(createUserHandler));\n```\n\n---\n\n## File Organization", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 17, "token_count": 251, "hash_short": "68ceba9d", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_018", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "e\n  const user = await userService.create(userData);\n\n  res.status(201).json({ user });\n}\n\n// Route uses asyncHandler\nrouter.post(\"/\", asyncHandler(createUserHandler));\n```\n\n---\n\n## File Organization\n\n\n### Backend Structure\n\nFollow **folder-by-module** structure:\n\n```\napps/backend/src/modules/\n├── logs/\n│   ├── logs.routes.ts      # Route definitions\n│   ├── logs.controller.ts   # Request handlers\n│   ├── logs.service.ts     # Business logic\n│   ├── logs.repository.ts  # Data access\n│   ├── logs.types.ts       # TypeScript types\n│   ├── logs.schemas.ts     # Zod validation schemas\n│   └── __tests__/          # Tests\n│       ├── logs.controller.test.ts\n│       ├── logs.service.test.ts\n│       └── logs.repository.test.ts\n```\n\n### Frontend Structure\n\nFollow **feature-sliced architecture**:\n\n```\napps/frontend/src/\n├── pages/           # Route-level components\n├── components/      # Reusable UI components\n├── hooks/           # Custom React hooks\n├── services/        # API clients\n├── store/           # State management (Zustand)\n├── utils/           # Utility functions\n├── types/           # TypeScript types\n└── i18n/            # Internationalization\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 18, "token_count": 292, "hash_short": "637174db", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_019", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "# API clients\n├── store/           # State management (Zustand)\n├── utils/           # Utility functions\n├── types/           # TypeScript types\n└── i18n/            # Internationalization\n```\n\n\n### File Naming\n\n- **kebab-case** for file names: `user-profile.tsx`, `logs.controller.ts`\n- **Match export name**: File `user-profile.tsx` exports `UserProfile`\n- **Suffix with purpose**: `.controller.ts`, `.service.ts`, `.types.ts`\n\n```typescript\n// ✅ Good: File naming\n// File: user-profile.tsx\nexport const UserProfile: React.FC = () => {\n  /* ... */\n};\n\n// File: logs.controller.ts\nexport async function listLogsHandler() {\n  /* ... */\n}\n\n// File: logs.service.ts\nexport async function listLogs() {\n  /* ...", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 19, "token_count": 176, "hash_short": "47cdd457", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_020", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "erProfile: React.FC = () => {\n  /* ... */\n};\n\n// File: logs.controller.ts\nexport async function listLogsHandler() {\n  /* ... */\n}\n\n// File: logs.service.ts\nexport async function listLogs() {\n  /* ... */\n}\n```\n\n---\n\n## Naming Conventions\n\n### Variables and Functions\n\n- **camelCase** for variables and functions\n- **Descriptive names** that indicate purpose\n- **Boolean variables** prefixed with `is`, `has`, `should`, `can`\n\n```typescript\n// ✅ Good\nconst userName = \"john\";\nconst isAuthenticated = true;\nconst hasPermission = checkPermission();\nconst shouldShowModal = false;\n\nfunction getUserById(id: string) {\n  /* ... */\n}\nasync function createSession(data: SessionData) {\n  /* ...", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 20, "token_count": 171, "hash_short": "5aac7de2", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_021", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "henticated = true;\nconst hasPermission = checkPermission();\nconst shouldShowModal = false;\n\nfunction getUserById(id: string) {\n  /* ... */\n}\nasync function createSession(data: SessionData) {\n  /* ... */\n}\n```\n\n### Constants\n\n- **UPPER_SNAKE_CASE** for module-level constants\n- **PascalCase** for React component constants\n\n```typescript\n// ✅ Good: Module constants\nconst MAX_RETRY_ATTEMPTS = 3;\nconst DEFAULT_PAGE_SIZE = 20;\nconst API_BASE_URL = process.env.VITE_API_BASE_URL;\n\n// ✅ Good: Component constants\nconst VIBES: Vibe[] = [{ key: \"strength\" /* ... */ }, { key: \"agility\" /* ...", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 21, "token_count": 146, "hash_short": "3626e420", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_022", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "TS = 3;\nconst DEFAULT_PAGE_SIZE = 20;\nconst API_BASE_URL = process.env.VITE_API_BASE_URL;\n\n// ✅ Good: Component constants\nconst VIBES: Vibe[] = [{ key: \"strength\" /* ... */ }, { key: \"agility\" /* ...", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 22, "token_count": 49, "hash_short": "1e8583f1", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_023", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "*/ }];\n```\n\n### Types and Interfaces\n\n- **PascalCase** for types and interfaces\n- **Descriptive names** with context\n\n```typescript\n// ✅ Good\ninterface UserProfile {\n  id: string;\n  email: string;\n}\n\ntype HttpStatusCode = 200 | 201 | 400 | 401 | 404 | 500;\n\ntype SessionStatus = \"planned\" | \"in-progress\" | \"completed\" | \"cancelled\";\n```\n\n### Database Columns\n\n- **snake_case** in database (PostgreSQL convention)\n- **Convert to camelCase** in application layer\n\n```typescript\n// ✅ Good: Database → Application conversion\nconst rows = await db(\"users\").select(\n  \"id\",\n  \"email\",\n  \"created_at as createdAt\",\n  \"updated_at as updatedAt\",\n);\n```\n\n---\n\n## Code Formatting\n\n### Prettier Configuration\n\n- **Print width**: 100 characters\n- **Semicolons**: Always\n- **Quotes**: Double quotes\n- **Trailing commas**: Always\n- **Arrow parens**: Always\n\n```typescript\n// ✅ Good: Formatted code\nconst example = {\n  name: \"FitVibe\",\n  version: \"2.0.0\",\n  features: [\"auth\", \"sessions\", \"progress\"],\n};\n```\n\n### Line Breaks\n\n- **One statement per line**\n- **Break long lines** at logical points\n- **Align parameters** in function calls when needed\n\n```typescript\n// ✅ Good: Readable line breaks\nconst result = await service.createUser({\n  email: userData.email,\n  username: userData.username,\n  password: hashedPassword,\n});\n\n// ✅ Good: Aligned parameters\nrouter.post(\"/\", requireAuth, requireRole(\"admin\"), asyncHandler(createUserHandler));\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 23, "token_count": 358, "hash_short": "71455af4", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_024", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "userData.email,\n  username: userData.username,\n  password: hashedPassword,\n});\n\n// ✅ Good: Aligned parameters\nrouter.post(\"/\", requireAuth, requireRole(\"admin\"), asyncHandler(createUserHandler));\n```\n\n\n### Comments\n\n- **JSDoc comments** for public functions\n- **Inline comments** for complex logic\n- **Security comments** for security-related code (use `lgtm` directives)\n\n```typescript\n// ✅ Good: JSDoc for public API\n/**\n * List audit logs with optional filtering\n * @param query - Filtering parameters\n * @returns Array of audit log entries\n */\nexport async function listLogs(query: ListAuditLogsQuery): Promise<AuditLogEntry[]> {\n  return await repo.listAuditLogs(query);\n}\n\n// ✅ Good: Security comment\n// SECURITY: Double-submit cookie pattern for CSRF protection\n// The secret is stored in an HttpOnly cookie (not accessible to JavaScript),\n// sent only over HTTPS in production (secure flag), and uses SameSite to prevent CSRF.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 24, "token_count": 233, "hash_short": "a6b5e1dc", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_025", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "ookie pattern for CSRF protection\n// The secret is stored in an HttpOnly cookie (not accessible to JavaScript),\n// sent only over HTTPS in production (secure flag), and uses SameSite to prevent CSRF.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 25, "token_count": 49, "hash_short": "bcb1e511", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_026", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "// lgtm[js/clear-text-storage-of-sensitive-data] - HttpOnly + Secure + SameSite cookie is secure\nres.cookie(CSRF_COOKIE_NAME, secret, {\n  httpOnly: true,\n  sameSite: \"lax\",\n  secure: env.isProduction,\n});\n```\n\n---\n\n## Error Handling\n\n### Backend Errors\n\n- **Use `HttpError` class** for HTTP errors\n- **Throw errors** in service layer\n- **Catch in error handler** middleware\n- **Consistent error response format**\n\n```typescript\n// ✅ Good: Error handling pattern\nimport { HttpError } from \"../../utils/errors.js\";\n\nexport async function createUser(data: UserData): Promise<User> {\n  const existing = await userRepo.findByEmail(data.email);\n  if (existing) {\n    throw new HttpError(409, \"User with this email already exists\");\n  }\n\n  return await userRepo.create(data);\n}\n```\n\n### Frontend Errors\n\n- **Handle errors** in React Query or try/catch\n- **Show user-friendly messages** (use i18n)\n- **Log errors** for debugging\n\n```typescript\n// ✅ Good: Frontend error handling\nconst { data, error, isLoading } = useQuery({\n  queryKey: [\"user\", userId],\n  queryFn: () => fetchUser(userId),\n  onError: (err) => {\n    logger.error(\"Failed to fetch user\", err);\n    toast.error(t(\"errors.user.fetch\"));\n  },\n});\n```\n\n---", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 26, "token_count": 302, "hash_short": "05a9e3a9", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_027", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "ery({\n  queryKey: [\"user\", userId],\n  queryFn: () => fetchUser(userId),\n  onError: (err) => {\n    logger.error(\"Failed to fetch user\", err);\n    toast.error(t(\"errors.user.fetch\"));\n  },\n});\n```\n\n---\n\n\n## Testing Patterns\n\n### Test File Organization\n\n- **Co-locate tests** with source files\n- **Use `__tests__` directory** for test files\n- **Match test file names**: `logs.controller.test.ts`\n\n### Test Structure\n\n- **Describe blocks** for grouping\n- **Clear test names** that describe behavior\n- **Arrange-Act-Assert** pattern\n\n```typescript\n// ✅ Good: Test structure\nimport { describe, it, expect, jest, beforeEach } from \"@jest/globals\";\nimport type { Request, Response } from \"express\";\nimport * as controller from \"../logs.controller\";\nimport * as service from \"../logs.service\";\n\njest.mock(\"../logs.service\");\n\ndescribe(\"Logs Controller\", () => {\n  let mockReq: Partial<Request>;\n  let mockRes: Partial<Response>;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockRes = {\n      json: jest.fn(),\n      status: jest.fn().mockReturnThis(),\n    };\n  });\n\n  describe(\"listLogsHandler\", () => {\n    it(\"should return audit logs\", async () => {\n      // Arrange\n      const mockLogs = [{ id: \"1\" /* ..", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 27, "token_count": 301, "hash_short": "d681f7c9", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_028", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "status: jest.fn().mockReturnThis(),\n    };\n  });\n\n  describe(\"listLogsHandler\", () => {\n    it(\"should return audit logs\", async () => {\n      // Arrange\n      const mockLogs = [{ id: \"1\" /* ...", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 28, "token_count": 48, "hash_short": "d3d06625", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_029", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "status: jest.fn().mockReturnThis(),\n    };\n  });\n\n  describe(\"listLogsHandler\", () => {\n    it(\"should return audit logs\", async () => {\n      // Arrange\n      const mockLogs = [{ id: \"1\" /* ... */ }];\n      jest.mocked(service.listLogs).mockResolvedValue(mockLogs);\n      mockReq = { query: { limit: \"10\" } };\n\n      // Act\n      await controller.listLogsHandler(mockReq as Request, mockRes as Response);\n\n      // Assert\n      expect(service.listLogs).toHaveBeenCalled();\n      expect(mockRes.json).toHaveBeenCalledWith({ logs: mockLogs });\n    });\n  });\n});\n```\n\n---\n\n## Security Guidelines\n\n### Input Validation\n\n- **Always validate** user input with Zod schemas\n- **Sanitize** user-provided data\n- **Use parameterized queries** (Knex.js handles this)\n\n```typescript\n// ✅ Good: Input validation\nimport { z } from \"zod\";\nimport { validate } from \"../../utils/validation.js\";\n\nconst createUserSchema = z.object({\n  email: z.string().email(),\n  username: z.string().min(3).max(30),\n  password: z.string().min(12),\n});\n\nrouter.post(\"/\", validate(createUserSchema), asyncHandler(createUserHandler));\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 29, "token_count": 275, "hash_short": "60414a60", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_030", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "z.object({\n  email: z.string().email(),\n  username: z.string().min(3).max(30),\n  password: z.string().min(12),\n});\n\nrouter.post(\"/\", validate(createUserSchema), asyncHandler(createUserHandler));\n```\n\n\n### Authentication & Authorization\n\n- **Use `requireAuth` middleware** for protected routes\n- **Use `requireRole` middleware** for role-based access\n- **Never trust client data** - validate on server\n\n```typescript\n// ✅ Good: Protected routes\nrouter.use(requireAuth);\nrouter.use(requireRole(\"admin\"));\nrouter.get(\"/\", asyncHandler(listLogsHandler));\n```\n\n### Security Headers\n\n- **Helmet.js** configured in app setup\n- **CSRF protection** enabled for state-changing requests\n- **Rate limiting** on all public endpoints\n\n---\n\n## Performance Best Practices\n\n### Backend\n\n- **Database indexes** on frequently queried columns\n- **Query optimization** (avoid N+1 queries)\n- **Pagination** for list endpoints\n- **Caching** where appropriate (Redis)\n\n```typescript\n// ✅ Good: Pagination\nexport async function listLogs(query: ListAuditLogsQuery): Promise<AuditLogEntry[]> {\n  const limit = Math.min(query.limit || 100, 500); // Cap at 500\n  const offset = query.offset || 0;\n\n  return await db(\"audit_log\").limit(limit).offset(offset).orderBy(\"created_at\", \"desc\");\n}\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 30, "token_count": 316, "hash_short": "99ce03db", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_031", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "{\n  const limit = Math.min(query.limit || 100, 500); // Cap at 500\n  const offset = query.offset || 0;\n\n  return await db(\"audit_log\").limit(limit).offset(offset).orderBy(\"created_at\", \"desc\");\n}\n```\n\n\n### Frontend\n\n- **Code splitting** with React.lazy\n- **Memoization** for expensive computations\n- **Virtual scrolling** for long lists\n- **Image optimization** (lazy loading, WebP format)\n\n```typescript\n// ✅ Good: Code splitting\nconst Home = lazy(() => import(\"../pages/Home\"));\nconst Sessions = lazy(() => import(\"../pages/Sessions\"));\n\n// ✅ Good: Memoization\nconst expensiveValue = useMemo(() => {\n  return computeExpensiveValue(data);\n}, [data]);\n```\n\n---\n\n---\n\n## Validation Patterns\n\n### Zod Schema Design\n\n- **Co-locate schemas** with controllers in `*.schemas.ts` files\n- **Reuse common schemas** (UUIDs, emails, etc.)\n- **Use `.strict()`** to prevent extra properties\n- **Provide clear error messages** for validation failures\n\n```typescript\n// ✅ Good: Zod schema pattern\nimport { z } from \"zod\";\n\nconst createUserSchema = z\n  .object({\n    email: z.string().email(\"Invalid email format\"),\n    username: z.string().trim().min(3).max(30),\n    password: z.string().min(12, \"Password must be at least 12 characters\"),\n  })\n  .strict();\n\n// ✅ Good: Reusable schemas\nconst uuidSchema = z.string().uuid();\nconst emailSchema = z.string().email();\n\n// ✅ Good: Schema composition\nconst updateUserSchema = createUserSchema.partial().refine((data) => Object.keys(data).length > 0, {\n  message: \"At least one field must be provided\",\n});\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 31, "token_count": 384, "hash_short": "64b90206", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_032", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": ".email();\n\n// ✅ Good: Schema composition\nconst updateUserSchema = createUserSchema.partial().refine((data) => Object.keys(data).length > 0, {\n  message: \"At least one field must be provided\",\n});\n```\n\n\n### Validation Middleware\n\n- **Use `validate()` utility** for request validation\n- **Validate body, query, and params** separately\n- **Type-safe validated data** via `req.validated`\n\n```typescript\n// ✅ Good: Validation in routes\nimport { validate } from \"../../utils/validation.js\";\nimport { createUserSchema } from \"./users.schemas.js\";\n\nrouter.post(\"/\", validate(createUserSchema), asyncHandler(createUserHandler));\n\n// ✅ Good: Access validated data\nexport async function createUserHandler(req: Request, res: Response): Promise<void> {\n  const userData = (req as Request & { validated: z.infer<typeof createUserSchema> }).validated;\n  // userData is type-safe\n}\n```\n\n---\n\n## Database Patterns\n\n### Knex.js Query Patterns\n\n- **Use parameterized queries** (Knex handles this automatically)\n- **Convert snake_case to camelCase** in select statements\n- **Chain query builders** for conditional filtering\n- **Limit result sets** and use pagination\n\n```typescript\n// ✅ Good: Query builder pattern\nexport async function listUsers(query: ListUsersQuery): Promise<User[]> {\n  let queryBuilder = db(\"users\")\n    .select(\"id\", \"email\", \"created_at as createdAt\", \"updated_at as updatedAt\")\n    .orderBy(\"created_at\", \"desc\")\n    .limit(Math.min(query.limit || 100, 500))\n    .offset(query.offset || 0);\n\n  if (query.email) {\n    queryBuilder = queryBuilder.where(\"email\", query.email);\n  }\n\n  if (query.role) {\n    queryBuilder = queryBuilder.where(\"role\", query.role);\n  }\n\n  const rows = await queryBuilder;\n  return rows as User[];\n}\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 32, "token_count": 433, "hash_short": "6b6276f6", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_033", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "= queryBuilder.where(\"email\", query.email);\n  }\n\n  if (query.role) {\n    queryBuilder = queryBuilder.where(\"role\", query.role);\n  }\n\n  const rows = await queryBuilder;\n  return rows as User[];\n}\n```\n\n\n### Migration Patterns\n\n- **One migration per logical change**\n- **Always provide `down()` migration** for rollback\n- **Use transactions** for data migrations\n- **Name migrations descriptively**: `YYYYMMDDHHMMSS_description.ts`\n\n```typescript\n// ✅ Good: Migration pattern\nimport type { Knex } from \"knex\";\n\nexport async function up(knex: Knex): Promise<void> {\n  await knex.schema.createTable(\"users\", (table) => {\n    table.uuid(\"id\").primary().defaultTo(knex.raw(\"gen_random_uuid()\"));\n    table.string(\"email\").notNullable().unique();\n    table.timestamps(true, true);\n  });\n}\n\nexport async function down(knex: Knex): Promise<void> {\n  await knex.schema.dropTableIfExists(\"users\");\n}\n```\n\n---\n\n## React Query Patterns\n\n### Query Hooks\n\n- **Create custom hooks** for data fetching\n- **Use descriptive query keys** with dependencies\n- **Handle loading and error states** consistently\n- **Set appropriate cache times**\n\n```typescript\n// ✅ Good: Custom query hook\nimport { useQuery } from \"@tanstack/react-query\";\nimport { fetchUser } from \"../services/api\";\n\nexport function useUser(userId: string) {\n  return useQuery({\n    queryKey: [\"user\", userId],\n    queryFn: () => fetchUser(userId),\n    enabled: !!userId, // Only fetch if userId exists\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n}\n\n// ✅ Good: Query with error handling\nconst { data, error, isLoading } = useQuery({\n  queryKey: [\"sessions\", filters],\n  queryFn: () => fetchSessions(filters),\n  onError: (err) => {\n    logger.error(\"Failed to fetch sessions\", err);\n    toast.error(t(\"errors.sessions.fetch\"));\n  },\n});\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 33, "token_count": 446, "hash_short": "a4cc2703", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_034", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "Key: [\"sessions\", filters],\n  queryFn: () => fetchSessions(filters),\n  onError: (err) => {\n    logger.error(\"Failed to fetch sessions\", err);\n    toast.error(t(\"errors.sessions.fetch\"));\n  },\n});\n```\n\n\n### Mutation Hooks\n\n- **Use `useMutation`** for data modifications\n- **Invalidate related queries** on success\n- **Show optimistic updates** when appropriate\n- **Handle errors** with user-friendly messages\n\n```typescript\n// ✅ Good: Mutation hook\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\n\nexport function useCreateSession() {\n  const queryClient = useQueryClient();\n  const { t } = useTranslation();\n\n  return useMutation({\n    mutationFn: createSession,\n    onSuccess: () => {\n      // Invalidate related queries\n      queryClient.invalidateQueries({ queryKey: [\"sessions\"] });\n      toast.success(t(\"sessions.created\"));\n    },\n    onError: (err) => {\n      logger.error(\"Failed to create session\", err);\n      toast.error(t(\"errors.sessions.create\"));\n    },\n  });\n}\n```\n\n---", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 34, "token_count": 251, "hash_short": "21d686de", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_035", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "toast.success(t(\"sessions.created\"));\n    },\n    onError: (err) => {\n      logger.error(\"Failed to create session\", err);\n      toast.error(t(\"errors.sessions.create\"));\n    },\n  });\n}\n```\n\n---\n\n\n## State Management Patterns\n\n### Zustand Stores\n\n- **Co-locate stores** in `store/` directory\n- **Use TypeScript interfaces** for state shape\n- **Keep stores focused** (one store per domain)\n- **Use `persist` middleware** for localStorage when needed\n\n```typescript\n// ✅ Good: Zustand store pattern\nimport { create } from \"zustand\";\nimport { persist } from \"zustand/middleware\";\n\ninterface AuthState {\n  isAuthenticated: boolean;\n  user: User | null;\n  signIn: (user: User) => void;\n  signOut: () => void;\n}\n\nexport const useAuthStore = create<AuthState>()(\n  persist(\n    (set) => ({\n      isAuthenticated: false,\n      user: null,\n      signIn: (user) => set({ isAuthenticated: true, user }),\n      signOut: () => set({ isAuthenticated: false, user: null }),\n    }),\n    {\n      name: \"fitvibe:auth\",\n      version: 1,\n    },\n  ),\n);\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 35, "token_count": 259, "hash_short": "0999514d", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_036", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "ignIn: (user) => set({ isAuthenticated: true, user }),\n      signOut: () => set({ isAuthenticated: false, user: null }),\n    }),\n    {\n      name: \"fitvibe:auth\",\n      version: 1,\n    },\n  ),\n);\n```\n\n\n### Store Usage\n\n- **Select specific state** to avoid unnecessary re-renders\n- **Use selectors** for derived state\n- **Keep business logic** in services, not stores\n\n```typescript\n// ✅ Good: Selective state access\nconst isAuthenticated = useAuthStore((state) => state.isAuthenticated);\nconst user = useAuthStore((state) => state.user);\n\n// ❌ Bad: Accessing entire store\nconst authStore = useAuthStore(); // Causes re-render on any state change\n```\n\n---\n\n## API Client Patterns\n\n### Service Layer\n\n- **Group related API calls** in service files\n- **Use consistent error handling**\n- **Type request/response** with interfaces\n- **Export functions**, not classes\n\n```typescript\n// ✅ Good: API service pattern\nimport axios from \"axios\";\nimport type { User, CreateUserRequest } from \"../types/user\";\n\nconst api = axios.create({\n  baseURL: import.meta.env.VITE_API_BASE_URL,\n});\n\nexport async function createUser(data: CreateUserRequest): Promise<User> {\n  const response = await api.post<User>(\"/users\", data);\n  return response.data;\n}\n\nexport async function getUser(id: string): Promise<User> {\n  const response = await api.get<User>(`/users/${id}`);\n  return response.data;\n}\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 36, "token_count": 344, "hash_short": "d2485bdb", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_037", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "post<User>(\"/users\", data);\n  return response.data;\n}\n\nexport async function getUser(id: string): Promise<User> {\n  const response = await api.get<User>(`/users/${id}`);\n  return response.data;\n}\n```\n\n\n### Error Handling\n\n- **Catch and transform** API errors\n- **Provide user-friendly messages**\n- **Log errors** for debugging\n\n```typescript\n// ✅ Good: Error handling in API calls\ntry {\n  const user = await createUser(userData);\n  return user;\n} catch (error) {\n  if (axios.isAxiosError(error)) {\n    if (error.response?.status === 409) {\n      throw new Error(\"User already exists\");\n    }\n  }\n  logger.error(\"Failed to create user\", error);\n  throw error;\n}\n```\n\n---\n\n## Internationalization (i18n)\n\n### Translation Usage\n\n- **Use `useTranslation` hook** for translations\n- **Use translation keys** instead of hardcoded strings\n- **Organize keys** by feature/page\n- **Provide fallbacks** for missing translations\n\n```typescript\n// ✅ Good: i18n usage\nimport { useTranslation } from \"react-i18next\";\n\nconst MyComponent: React.FC = () => {\n  const { t } = useTranslation();\n\n  return (\n    <div>\n      <h1>{t(\"common.welcome\")}</h1>\n      <button>{t(\"actions.submit\")}</button>\n    </div>\n  );\n};\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 37, "token_count": 300, "hash_short": "d18b6c31", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_038", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "const MyComponent: React.FC = () => {\n  const { t } = useTranslation();\n\n  return (\n    <div>\n      <h1>{t(\"common.welcome\")}</h1>\n      <button>{t(\"actions.submit\")}</button>\n    </div>\n  );\n};\n```\n\n\n### Translation Keys\n\n- **Use dot notation** for nested keys: `sessions.list.title`\n- **Keep keys descriptive** and consistent\n- **Group by feature** in translation files\n\n```json\n// ✅ Good: Translation file structure\n{\n  \"common\": {\n    \"welcome\": \"Welcome\",\n    \"loading\": \"Loading...\",\n    \"error\": \"An error occurred\"\n  },\n  \"sessions\": {\n    \"list\": {\n      \"title\": \"My Sessions\",\n      \"empty\": \"No sessions found\"\n    }\n  }\n}\n```\n\n---\n\n## Form Handling Patterns\n\n### Controlled Components\n\n- **Use controlled inputs** with state\n- **Validate on submit** and on blur\n- **Show validation errors** clearly\n- **Disable submit** during submission\n\n```typescript\n// ✅ Good: Form handling\nconst [formData, setFormData] = useState({ email: \"\", password: \"\" });\nconst [errors, setErrors] = useState<Record<string, string>>({});\nconst [isSubmitting, setIsSubmitting] = useState(false);\n\nconst handleSubmit = async (e: React.FormEvent) => {\n  e.preventDefault();\n\n  // Validate\n  const newErrors: Record<string, string> = {};\n  if (!formData.email) newErrors.email = \"Email is required\";\n  if (!formData.password) newErrors.password = \"Password is required\";\n\n  if (Object.keys(newErrors).length > 0) {\n    setErrors(newErrors);\n    return;\n  }\n\n  setIsSubmitting(true);\n  try {\n    await createUser(formData);\n  } catch (error) {\n    // Handle error\n  } finally {\n    setIsSubmitting(false);\n  }\n};\n```\n\n---", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 38, "token_count": 401, "hash_short": "fc7e05d4", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_039", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "tErrors(newErrors);\n    return;\n  }\n\n  setIsSubmitting(true);\n  try {\n    await createUser(formData);\n  } catch (error) {\n    // Handle error\n  } finally {\n    setIsSubmitting(false);\n  }\n};\n```\n\n---\n\n\n## Environment Variables\n\n### Backend\n\n- **Use `env` config module** for type-safe access\n- **Validate required variables** on startup\n- **Never commit** `.env` files\n- **Document required variables** in README\n\n```typescript\n// ✅ Good: Environment variable handling\nimport { z } from \"zod\";\n\nconst envSchema = z.object({\n  DATABASE_URL: z.string().url(),\n  JWT_SECRET: z.string().min(32),\n  NODE_ENV: z.enum([\"development\", \"test\", \"production\"]),\n});\n\nexport const env = envSchema.parse(process.env);\n```\n\n### Frontend\n\n- **Prefix with `VITE_`** for Vite to expose\n- **Access via `import.meta.env`**\n- **Provide defaults** when appropriate\n- **Type with `vite-env.d.ts`**\n\n```typescript\n// ✅ Good: Frontend env usage\nconst apiBaseUrl = import.meta.env.VITE_API_BASE_URL || \"http://localhost:4000/api/v1\";\n\n// ✅ Good: Type definition\n/// <reference types=\"vite/client\" />\n\ninterface ImportMetaEnv {\n  readonly VITE_API_BASE_URL: string;\n  readonly VITE_APP_NAME: string;\n}\n```\n\n---", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 39, "token_count": 296, "hash_short": "20f10008", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_040", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "localhost:4000/api/v1\";\n\n// ✅ Good: Type definition\n/// <reference types=\"vite/client\" />\n\ninterface ImportMetaEnv {\n  readonly VITE_API_BASE_URL: string;\n  readonly VITE_APP_NAME: string;\n}\n```\n\n---\n\n\n## Component Library Patterns\n\n### UI Component Structure\n\n- **Co-locate components** in `components/ui/` for reusable primitives\n- **Use composition** over configuration\n- **Support polymorphic `as` prop** for flexibility\n- **Export from index** for clean imports\n\n```typescript\n// ✅ Good: Reusable UI component\nimport React, { forwardRef } from \"react\";\n\nexport interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: \"primary\" | \"secondary\" | \"ghost\" | \"danger\";\n  size?: \"sm\" | \"md\" | \"lg\";\n  isLoading?: boolean;\n  leftIcon?: React.ReactNode;\n  rightIcon?: React.ReactNode;\n}\n\nexport const Button = forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ variant = \"primary\", size = \"md\", isLoading, children, ...props }, ref) => {\n    return (\n      <button\n        ref={ref}\n        disabled={isLoading}\n        aria-busy={isLoading}\n        data-variant={variant}\n        data-size={size}\n        {...props}\n      >\n        {isLoading", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 40, "token_count": 292, "hash_short": "56767f1c", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_041", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "turn (\n      <button\n        ref={ref}\n        disabled={isLoading}\n        aria-busy={isLoading}\n        data-variant={variant}\n        data-size={size}\n        {...props}\n      >\n        {isLoading ?", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 41, "token_count": 50, "hash_short": "6dd186c9", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_042", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "rn (\n      <button\n        ref={ref}\n        disabled={isLoading}\n        aria-busy={isLoading}\n        data-variant={variant}\n        data-size={size}\n        {...props}\n      >\n        {isLoading ? <Spinner /> : null}\n        {leftIcon}\n        {children}\n        {rightIcon}\n      </button>\n    );\n  },\n);\n\nButton.displayName = \"Button\";\n```\n\n### Component Composition\n\n- **Compound components** for complex UI patterns\n- **Render props** for flexible behavior\n- **Context providers** for shared state\n\n```typescript\n// ✅ Good: Compound component pattern\nexport const Card = ({ children, ...props }: CardProps) => (\n  <div className=\"card\" {...props}>{children}</div>\n);\n\nexport const CardHeader = ({ children, ...props }: CardHeaderProps) => (\n  <div className=\"card-header\" {...props}>{children}</div>\n);\n\nexport const CardBody = ({ children, ...props }: CardBodyProps) => (\n  <div className=\"card-body\" {...props}>{children}</div>\n);\n\n// Usage\n<Card>\n  <CardHeader>Title</CardHeader>\n  <CardBody>Content</CardBody>\n</Card>\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 42, "token_count": 258, "hash_short": "12e780ba", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_043", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "= ({ children, ...props }: CardBodyProps) => (\n  <div className=\"card-body\" {...props}>{children}</div>\n);\n\n// Usage\n<Card>\n  <CardHeader>Title</CardHeader>\n  <CardBody>Content</CardBody>\n</Card>\n```\n\n\n### Accessibility in Components\n\n- **ARIA attributes** for interactive elements\n- **Keyboard navigation** support\n- **Focus management** for modals and dialogs\n- **Screen reader** friendly labels\n\n```typescript\n// ✅ Good: Accessible component\nexport const Modal: React.FC<ModalProps> = ({ isOpen, onClose, children }) => {\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (isOpen && modalRef.current) {\n      modalRef.current.focus();\n    }\n  }, [isOpen]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-labelledby=\"modal-title\"\n      ref={modalRef}\n      tabIndex={-1}\n    >\n      {children}\n    </div>\n  );\n};\n```\n\n---\n\n## E2E Testing Patterns\n\n### Playwright Test Structure\n\n- **Page Object Model** for maintainability\n- **Test data factories** for consistent test data\n- **Deterministic seeds** for reproducible tests\n- **Fake clock** for time-dependent tests\n\n```typescript\n// ✅ Good: Playwright test pattern\nimport { test, expect } from \"@playwright/test\";\nimport { LoginPage } from \"./pages/LoginPage\";\nimport { createTestUser } from \"./factories/userFactory\";\n\ntest.describe(\"User Authentication\", () => {\n  test(\"should login successfully\", async ({ page }) => {\n    const loginPage = new LoginPage(page);\n    const user = createTestUser();\n\n    await loginPage.goto();\n    await loginPage.fillEmail(user.email);\n    await loginPage.fillPassword(user.password);\n    await loginPage.submit();\n\n    await expect(page).toHaveURL(\"/dashboard\");\n  });\n});\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 43, "token_count": 437, "hash_short": "aacc64ec", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_044", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "inPage.goto();\n    await loginPage.fillEmail(user.email);\n    await loginPage.fillPassword(user.password);\n    await loginPage.submit();\n\n    await expect(page).toHaveURL(\"/dashboard\");\n  });\n});\n```\n\n\n### Page Object Pattern\n\n- **Encapsulate page interactions** in page objects\n- **Return page objects** for method chaining\n- **Separate concerns** (navigation, actions, assertions)\n\n```typescript\n// ✅ Good: Page object pattern\nexport class LoginPage {\n  constructor(private page: Page) {}\n\n  async goto() {\n    await this.page.goto(\"/login\");\n  }\n\n  async fillEmail(email: string) {\n    await this.page.fill('[data-testid=\"email\"]', email);\n  }\n\n  async fillPassword(password: string) {\n    await this.page.fill('[data-testid=\"password\"]', password);\n  }\n\n  async submit() {\n    await this.page.click('[data-testid=\"submit\"]');\n  }\n\n  async expectErrorMessage(message: string) {\n    await expect(this.page.locator('[data-testid=\"error\"]')).toContainText(message);\n  }\n}\n```\n\n### Test Data Management\n\n- **Use factories** for test data generation\n- **Seeded PRNG** for deterministic random data\n- **Cleanup after tests** to prevent test pollution\n- **Isolate test data** per test run\n\n```typescript\n// ✅ Good: Test data factory\nimport { faker } from \"@faker-js/faker\";\nimport { seed } from \"./testUtils\";\n\nexport function createTestUser(overrides?: Partial<User>): User {\n  faker.seed(seed); // Deterministic seed\n  return {\n    id: faker.string.uuid(),\n    email: faker.internet.email(),\n    username: faker.internet.userName(),\n    ...overrides,\n  };\n}\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 44, "token_count": 389, "hash_short": "a4872066", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_045", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "er>): User {\n  faker.seed(seed); // Deterministic seed\n  return {\n    id: faker.string.uuid(),\n    email: faker.internet.email(),\n    username: faker.internet.userName(),\n    ...overrides,\n  };\n}\n```\n\n\n### Snapshot Testing\n\n- **Mask dynamic content** (timestamps, IDs, etc.)\n- **Use stable selectors** for reliable snapshots\n- **Version snapshots** when UI changes intentionally\n\n```typescript\n// ✅ Good: Snapshot with masking\ntest(\"should render user profile\", async ({ page }) => {\n  await page.goto(\"/profile\");\n\n  // Mask dynamic content\n  await page.evaluate(() => {\n    document.querySelectorAll(\"[data-timestamp]\").forEach((el) => {\n      el.textContent = \"[TIMESTAMP]\";\n    });\n  });\n\n  await expect(page).toHaveScreenshot(\"user-profile.png\");\n});\n```\n\n---\n\n## Code Review Guidelines\n\n### What to Review\n\n#### Functionality\n\n- **Correctness**: Does the code do what it's supposed to?\n- **Edge cases**: Are edge cases handled?\n- **Error handling**: Are errors handled appropriately?", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 45, "token_count": 247, "hash_short": "92f116b3", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_046", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "s\n\n### What to Review\n\n#### Functionality\n\n- **Correctness**: Does the code do what it's supposed to?\n- **Edge cases**: Are edge cases handled?\n- **Error handling**: Are errors handled appropriately?\n- **Performance**: Are there obvious performance issues?\n\n#### Code Quality\n\n- **Readability**: Is the code easy to understand?\n- **Maintainability**: Will this be easy to maintain?\n- **DRY principle**: Is there unnecessary duplication?\n- **Single Responsibility**: Does each function/class do one thing?\n\n#### Security\n\n- **Input validation**: Are all inputs validated?\n- **SQL injection**: Are queries parameterized?\n- **XSS prevention**: Is user input sanitized?\n- **Authentication**: Are endpoints properly protected?\n\n#### Testing\n\n- **Test coverage**: Are new features tested?\n- **Test quality**: Do tests actually test the right things?\n- **Test maintenance**: Will tests break easily?", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 46, "token_count": 223, "hash_short": "e153840f", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_047", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "dpoints properly protected?\n\n#### Testing\n\n- **Test coverage**: Are new features tested?\n- **Test quality**: Do tests actually test the right things?\n- **Test maintenance**: Will tests break easily?", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 47, "token_count": 49, "hash_short": "db497958", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_048", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "### Review Checklist\n\n```markdown\n## Code Review Checklist\n\n### Functionality\n\n- [ ] Code implements the requirement correctly\n- [ ] Edge cases are handled\n- [ ] Error handling is appropriate\n- [ ] No obvious bugs or logic errors\n\n### Code Quality\n\n- [ ] Code follows style guide\n- [ ] No code duplication\n- [ ] Functions are focused and small\n- [ ] Naming is clear and descriptive\n- [ ] Comments explain \"why\", not \"what\"\n\n### Security\n\n- [ ] Input validation present\n- [ ] No hardcoded secrets\n- [ ] Authentication/authorization correct\n- [ ] SQL injection prevented\n- [ ] XSS prevention in place\n\n### Testing\n\n- [ ] Unit tests added/updated\n- [ ] Integration tests if needed\n- [ ] Tests are meaningful and pass\n- [ ] Coverage maintained or improved\n\n### Documentation\n\n- [ ] Code is self-documenting\n- [ ] Complex logic has comments\n- [ ] API changes documented\n- [ ] README updated if needed\n```\n\n### Review Comments\n\n- **Be constructive**: Focus on improvement, not criticism\n- **Be specific**: Point to exact lines and suggest fixes\n- **Explain why**: Help the author understand the reasoning\n- **Suggest alternatives**: Don't just say \"this is wrong\"\n\n```typescript\n// ❌ Bad review comment\n// This is wrong\n\n// ✅ Good review comment\n// Consider using a Map here instead of an object for O(1) lookups", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 48, "token_count": 326, "hash_short": "9cd5b877", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_049", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "gest alternatives**: Don't just say \"this is wrong\"\n\n```typescript\n// ❌ Bad review comment\n// This is wrong\n\n// ✅ Good review comment\n// Consider using a Map here instead of an object for O(1) lookups.\n// The current approach has O(n) complexity when checking if a key exists.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 49, "token_count": 69, "hash_short": "4dd0d83e", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_050", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "eview comment\n// This is wrong\n\n// ✅ Good review comment\n// Consider using a Map here instead of an object for O(1) lookups.\n// The current approach has O(n) complexity when checking if a key exists.\n// Example: const userMap = new Map(users.map(u => [u.id, u]));\n```\n\n### Approval Criteria\n\n- **All tests pass**: CI must be green\n- **No blocking issues**: Critical issues must be resolved\n- **Style guide compliance**: Code follows conventions\n- **Security review**: Security-sensitive code reviewed by security team\n- **Documentation**: Public APIs documented\n\n---\n\n## Structured Logging Patterns\n\n### Log Format\n\n- **JSON format** in production (structured, machine-readable)\n- **Pretty format** in development (human-readable)\n- **Consistent structure** with required fields\n- **PII redaction** for sensitive data\n\n```typescript\n// ✅ Good: Structured logging with Pino\nimport { logger } from \"../config/logger.js\";\n\n// Structured log with context\nlogger.info(\n  {\n    userId: \"user-123\",\n    action: \"session.created\",\n    sessionId: \"session-456\",\n    requestId: req.requestId,\n  },\n  \"Session created successfully\",\n);\n\n// Error logging with context\nlogger.error(\n  {\n    error: error.message,\n    stack: error.stack,\n    userId: req.user?.sub,\n    requestId: req.requestId,\n  },\n  \"Failed to create session\",\n);\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 50, "token_count": 330, "hash_short": "4f7a7d78", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_051", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": ";\n\n// Error logging with context\nlogger.error(\n  {\n    error: error.message,\n    stack: error.stack,\n    userId: req.user?.sub,\n    requestId: req.requestId,\n  },\n  \"Failed to create session\",\n);\n```\n\n\n### Log Levels\n\n- **`debug`**: Detailed information for debugging (development only)\n- **`info`**: General informational messages (default in production)\n- **`warn`**: Warning messages for potentially harmful situations\n- **`error`**: Error events that might still allow the app to continue\n- **`fatal`**: Very severe error events that might abort the application\n\n```typescript\n// ✅ Good: Appropriate log levels\nlogger.debug({ query, params }, \"Executing database query\");\nlogger.info({ userId, action }, \"User action completed\");\nlogger.warn({ userId, reason }, \"Rate limit approaching\");\nlogger.error({ error, context }, \"Operation failed\");\n```\n\n### Correlation IDs\n\n- **Generate request ID** at request start\n- **Include in all logs** for request tracing\n- **Pass through async operations** via context\n\n```typescript\n// ✅ Good: Request ID middleware\nimport { randomUUID } from \"node:crypto\";\n\napp.use((req: Request, _res: Response, next: NextFunction) => {\n  req.requestId = randomUUID();\n  next();\n});\n\n// Use in logging\nlogger.info({ requestId: req.requestId, userId }, \"Processing request\");\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 51, "token_count": 326, "hash_short": "7a1e1d86", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_052", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "e((req: Request, _res: Response, next: NextFunction) => {\n  req.requestId = randomUUID();\n  next();\n});\n\n// Use in logging\nlogger.info({ requestId: req.requestId, userId }, \"Processing request\");\n```\n\n\n### PII Redaction\n\n- **Redact sensitive fields** automatically (passwords, tokens, emails)\n- **Configure redaction paths** in logger config\n- **Never log** full request bodies with sensitive data\n\n```typescript\n// ✅ Good: PII redaction configuration\nconst REDACT_PATHS = [\n  \"req.headers.authorization\",\n  \"req.body.password\",\n  \"req.body.token\",\n  \"*.email\",\n  \"*.passwordHash\",\n];\n\nconst logger = pino({\n  redact: {\n    paths: REDACT_PATHS,\n    censor: \"[REDACTED]\",\n  },\n});\n```\n\n### Log Context\n\n- **Include relevant context** in log entries\n- **Use consistent field names** across the application\n- **Add business context** (userId, action, entityId, etc.)\n\n```typescript\n// ✅ Good: Rich log context\nlogger.info(\n  {\n    requestId: req.requestId,\n    userId: req.user?.sub,\n    action: \"session.created\",\n    entityType: \"session\",\n    entityId: session.id,\n    outcome: \"success\",\n    duration: Date.now() - startTime,\n  },\n  \"Session created\",\n);\n```\n\n---", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 52, "token_count": 291, "hash_short": "cd72fef2", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_053", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "req.user?.sub,\n    action: \"session.created\",\n    entityType: \"session\",\n    entityId: session.id,\n    outcome: \"success\",\n    duration: Date.now() - startTime,\n  },\n  \"Session created\",\n);\n```\n\n---\n\n\n## API Versioning Strategy\n\n### URL-Based Versioning\n\nFitVibe uses **URL-based versioning** (`/api/v1/`) as the primary strategy:\n\n- **Clear and explicit**: Version is visible in the URL\n- **Easy to route**: Simple middleware routing\n- **Cache-friendly**: Different versions can be cached separately\n- **Backward compatible**: Old versions can coexist\n\n```typescript\n// ✅ Good: URL-based versioning\nconst apiRouter = Router();\n\n// Mount all v1 routes\napiRouter.use(\"/auth\", authRouter);\napiRouter.use(\"/users\", usersRouter);\n// ... other routes\n\n// Mount versioned API\napp.use(\"/api/v1\", apiRouter);\n\n// Future: Add v2 when needed\n// app.use(\"/api/v2\", apiRouterV2);\n```\n\n### Versioning Rules\n\n1. **Breaking changes** require a new version\n2.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 53, "token_count": 235, "hash_short": "54d9bbb4", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_054", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "s\n\n// Mount versioned API\napp.use(\"/api/v1\", apiRouter);\n\n// Future: Add v2 when needed\n// app.use(\"/api/v2\", apiRouterV2);\n```\n\n### Versioning Rules\n\n1. **Breaking changes** require a new version\n2. **Non-breaking changes** (additive) can be made in the same version\n3. **Deprecation policy**: Announce deprecation 6 months before removal\n4. **Support policy**: Support at least the last 2 major versions\n\n### Breaking Changes\n\nThese changes require a new API version:\n\n- **Removing fields** from request/response\n- **Changing field types** (string → number)\n- **Removing endpoints**\n- **Changing authentication/authorization** requirements\n- **Changing error response format**\n\n### Non-Breaking Changes\n\nThese changes can be made in the same version:\n\n- **Adding new fields** to responses\n- **Adding new endpoints**\n- **Adding optional query parameters**\n- **Adding new error codes** (without removing old ones)\n\n### Deprecation Process\n\n1. **Add deprecation header** to responses\n2.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 54, "token_count": 246, "hash_short": "1af43973", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_055", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "nses\n- **Adding new endpoints**\n- **Adding optional query parameters**\n- **Adding new error codes** (without removing old ones)\n\n### Deprecation Process\n\n1. **Add deprecation header** to responses\n2. **Document in API changelog**\n3. **Announce to API consumers** (6 months notice)\n4.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 55, "token_count": 70, "hash_short": "526fb50b", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_056", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "w error codes** (without removing old ones)\n\n### Deprecation Process\n\n1. **Add deprecation header** to responses\n2. **Document in API changelog**\n3. **Announce to API consumers** (6 months notice)\n4. **Remove in next major version**\n\n```typescript\n// ✅ Good: Deprecation header\nres.set(\"Deprecation\", \"true\");\nres.set(\"Sunset\", \"Sat, 01 Jan 2026 00:00:00 GMT\");\nres.set(\"Link\", '</api/v2/sessions>; rel=\"successor-version\"');\nres.json({ sessions });\n```\n\n### Version Documentation\n\n- **Document each version** in OpenAPI spec\n- **Maintain changelog** for each version\n- **List breaking changes** clearly\n- **Provide migration guides** when upgrading\n\n---\n\n## Observability Patterns\n\n### OpenTelemetry Tracing\n\n- **Use OpenTelemetry** for distributed tracing\n- **Auto-instrument** HTTP, database, and external calls\n- **Add custom spans** for business logic\n- **Propagate trace context** across services\n\n```typescript\n// ✅ Good: Custom span for business logic\nimport { trace } from \"@opentelemetry/api\";\n\nconst tracer = trace.getTracer(\"fitvibe-backend\");\n\nexport async function createSession(data: SessionData): Promise<Session> {\n  return tracer.startActiveSpan(\"session.create\", async (span) => {\n    try {\n      span.setAttributes({\n        \"session.type\": data.type,\n        \"session.userId\": data.userId,\n      });\n\n      const session = await sessionRepository.create(data);\n\n      span.setAttribute(\"session.id\", session.id);\n      span.setStatus({ code: 1 }); // OK status\n\n      return session;\n    } catch (error) {\n      span.setStatus({\n        code: 2, // ERROR status\n        message: error instanceof Error", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 56, "token_count": 405, "hash_short": "b19186ba", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_057", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "ssion.id);\n      span.setStatus({ code: 1 }); // OK status\n\n      return session;\n    } catch (error) {\n      span.setStatus({\n        code: 2, // ERROR status\n        message: error instanceof Error ? error.message : String(error),\n      });\n      span.recordException(error instanceof Error ?", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 57, "token_count": 73, "hash_short": "8d6b177f", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_058", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "error) {\n      span.setStatus({\n        code: 2, // ERROR status\n        message: error instanceof Error ? error.message : String(error),\n      });\n      span.recordException(error instanceof Error ? error : new Error(String(error)));\n      throw error;\n    } finally {\n      span.end();\n    }\n  });\n}\n```\n\n### Prometheus Metrics\n\n- **Use Prometheus** for metrics collection\n- **Define custom metrics** for business events\n- **Use appropriate metric types** (Counter, Histogram, Gauge)\n- **Label metrics** with relevant dimensions\n\n```typescript\n// ✅ Good: Custom business metrics\nimport client from \"prom-client\";\n\nconst pointsAwardedCounter = new client.Counter({\n  name: \"points_awarded_total\",\n  help: \"Total points awarded grouped by rule\",\n  labelNames: [\"rule\", \"vibe\"],\n});\n\nexport function awardPoints(rule: string, vibe: string, amount: number) {\n  pointsAwardedCounter.inc({ rule, vibe }, amount);\n}\n\n// ✅ Good: HTTP metrics middleware\nconst httpRequestDuration = new client.Histogram({\n  name: \"http_request_duration_seconds\",\n  help: \"Duration of HTTP requests in seconds\",\n  labelNames: [\"method\", \"route\", \"status_code\"],\n  buckets: [0.05, 0.1, 0.2, 0.5, 1, 2, 5],\n});\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 58, "token_count": 296, "hash_short": "9722f483", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_059", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "stogram({\n  name: \"http_request_duration_seconds\",\n  help: \"Duration of HTTP requests in seconds\",\n  labelNames: [\"method\", \"route\", \"status_code\"],\n  buckets: [0.05, 0.1, 0.2, 0.5, 1, 2, 5],\n});\n```\n\n\n### Metric Naming\n\n- **Use snake_case** for metric names\n- **Include unit** in metric name (seconds, bytes, total)\n- **Use descriptive names** that indicate what is measured\n- **Follow Prometheus conventions**: `namespace_unit_type`\n\n```typescript\n// ✅ Good: Prometheus naming conventions\n\"http_request_duration_seconds\"; // Histogram\n\"http_requests_total\"; // Counter\n\"active_sessions\"; // Gauge\n\"database_query_duration_seconds\"; // Histogram\n```\n\n### Error Tracking\n\n- **Integrate error tracking** (Sentry, etc.) for production\n- **Include context** (userId, requestId, traceId)\n- **Filter noise** (4xx errors, expected errors)\n- **Alert on critical errors** (5xx, unhandled exceptions)\n\n```typescript\n// ✅ Good: Error tracking with context\nimport * as Sentry from \"@sentry/node\";\n\ntry {\n  await processPayment(data);\n} catch (error) {\n  Sentry.captureException(error, {\n    tags: {\n      userId: req.user?.sub,\n      action: \"payment.process\",\n    },\n    contexts: {\n      request: {\n        requestId: req.requestId,\n        method: req.method,\n        url: req.url,\n      },\n    },\n  });\n  throw error;\n}\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 59, "token_count": 329, "hash_short": "89769c16", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_060", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "action: \"payment.process\",\n    },\n    contexts: {\n      request: {\n        requestId: req.requestId,\n        method: req.method,\n        url: req.url,\n      },\n    },\n  });\n  throw error;\n}\n```\n\n\n### Distributed Tracing\n\n- **Propagate trace context** via HTTP headers\n- **Use W3C Trace Context** format\n- **Correlate logs with traces** using trace ID\n- **View full request flow** across services\n\n```typescript\n// ✅ Good: Trace context propagation\nimport { context, propagation, trace } from \"@opentelemetry/api\";\n\n// Extract trace context from incoming request\nconst activeContext = propagation.extract(context.active(), req.headers);\n\n// Use trace context for downstream calls\ncontext.with(activeContext, async () => {\n  const span = trace.getActiveSpan();\n  span?.setAttribute(\"downstream.service\", \"payment-service\");\n\n  // Make HTTP call with trace context\n  const headers: Record<string, string> = {};\n  propagation.inject(context.active(), headers);\n  await fetch(\"https://payment-service/api/charge\", { headers });\n});\n```", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 60, "token_count": 257, "hash_short": "6d6143f5", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_061", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "e HTTP call with trace context\n  const headers: Record<string, string> = {};\n  propagation.inject(context.active(), headers);\n  await fetch(\"https://payment-service/api/charge\", { headers });\n});\n```\n\n\n### Observability Best Practices\n\n1. **Three Pillars**: Logs, Metrics, Traces\n2. **Correlation**: Link logs, metrics, and traces via request ID\n3. **Sampling**: Sample traces in production (100% in staging)\n4. **Cardinality**: Limit metric label cardinality to prevent explosion\n5.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 61, "token_count": 120, "hash_short": "da479c03", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_062", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "*Correlation**: Link logs, metrics, and traces via request ID\n3. **Sampling**: Sample traces in production (100% in staging)\n4. **Cardinality**: Limit metric label cardinality to prevent explosion\n5. **Cost**: Monitor observability data volume and costs\n\n```typescript\n// ✅ Good: Observability correlation\nconst requestId = req.requestId;\nconst traceId = trace.getActiveSpan()?.spanContext().traceId;\n\nlogger.info(\n  {\n    requestId,\n    traceId,\n    userId: req.user?.sub,\n    method: req.method,\n    route: req.route?.path,\n  },\n  \"Request started\",\n);\n```\n\n---\n\n## Additional Resources\n\n- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/intro.html)\n- [React Best Practices](https://react.dev/learn)\n- [Express.js Guide](https://expressjs.com/en/guide/routing.html)\n- [Zod Documentation](https://zod.dev/)\n- [React Query Documentation](https://tanstack.com/query/latest)\n- [Zustand Documentation](https://zustand-demo.pmnd.rs/)\n- [Knex.js Documentation](https://knexjs.org/)\n- [ESLint Rules](https://eslint.org/docs/latest/rules/)\n- [Prettier Options](https://prettier.io/docs/en/options.html)\n\n---", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 62, "token_count": 279, "hash_short": "1f4d11f6", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_063", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "tps://zustand-demo.pmnd.rs/)\n- [Knex.js Documentation](https://knexjs.org/)\n- [ESLint Rules](https://eslint.org/docs/latest/rules/)\n- [Prettier Options](https://prettier.io/docs/en/options.html)\n\n---\n\n\n## Enforcement\n\nThese style guidelines are enforced through:\n\n- **ESLint** rules (see `eslint.config.js`)\n- **Prettier** formatting (see `.prettierrc`)\n- **TypeScript** strict mode\n- **Pre-commit hooks** (Husky + lint-staged)\n- **CI/CD pipeline** (linting and type checking)\n\nRun `pnpm lint --fix` before committing to auto-fix formatting issues.\n\n---\n\n---\n\n## Guide Review & Assessment\n\n### Current State Assessment\n\nThis guide has been reviewed against industry best practices and state-of-the-art standards as of 2025. Here's the assessment:\n\n#### ✅ **Strengths - State-of-the-Art Practices**\n\n1. **TypeScript Strict Mode**: Enforcing strict mode with no `any` types is industry-leading\n2. **Type-Safe Validation**: Zod schemas with type inference provide excellent developer experience\n3.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 63, "token_count": 248, "hash_short": "9aaef830", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_064", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "**\n\n1. **TypeScript Strict Mode**: Enforcing strict mode with no `any` types is industry-leading\n2. **Type-Safe Validation**: Zod schemas with type inference provide excellent developer experience\n3. **Modern React Patterns**: React 18 patterns (lazy loading, hooks, Suspense) are current\n4. **Layered Architecture**: Clear separation (routes → controllers → services → repositories) follows SOLID principles\n5. **Security-First**: CSRF, input validation, parameterized queries are all properly addressed\n6. **Accessibility**: WCAG 2.1 AA compliance requirements are modern and comprehensive\n7. **Testing Patterns**: Deterministic testing with fake clocks and seeded PRNG is advanced\n8. **Performance**: Code splitting, memoization, and query optimization patterns are current\n\n#### ⚠️ **Areas for Potential Enhancement**\n\n1. **React Server Components**: Not yet covered (if/when migrating to Next.js or similar)\n2. **GraphQL Patterns**: Not covered (if API evolves to GraphQL)\n3.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 64, "token_count": 245, "hash_short": "ec865ae5", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_065", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "# ⚠️ **Areas for Potential Enhancement**\n\n1. **React Server Components**: Not yet covered (if/when migrating to Next.js or similar)\n2. **GraphQL Patterns**: Not covered (if API evolves to GraphQL)\n3. **Micro-frontend Architecture**: Not covered (if scaling to micro-frontends)\n4. **Advanced State Management**: Could add patterns for complex state (Redux Toolkit, Jotai)\n5. **Observability Patterns**: Could expand on structured logging, tracing, and metrics\n6. **API Versioning**: Could add more detail on versioning strategies\n7.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 65, "token_count": 132, "hash_short": "b1c09afd", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_066", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "r complex state (Redux Toolkit, Jotai)\n5. **Observability Patterns**: Could expand on structured logging, tracing, and metrics\n6. **API Versioning**: Could add more detail on versioning strategies\n7. **Documentation Generation**: Could add patterns for auto-generating API docs from code\n\n#### 📊 **Industry Comparison**\n\n| Aspect                | FitVibe Standard          | Industry Standard   | Status            |\n| --------------------- | ------------------------- | ------------------- | ----------------- |\n| TypeScript Strictness | ✅ Strict, no `any`       | ⚠️ Often lenient    | **Above Average** |\n| Testing Coverage      | ✅ 80% repo, 90% critical | ⚠️ Often 70-80%     | **Above Average** |\n| Security Practices    | ✅ Comprehensive          | ⚠️ Often basic      | **Above Average** |\n| Accessibility         | ✅ WCAG 2.1 AA            | ⚠️ Often WCAG 2.0 A | **Above Average** |\n| Code Organization     | ✅ Modular, layered       | ✅ Similar          | **On Par**        |\n| Error Handling        | ✅ Centralized, typed     | ✅ Similar          | **On Par**        |\n| Performance           | ✅ Optimized patterns     | ✅ Similar          | **On Par**        |", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 66, "token_count": 293, "hash_short": "16e76717", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_067", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "**        |\n| Error Handling        | ✅ Centralized, typed     | ✅ Similar          | **On Par**        |\n| Performance           | ✅ Optimized patterns     | ✅ Similar          | **On Par**        |\n\n\n### Recommendations for Future Updates\n\n#### ✅ High Priority (COMPLETED)\n\n1. **✅ Structured Logging Patterns** - Added\n   - JSON logging format with Pino\n   - Log levels and context\n   - Correlation IDs (request IDs)\n   - PII redaction patterns\n\n2. **✅ API Versioning Strategy** - Added\n   - URL-based versioning (`/api/v1/`)\n   - Deprecation policies\n   - Breaking vs non-breaking changes\n   - Version documentation\n\n3. **✅ Observability Patterns** - Added\n   - OpenTelemetry instrumentation\n   - Distributed tracing\n   - Prometheus metrics collection\n   - Error tracking patterns\n\n#### Medium Priority (Nice to Have)\n\n1. **Advanced React Patterns**\n   - Server Components (if applicable)\n   - Concurrent features (useTransition, useDeferredValue)\n   - Error boundaries best practices\n\n2.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 67, "token_count": 247, "hash_short": "f162f403", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_068", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "dium Priority (Nice to Have)\n\n1. **Advanced React Patterns**\n   - Server Components (if applicable)\n   - Concurrent features (useTransition, useDeferredValue)\n   - Error boundaries best practices\n\n2. **Database Optimization**\n   - Query performance patterns\n   - Indexing strategies\n   - Connection pooling\n   - Read replicas\n\n3. **Caching Strategies**\n   - HTTP caching headers\n   - Redis caching patterns\n   - Cache invalidation strategies\n\n#### Low Priority (Future Consideration)\n\n1. **GraphQL Patterns** (if API evolves)\n2. **Micro-frontend Architecture** (if scaling)\n3. **WebAssembly Integration** (if performance critical)\n4.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 68, "token_count": 158, "hash_short": "5f6a2914", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_069", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "ategies\n\n#### Low Priority (Future Consideration)\n\n1. **GraphQL Patterns** (if API evolves)\n2. **Micro-frontend Architecture** (if scaling)\n3. **WebAssembly Integration** (if performance critical)\n4. **Progressive Web App** patterns (if mobile strategy changes)\n\n### Conclusion\n\n**Overall Assessment: ✅ State-of-the-Art**\n\nThe FitVibe coding style guide represents **above-average industry standards** with several areas exceeding typical practices:\n\n- **Security**: Comprehensive security practices exceed most projects\n- **Type Safety**: Strict TypeScript usage is better than many codebases\n- **Testing**: Deterministic testing patterns are advanced\n- **Accessibility**: WCAG 2.1 AA compliance is modern and thorough\n\nThe guide is **production-ready** and provides excellent guidance for maintaining a high-quality codebase. All high-priority enhancements have been added, making this a comprehensive, state-of-the-art style guide.\n\n**Recommendation**: The guide is complete and ready for use.", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 69, "token_count": 249, "hash_short": "1593420d", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE_chunk_070", "doc_id": ".._.._docs_2.Technical_Design_Document_CODING_STYLE_GUIDE", "text": "ining a high-quality codebase. All high-priority enhancements have been added, making this a comprehensive, state-of-the-art style guide.\n\n**Recommendation**: The guide is complete and ready for use. Medium and low priority enhancements can be added as the project evolves and new patterns emerge.\n\n---\n\n**Last Updated:** 2025-01-20  \n**Maintained By:** FitVibe Development Team  \n**Review Status:** ✅ State-of-the-Art (Above Industry Average)", "source_file": "../../docs/2.Technical_Design_Document/CODING_STYLE_GUIDE.md", "category": "technical", "chunk_index": 70, "token_count": 110, "hash_short": "5b2be68b", "version": 1.0, "title": "FitVibe Coding Style Guide", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:42.112965", "tags": ["technical", "md"]}
