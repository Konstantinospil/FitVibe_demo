{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_000", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "﻿---\ntitle: \"FitVibe Technical Design Document (TDD)\"\nversion: \"v2.0\"\nstatus: \"Accepted\"\nowner: \"Konstantinos Pilpilidis (Dr.)\"\ndate: \"2025-10-21\"\nlinks:\n  - PRD: docs/1.Product Requirements Document.md\n  - QA: docs/3.Testing and Quality Assurance Plan.md\n  - ADR Index: docs/adr/README.md\nlicense: \"MIT\"\n---\n\n# 0. Introduction\n\n## 0.1 Purpose & Scope\n\nThis TDD specifies **how** the FitVibe system will implement the features and constraints defined in the [PRD](.\\1.Product_Requirements_Document.md) (WHAT/WHY) and satisfy the [QA Plan](4.%20Testing_and_Quality_Assurance_Plan.md) (HOW WELL).\n\n## 0.2 Audience & Reading Guide\n\n- **Engineers** implement according to specs, contracts, and runbooks. See [Coding Style Guide](./CODING_STYLE_GUIDE.md) for React and Express patterns.\n- **QA** uses RTM links to derive tests and quality gates.\n- **Security/Compliance** verifies controls, data classification, GDPR flows.\n- **Product/Design** confirms that behavior matches PRD intent.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 0, "token_count": 245, "hash_short": "e9c3c019", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_001", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "**QA** uses RTM links to derive tests and quality gates.\n- **Security/Compliance** verifies controls, data classification, GDPR flows.\n- **Product/Design** confirms that behavior matches PRD intent.\n\n## 0.3 Assumptions & Constraints\n\n- Monorepo with **pnpm** workspaces; Node.js 20 LTS; React 18; PostgreSQL â‰¥ 14 (target 16-18 locally).\n- All external calls (email) are **adapterized** and mockable for tests.\n- Privacy-by-design: **private-by-default** content, explicit consent for public sharing.\n- Deployments run behind **TLS** with reverse proxy (NGINX) and **Let's Encrypt** certificates.\n\n## 0.4 Versioning & Changelog\n\n- **Change policy:** Any change to interfaces, schema, or security controls must update TDD and the related ADR, and link into QA RTM.\n\n---\n\n# 10. CI/CD & Developer Experience\n\nThis section specifies the **pipeline**, **quality gates**, **artifact handling**, **release strategy**, **migration safety**, and **local developer workflow** for FitVibe.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 1, "token_count": 244, "hash_short": "9c820fc0", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_002", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "CD & Developer Experience\n\nThis section specifies the **pipeline**, **quality gates**, **artifact handling**, **release strategy**, **migration safety**, and **local developer workflow** for FitVibe. It binds §5 (Cross-Cutting), §7 (API), §8 (FE), and §9 (NFR gates) into executable automation.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 2, "token_count": 73, "hash_short": "2e1073f2", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_003", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "t handling**, **release strategy**, **migration safety**, and **local developer workflow** for FitVibe. It binds §5 (Cross-Cutting), §7 (API), §8 (FE), and §9 (NFR gates) into executable automation.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 3, "token_count": 49, "hash_short": "7c42a5c6", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_004", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "---\n\n## 10.1 Monorepo Layout & Task Graph\n\n```\nFitVibe V2/\n├─ apps/\n│  ├─ backend/         # Express/TS API, tests, migrations, seeds\n│  └─ frontend/        # React/Vite app, tests, e2e (Playwright)\n├─ packages/           # shared libs (dto, config, ui)\n├─ .github/workflows/  # CI/CD pipelines\n├─ docs/               # PRD, TDD, QA, ADRs, diagrams\n├─ turbo.json          # task graph (build, lint, test, typecheck)\n└─ docker/             # Dockerfiles & compose files\n```\n\n**Turborepo tasks (examples):**\n\n- `build`: builds FE & BE\n- `lint`: eslint + prettier check\n- `typecheck`: tsc --noEmit\n- `test`: unit & integration (Jest)\n- `e2e`: Playwright (frontend)\n- `perf`: k6 (API)\n- `a11y`: axe (frontend)\n\n---\n\n## 10.2 CI Pipeline (GitHub Actions)\n\n### 10.2.1 Workflow Structure & Jobs\n\nThe CI pipeline is structured as multiple parallel and sequential jobs:\n\n**Primary Quality Gates (run on all PRs and pushes):**\n\n1.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 4, "token_count": 229, "hash_short": "acda6b2b", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_005", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "CI Pipeline (GitHub Actions)\n\n### 10.2.1 Workflow Structure & Jobs\n\nThe CI pipeline is structured as multiple parallel and sequential jobs:\n\n**Primary Quality Gates (run on all PRs and pushes):**\n\n1. **`quality`** job:\n   - Prepare: checkout, pnpm cache restore, Node.js 20 setup, native dependencies\n   - Dependency integrity: `pnpm audit --prod --audit-level=moderate`\n   - Static checks: `pnpm lint:check`, `pnpm typecheck`\n   - Unit tests: Backend (`pnpm --filter @fitvibe/backend test -- --coverage --maxWorkers=2`) and Frontend (`pnpm --filter @fitvibe/frontend test -- --coverage --maxWorkers=2`) with coverage\n   - Coverage gate: `pnpm test:coverage:gate` (enforces ≥80% coverage)\n   - QA validation: `node tests/qa/assert-baseline.js`\n   - i18n check: `pnpm i18n:check`\n   - Feature flags: `node tests/qa/check-feature-flags.js`\n   - Build: `pnpm build`\n\n2.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 5, "token_count": 216, "hash_short": "4dff49ee", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_006", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "forces ≥80% coverage)\n   - QA validation: `node tests/qa/assert-baseline.js`\n   - i18n check: `pnpm i18n:check`\n   - Feature flags: `node tests/qa/check-feature-flags.js`\n   - Build: `pnpm build`\n\n2. **`database_tests`** job (runs in parallel with `quality`):\n   - Migration tests: `pnpm --filter @fitvibe/backend exec jest tests/migrations/migrations.test.ts --maxWorkers=1 --forceExit`\n   - Seed tests: `pnpm --filter @fitvibe/backend exec jest tests/seeds/seeds.test.ts --maxWorkers=1 --forceExit`\n\n**Secondary Jobs (run after quality gates pass):**\n\n3. **`openapi_spec`** job (depends on `quality` and `database_tests`):\n   - Generate OpenAPI: `pnpm -w openapi:build`\n   - Validate schema and upload artifact\n\n4. **`integration`** job (depends on `quality` and `database_tests`):\n   - Run database migrations and seeds\n   - Integration tests: `pnpm --filter @fitvibe/backend exec jest --maxWorkers=2`\n\n5.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 6, "token_count": 227, "hash_short": "c7502607", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_007", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "act\n\n4. **`integration`** job (depends on `quality` and `database_tests`):\n   - Run database migrations and seeds\n   - Integration tests: `pnpm --filter @fitvibe/backend exec jest --maxWorkers=2`\n\n5. **`metrics_contract`** job (depends on `quality` and `database_tests`):\n   - Validate Prometheus metrics exposure: `node tests/metrics/assert-prom.cjs`\n\n6. **`security`** job (depends on `quality` and `database_tests`):\n   - Dependency audit: `pnpm audit --prod --audit-level=high` (fails on high/critical)\n   - OSV scanner (CVE scanning)\n   - Snyk scan (if token configured)\n   - TruffleHog secret scanning\n   - Static secret scan: `node tests/security/secret-scan.cjs`\n   - Trivy container vulnerability scan\n\n7. **`zap_baseline`** job (depends on `security`):\n   - OWASP ZAP baseline scan (if target URL configured)\n\n8.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 7, "token_count": 205, "hash_short": "daccb8cf", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_008", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ret scan: `node tests/security/secret-scan.cjs`\n   - Trivy container vulnerability scan\n\n7. **`zap_baseline`** job (depends on `security`):\n   - OWASP ZAP baseline scan (if target URL configured)\n\n8. **`performance`** job (depends on `quality` and `database_tests`):\n   - k6 smoke test: `k6 run --summary-export=tests/perf/k6-summary.json tests/perf/k6-smoke.js`\n   - Performance budget assertion: `node tests/perf/assert-budgets.cjs`\n   - Lighthouse CI: `pnpm exec lhci autorun --config=tests/perf/lighthouserc.json --exit-on-error`\n   - Budgets: API p95 < 300ms, LCP < 2.5s, no >10% regression vs baseline\n\n9. **`accessibility`** job (depends on `quality` and `database_tests`):\n   - Build frontend: `pnpm --filter @fitvibe/frontend run build`\n   - Axe accessibility suite: `pnpm test:a11y`\n   - WCAG 2.1 AA compliance checks\n\n10.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 8, "token_count": 208, "hash_short": "fe45c967", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_009", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ob (depends on `quality` and `database_tests`):\n   - Build frontend: `pnpm --filter @fitvibe/frontend run build`\n   - Axe accessibility suite: `pnpm test:a11y`\n   - WCAG 2.1 AA compliance checks\n\n10. **`qa_summary`** job (depends on `quality`, `database_tests`, `performance`):\n    - Aggregate coverage and performance metrics\n    - Generate QA summary: `node tests/qa/generate-summary.mjs`\n    - Upload summary artifact\n\n**Conditional Jobs (run only on push to main/stage):**\n\n11. **`e2e`** job (depends on `integration`, runs on push to `main`/`stage`):\n    - Playwright E2E tests: `pnpm exec playwright test --config tests/frontend/e2e/playwright.config.cjs --reporter=line`\n\n12.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 9, "token_count": 170, "hash_short": "31b830b2", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_010", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "*`e2e`** job (depends on `integration`, runs on push to `main`/`stage`):\n    - Playwright E2E tests: `pnpm exec playwright test --config tests/frontend/e2e/playwright.config.cjs --reporter=line`\n\n12. **`build`** job (depends on all quality gates, runs on push to `main`/`stage`):\n    - Build and push Docker images to GHCR (multi-arch: linux/amd64, linux/arm64)\n    - Generate SBOMs (via Docker buildx)\n    - Sign images with cosign (keyless OIDC)\n    - Create GitHub release (on `main` branch)\n    - Upload container artifacts (SBOMs, digests, OpenAPI)\n\n### 10.2.2 Quality Gates & Failure Behavior\n\n> Any gate failure **blocks** the pipeline (see §9.9). Jobs run in parallel where possible, but dependencies ensure quality gates pass before downstream jobs execute.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 10, "token_count": 191, "hash_short": "52a6075b", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_011", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ality Gates & Failure Behavior\n\n> Any gate failure **blocks** the pipeline (see §9.9). Jobs run in parallel where possible, but dependencies ensure quality gates pass before downstream jobs execute.\n\n**Key Commands:**\n\n- Lint: `pnpm lint:check` (zero warnings enforced)\n- Type check: `pnpm typecheck`\n- Unit tests: Separate backend/frontend with coverage\n- Coverage gate: `pnpm test:coverage:gate` (≥80% threshold)\n- Security: High/critical CVEs block the pipeline\n- Performance: Budget violations and >10% regressions block the pipeline\n\n> Full YAML lives in `.github/workflows/ci.yml` and `.github/workflows/cd.yml`.\n\n---\n\n## 10.3 CD & Release Strategy\n\n### 10.3.1 Environments\n\n- **Staging**: auto-deploy on `main` merge; feature flags enabled for preview.\n- **Production**: manual approval; blue/green or rolling updates via Docker Compose/Swarm/Kubernetes (as available).\n\n### 10.3.2 Health & Rollout\n\n- Pre-deploy: run DB connectivity + pending migrations check.\n- Deploy sequence:\n  1.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 11, "token_count": 248, "hash_short": "ff94e7ee", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_012", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "; blue/green or rolling updates via Docker Compose/Swarm/Kubernetes (as available).\n\n### 10.3.2 Health & Rollout\n\n- Pre-deploy: run DB connectivity + pending migrations check.\n- Deploy sequence:\n  1. Pull images by **digest** from GHCR.\n  2. Run DB migrations (see §10.4) with safety checks.\n  3. Start new app containers behind NGINX.\n  4. Wait for readiness; switch traffic (blue/green) or roll one-by-one (rolling).\n\n### 10.3.3 Rollback\n\n- Keep last two releases' image digests.\n- `compose -f docker/compose.prod.yml up -d` with previous digest labels.\n- Reverse migrations only if safe; otherwise **forward-fix**.\n\n---\n\n## 10.4 Database Migrations in CD\n\n- **Expand/Contract**: apply additive changes first; code reads both old/new; remove legacy in follow-up release.\n- **Ordering**: use §6.7 list; CI verifies monotonic timestamps.\n- **Execution**: run migrations as a **one-shot job** container with the new image and `DB_MIGRATE=true`.\n- **Safety**:\n  - Dry-run in staging before prod.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 12, "token_count": 248, "hash_short": "74a11ceb", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_013", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "7 list; CI verifies monotonic timestamps.\n- **Execution**: run migrations as a **one-shot job** container with the new image and `DB_MIGRATE=true`.\n- **Safety**:\n  - Dry-run in staging before prod.\n  - Guard-rails: blocks on long locks; statement timeout (e.g., 2 s) for risky ops.\n  - Backfill tasks run asynchronously where possible.\n\n**Failure policy**: stop rollout; keep old app version serving; investigate; apply forward-fix migration.\n\n---\n\n## 10.5 Artifacts, SBOM & Signing\n\n- **OpenAPI** (`apps/backend/openapi/openapi.json`) uploaded on every CI run.\n- **Coverage reports** saved as artifacts; minimum gate enforced.\n- **SBOM** generated with **Syft**; container images **signed with cosign**.\n- **Pinned digests** used in CD to prevent tag drift.\n- Release notes include **deprecation headers** (see §7.1.1) if applicable.\n\n---\n\n## 10.6 Secrets & Configuration\n\n- **.env.example** in repo with placeholders; **.env** not committed.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 13, "token_count": 235, "hash_short": "f68c2e63", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_014", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ent tag drift.\n- Release notes include **deprecation headers** (see §7.1.1) if applicable.\n\n---\n\n## 10.6 Secrets & Configuration\n\n- **.env.example** in repo with placeholders; **.env** not committed.\n- CI uses **Actions secrets** and **environment protection rules** for staging/prod.\n- Production JWT keys loaded from secrets manager or Actions-encrypted vars.\n- Rotations documented in §12 runbooks.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 14, "token_count": 100, "hash_short": "a2ecdf32", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_015", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "I uses **Actions secrets** and **environment protection rules** for staging/prod.\n- Production JWT keys loaded from secrets manager or Actions-encrypted vars.\n- Rotations documented in §12 runbooks.\n\n---\n\n## 10.7 Local Development (DX)\n\n### 10.7.1 Quickstart\n\n```bash\npnpm install\npnpm -w build    # first-time type generation\ncp .env.example .env\ndocker compose -f docker/compose.dev.yml up -d db mailhog nginx\npnpm --filter backend migrate\npnpm --filter backend seed-dev\npnpm dev         # runs both FE & BE via turbo\n```\n\n### 10.7.2 VS Code Tasks (examples)\n\n```json\n{\n  \"version\": \"2.0.0\",\n  \"tasks\": [\n    {\n      \"label\": \"FitVibe: Dev (FE+BE)\",\n      \"type\": \"shell\",\n      \"command\": \"pnpm dev\",\n      \"group\": \"build\"\n    },\n    {\n      \"label\": \"FitVibe: Build All\",\n      \"type\": \"shell\",\n      \"command\": \"pnpm build\",\n      \"group\": \"build\"\n    },\n    {\n      \"label\": \"FitVibe: Lint + Typecheck\",\n      \"type\": \"shell\",\n      \"command\": \"pnpm lint && pnpm typecheck\",\n      \"group\": \"build\"\n    },\n    {\n      \"label\": \"FitVibe: Migrate DB\",\n      \"type\": \"shell\",\n      \"command\": \"pnpm --filter backend migrate\",\n      \"group\": \"test\"\n    },\n    {\n      \"label\": \"FitVibe: Seed Demo Data\",\n      \"type\": \"shell\",\n      \"command\": \"pnpm --filter backend seed-dev\",\n      \"group\": \"test\"\n    },\n    {\n      \"label\": \"FitVibe: Rollback Last Migration\",\n      \"type\": \"shell\",\n      \"command\": \"pnpm --filter backend migrate:rollback\",\n      \"group\": \"test\"\n    }\n  ]\n}\n```", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 15, "token_count": 371, "hash_short": "0918a79a", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_016", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "\"group\": \"test\"\n    },\n    {\n      \"label\": \"FitVibe: Rollback Last Migration\",\n      \"type\": \"shell\",\n      \"command\": \"pnpm --filter backend migrate:rollback\",\n      \"group\": \"test\"\n    }\n  ]\n}\n```\n\n\n### 10.7.3 Pre-commit Hooks\n\n- **Husky**: run `lint-staged` on staged files; prevent committing failing code.\n- Conventional commits optional (e.g., `feat:`, `fix:`) for better changelogs.\n\n### 10.7.4 Test Data & Fixtures\n\n- Ephemeral DB for tests (Docker).\n- Deterministic seeds for unit/integration; Playwright uses isolated account fixtures.\n\n---\n\n## 10.8 E2E, Perf & A11y in CI\n\n- **Playwright**: headless runs on staging build (auth flow, sessions CRUD, analytics read).\n- **k6**: per-route group scripts (auth, sessions, feed). Thresholds enforced.\n- **Lighthouse**: CI run on built frontend; budgets: LCP < 2.5 s, TBT < 200 ms, CLS < 0.1.\n- **axe**: a11y checks on core routes (see §9.6).\n\nReports uploaded as artifacts and linked in PR comments.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 16, "token_count": 238, "hash_short": "f1c12eca", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_017", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "- **Lighthouse**: CI run on built frontend; budgets: LCP < 2.5 s, TBT < 200 ms, CLS < 0.1.\n- **axe**: a11y checks on core routes (see §9.6).\n\nReports uploaded as artifacts and linked in PR comments.\n\n---\n\n## 10.9 Incident Readiness in CD\n\n- Health endpoints + synthetic probes; alerting wired to on-call channel.\n- **One-click rollback** command documented; previous digests stored.\n- DR drill checklist: restore latest backup to staging monthly; verify app boot + migrations on restored DB.\n\n---\n\n## 10.10 Governance\n\n- Pipeline changes require PR review from **owner**.\n- Exceptions to gates require **ADR** and time-bound mitigation plan.\n- Security updates prioritized; dependency bot PRs obey same gates.\n\n---\n\n**Outcome**: CI/CD codifies the NFRs from §9 as enforceable gates, produces signed artifacts with SBOM, deploys safely with migration discipline, and supports a fast, friendly local DX.\n\n---\n\n# 11.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 17, "token_count": 228, "hash_short": "bf7874c3", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_018", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "**Outcome**: CI/CD codifies the NFRs from §9 as enforceable gates, produces signed artifacts with SBOM, deploys safely with migration discipline, and supports a fast, friendly local DX.\n\n---\n\n# 11. Testability Hooks & Fixtures\n\nThis section makes the system **easy to test** and ensures verifiable conformance to the PRD and QA Plan. It defines **test strategy, fixtures, fakes/mocks, deterministic controls, datasets, coverage policy, CI wiring**, and **RTM mapping**. It is binding for both FE and BE.\n\n---\n\n## 11.1 Strategy Overview\n\n- **Goal:** Achieve QA gates (coverage â‰¥ **80%**, perf **p95 < 300 ms**, a11y **WCAG 2.1 AA**) with fast, reliable tests.\n- **Split:** Unit → Integration → E2E → Non-functional (security, perf, a11y).\n- **Determinism:** Clock/ID/mail are controllable; tests are order-independent; data isolated per test.\n- **Artifacts:** Coverage, OpenAPI, k6/Lighthouse/axe reports uploaded in CI.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 18, "token_count": 230, "hash_short": "6b092abf", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_019", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ty, perf, a11y).\n- **Determinism:** Clock/ID/mail are controllable; tests are order-independent; data isolated per test.\n- **Artifacts:** Coverage, OpenAPI, k6/Lighthouse/axe reports uploaded in CI.\n\n---\n\n## 11.2 Test Pyramid & Ownership\n\n| Layer         | Scope                             | Tools                                  | Runs In          | Owner         |\n| ------------- | --------------------------------- | -------------------------------------- | ---------------- | ------------- |\n| Unit          | pure functions, schemas, services | Jest (ts-jest), Vitest (FE)            | Node/JSdom       | Module author |\n| Integration   | API routes + DB, migrations       | Jest + Supertest + Dockerized Postgres | Container        | BE            |\n| E2E (FE)      | user flows across UI/API          | Playwright                             | Headless browser | FE            |\n| Security      | headers, auth flows, ZAP baseline | ZAP, custom checks                     | CI               | Sec/BE        |\n| Performance   | per-route groups & FE budgets     | k6, Lighthouse                         | CI               | BE/FE         |\n| Accessibility | critical screens                  | axe                                    | CI               | FE            |\n\n---", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 19, "token_count": 320, "hash_short": "e96f3640", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_020", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "use                         | CI               | BE/FE         |\n| Accessibility | critical screens                  | axe                                    | CI               | FE            |\n\n---\n\n\n## 11.3 Test Environments\n\n- **Unit:** in-memory, no DB; mocks for adapters.\n- **Integration:** ephemeral Postgres container; run **migrations** from §6.7; seed minimal data; cleanup between tests.\n- **E2E:** start backend on ephemeral port + built frontend (or dev server); use isolated test accounts; external adapters set to fakes (mail).\n- **Data separation:** unique **schema** or random database per run to avoid cross-test interference.\n\n---\n\n## 11.4 Fixtures & Factories (Backend)\n\n- **Factories** (TypeScript): `makeUser`, `makeSession`, `makeExercise`, `makePointsEvent` with sensible defaults and override options.\n- **Seeds (integration):** minimal **global** data only: exercise categories, 3 global exercises, 3 badges.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 20, "token_count": 233, "hash_short": "61b6858a", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_021", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "akeSession`, `makeExercise`, `makePointsEvent` with sensible defaults and override options.\n- **Seeds (integration):** minimal **global** data only: exercise categories, 3 global exercises, 3 badges.\n- **Per-test data:** created via factories inside transactions; rollback after test (or truncate selective tables).\n- **Clock control:** test helper exposes `setNow()`; DB timestamps rely on app clock to remain deterministic.\n\n**Example (pseudo):**\n\n```ts\nconst u = await makeUser({ alias: \"alice\" });\nconst s = await makeSession({ ownerId: u.id, plannedAt: nowPlus(1, \"day\") });\n```\n\n---\n\n## 11.5 Fakes, Mocks & Stubs\n\n- **Mail adapter:** Fake transport capturing **outbox** in memory/JSON; assertions on recipients & subjects; renders both text & HTML.\n- **AV scanner:** Fake returns `clean` by default; EICAR string triggers `malware`.\n- **Feature flags:** Test harness toggles 2FA, public feed discovery, admin global exercises.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 21, "token_count": 233, "hash_short": "db5d0afc", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_022", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ers both text & HTML.\n- **AV scanner:** Fake returns `clean` by default; EICAR string triggers `malware`.\n- **Feature flags:** Test harness toggles 2FA, public feed discovery, admin global exercises.\n- **External time/uuid:** `FakeClock`, `DeterministicUuid` for reproducible snapshots.\n\n---\n\n## 11.6 Determinism Controls\n\n- **Clock:** single source of time (DI) for API and jobs; tests call `clock.freeze('2025-10-13T12:00:00Z')`.\n- **IDs:** use ULID/UUIDv7 factory with seeded randomness.\n- **Randomness:** all PRNG seeded; property-based tests use fixed seeds for snapshots.\n\n---\n\n## 11.7 Datasets & Golden Files\n\n- **Golden responses** for selected endpoints: `/sessions`, `/analytics/summary`. Stored under `tests/backend/golden/**`.\n- **k6 datasets**: CSV/JSON users & session payloads sized for load profiles in §9.2.1.\n- **Lighthouse config** with budgets used in CI; thresholds committed under `apps/frontend/.lighthouse/`.\n- **axe rulesets**: baseline for critical screens.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 22, "token_count": 245, "hash_short": "1cad2d89", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_023", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "yloads sized for load profiles in §9.2.1.\n- **Lighthouse config** with budgets used in CI; thresholds committed under `apps/frontend/.lighthouse/`.\n- **axe rulesets**: baseline for critical screens.\n\n---\n\n## 11.8 Module-Specific Test Hooks (FR Mapping)\n\n| FR             | Critical Hooks                                                                                  | Notes                                       |\n| -------------- | ----------------------------------------------------------------------------------------------- | ------------------------------------------- |\n| FR-1 Auth      | Fake mail; token TTLs; lockout counters; 2FA TOTP with deterministic secret; session revoke API | Assert no user enumeration; headers present |\n| FR-2 Profile   | Avatar upload with AV fake; alias collision; visibility matrix                                  | `citext` uniqueness; reserved names         |\n| FR-3 Exercises | Global vs user-owned permissions; search indices; archive flow                                  | Text/trigram & GIN search                   |\n| FR-4 Sessions  | Transactional nested writes; idempotency replay; clone/complete                                 | 409 on payload mismatch for same key        |\n| FR-5 Analytics | Matview refresh after completion; large-range slicing                                           | 1MB cap; perf budget                        |\n| FR-6 Points    | Idempotent ledger; anomaly spikes alert                                                         | Backfill rate limit                         |\n| FR-7 Feed      | Publish/unpublish; link-token lifecycle; visibility                                             | Token revoke → 404                          |\n| FR-8 i18n      | Token coverage; locale negotiation                                                              | Fallback to EN tracked in dev               |\n\n---", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 23, "token_count": 472, "hash_short": "f9f0609f", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_024", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "404                          |\n| FR-8 i18n      | Token coverage; locale negotiation                                                              | Fallback to EN tracked in dev               |\n\n---\n\n\n## 11.9 Coverage Policy\n\n- **Thresholds (repo-wide):** **Lines â‰¥ 80%**, **Branches â‰¥ 80%**.\n- **Critical files** (auth, sessions writes, analytics aggregation): individual file floor **â‰¥ 90%** lines.\n- CI fails below thresholds; coverage reports published per package.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 24, "token_count": 118, "hash_short": "cfc34082", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_025", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "Branches â‰¥ 80%**.\n- **Critical files** (auth, sessions writes, analytics aggregation): individual file floor **â‰¥ 90%** lines.\n- CI fails below thresholds; coverage reports published per package.\n\n---\n\n## 11.10 CI Wiring\n\n- **Commands** (workspace root, matching `.github/workflows/ci.yml`):\n  - Quality gates: `pnpm lint:check`, `pnpm typecheck`, `pnpm test:coverage:gate`\n  - Unit tests: `pnpm --filter @fitvibe/backend test -- --coverage --maxWorkers=2`, `pnpm --filter @fitvibe/frontend test -- --coverage --maxWorkers=2`\n  - Database tests: `pnpm --filter @fitvibe/backend exec jest tests/migrations/migrations.test.ts`, `pnpm --filter @fitvibe/backend exec jest tests/seeds/seeds.test.ts`\n  - Integration tests: `pnpm --filter @fitvibe/backend exec jest --maxWorkers=2`\n  - Performance: `k6 run tests/perf/k6-smoke.js`, `pnpm exec lhci autorun --config=tests/perf/lighthouserc.json`\n  - Accessibility: `pnpm test:a11y`\n  - E2E: `pnpm exec playwright test --config tests/frontend/e2e/playwright.config.cjs`\n  - Build: `pnpm build`, `pnpm -w openapi:build`\n- **Artifacts:** `coverage/**`, `tests/perf/k6-summary.json`, `tests/perf/lhci-output`, `playwright-report`, `test-results`, `tests/qa/summary`, OpenAPI JSON, SBOMs, container digests", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 25, "token_count": 311, "hash_short": "521a7b23", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_026", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "w openapi:build`\n- **Artifacts:** `coverage/**`, `tests/perf/k6-summary.json`, `tests/perf/lhci-output`, `playwright-report`, `test-results`, `tests/qa/summary`, OpenAPI JSON, SBOMs, container digests.\n- **Parallelization:** Multiple jobs run in parallel (quality + database_tests, then secondary jobs), with dependencies ensuring quality gates pass before downstream jobs.\n\n---\n\n## 11.11 RTM Mapping (QA)\n\nA minimal RTM slice is embedded for quick checks; full matrix lives in QA Plan.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 26, "token_count": 121, "hash_short": "64f83e4a", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_027", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "econdary jobs), with dependencies ensuring quality gates pass before downstream jobs.\n\n---\n\n## 11.11 RTM Mapping (QA)\n\nA minimal RTM slice is embedded for quick checks; full matrix lives in QA Plan.\n\n| PRD Ref  | TDD Section | Test Layer   | Evidence                                       |\n| -------- | ----------- | ------------ | ---------------------------------------------- |\n| FR-1     | §4.1, §7.2  | Unit/Int/E2E | auth.spec.ts, tokens.spec.ts, e2e-auth.spec.ts |\n| FR-4     | §4.4, §7.5  | Int/E2E      | sessions.spec.ts, e2e-sessions.spec.ts         |\n| NFR-Perf | §5.3, §9    | k6           | k6-report.json, perf-thresholds.yaml           |\n| NFR-A11y | §8.5, §9    | axe          | axe-summary.json                               |\n| NFR-Sec  | §5.1        | ZAP/headers  | zap-report.html, headers.spec.ts               |\n\n---\n\n## 11.12 Frontend Testability\n\n- **data-testid** attributes on interactive elements (stable, documented).", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 27, "token_count": 237, "hash_short": "6d02eac2", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_028", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "FR-Sec  | §5.1        | ZAP/headers  | zap-report.html, headers.spec.ts               |\n\n---\n\n## 11.12 Frontend Testability\n\n- **data-testid** attributes on interactive elements (stable, documented).\n- **Mock Service Worker (MSW)** for FE unit/integration tests; E2E uses real API.\n- **Visual regression** optional (Phase 2) via Playwright snapshots for critical pages.\n\n---\n\n## 11.13 Error Injection & Chaos (Test Mode)\n\n- Toggle SMTP failure, DB read-only, object-store latency via env flags:\n  - `TEST_FAIL_SMTP=1`, `TEST_DB_READONLY=1`, `TEST_OBJSTORE_SLOW_MS=500`.\n- Verify user-facing remediation and correct HTTP statuses/timeouts.\n\n---\n\n## 11.14 Example Test Specs (Illustrative)\n\n- **auth.spec.ts**: register → verify → login → refresh → reuse-detected refresh → family revoke; lockout after N attempts; 2FA enable/disable.\n- **sessions.spec.ts**: create (idempotent), update nested, complete, clone; 409 on mismatched replay; transactional rollback on set validation fail.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 28, "token_count": 245, "hash_short": "01163871", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_029", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ke; lockout after N attempts; 2FA enable/disable.\n- **sessions.spec.ts**: create (idempotent), update nested, complete, clone; 409 on mismatched replay; transactional rollback on set validation fail.\n- **analytics.spec.ts**: after session completion, matview refresh exposes updated PRs; wide range returns 413.\n- **feed.spec.ts**: publish/unpublish; link token access; revoke returns 404.\n- **uploads.spec.ts**: EICAR blocked; metadata persisted on clean; EXIF stripped; private ACL.\n\n---\n\n## 11.15 Tooling & Helpers\n\n- **Test logger** with lower verbosity; prints `requestId` on failure.\n- **DB helpers**: `truncateAll()`, `withTransaction(testFn)`.\n- **OpenAPI validator** optional: ensure routes conform to schema in tests.\n\n---\n\n## 11.16 Exit Criteria (Per PR/Release)\n\n- All tests green; coverage thresholds met.\n- Perf/a11y/security gates pass (see §9.9).\n- No flaky tests (quarantined tests block merge).\n- Artifacts uploaded and linked in PR.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 29, "token_count": 237, "hash_short": "04d376c2", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_030", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "eria (Per PR/Release)\n\n- All tests green; coverage thresholds met.\n- Perf/a11y/security gates pass (see §9.9).\n- No flaky tests (quarantined tests block merge).\n- Artifacts uploaded and linked in PR.\n- If any exception, an ADR documents scope and timeline to return to baseline.\n\n---\n\n**Assurance**: With these hooks and fixtures, FitVibe's features are **verifiable** and **repeatable** across environments. Deviations require ADRs and updates to the QA Plan.\n\n---\n\n# 12. Operations & Runbooks\n\nThis section defines **repeatable, checklist-driven procedures** for operating FitVibe safely: monitoring, incident response, **JWT key rotation**, **session revocation**, **GDPR DSR delete**, **backup/restore drills**, **partition rotation**, **media AV failures**, **rollbacks**, and **DR**. It binds to §5 (security/privacy), §6 (data), §7 (API), §9 (NFRs), and §10 (CI/CD).\n\n> Golden rule: **Prefer forward-fix.** Keep production changes **audited** in `audit_log` and/or infra logs.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 30, "token_count": 245, "hash_short": "c8d1ce12", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_031", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "DR**. It binds to §5 (security/privacy), §6 (data), §7 (API), §9 (NFRs), and §10 (CI/CD).\n\n> Golden rule: **Prefer forward-fix.** Keep production changes **audited** in `audit_log` and/or infra logs. Any deviation requires an ADR entry.\n\n---\n\n## 12.1 On-Call Overview\n\n**Primary objective**: restore service within SLOs (latency p95 < 300 ms, error rate < 0.5%).\n\n- **Hours**: business-hours for MVP (extend later).\n- **Dashboards**: API latency/error, DB health, job queues, AV scan failures, Web Vitals.\n- **Alerts** (from §9.7.3): p95 breach, 5xx spike, DB saturation, queue backlog, AV failure spike.\n- **Escalation**: Primary → Owner (Konstantinos) → Infra support (if applicable).\n- **Communication**: status note in commit log/ops channel; user-facing status page (Phase 2).\n\n---\n\n## 12.2 Health Checks & Fast Triage\n\n### 12.2.1 Checklist (Triage in ≤ 10 minutes)\n\n1. **Readiness**: `GET /health/readiness` must be 200 and show DB OK, object store OK.\n2.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 31, "token_count": 240, "hash_short": "a9f869e6", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_032", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "tus page (Phase 2).\n\n---\n\n## 12.2 Health Checks & Fast Triage\n\n### 12.2.1 Checklist (Triage in ≤ 10 minutes)\n\n1. **Readiness**: `GET /health/readiness` must be 200 and show DB OK, object store OK.\n2. **Logs**: Scan last 15 minutes for `level=error`, top `error.code`.\n3. **DB**: Check `connections`, `locks`, long-run queries (`pg_stat_activity`).\n4. **Queue/Jobs**: backlog age; retry spikes.\n5. **Recent deploy?** If yes, consider **rollback** (see §12.7).\n\n### 12.2.2 Common Remedies\n\n- Restart single API pod/container if memory leak; keep one instance serving.\n- Pause background workers if they contend with API.\n- Scale up replicas temporarily if CPU-bound (ensure DB headroom).\n\n---\n\n## 12.3 Incident Response Playbook\n\n### 12.3.1 Severity Levels\n\n- **SEV-1**: user-visible outage/degradation > 10 min.\n- **SEV-2**: partial impairment; workarounds exist.\n- **SEV-3**: non-urgent bug; no user impact.\n\n### 12.3.2 Actions\n\n- Assign **Incident Commander** (IC).", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 32, "token_count": 241, "hash_short": "871ec942", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_033", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": ": user-visible outage/degradation > 10 min.\n- **SEV-2**: partial impairment; workarounds exist.\n- **SEV-3**: non-urgent bug; no user impact.\n\n### 12.3.2 Actions\n\n- Assign **Incident Commander** (IC).\n- Start timeline log: who/what/when.\n- Contain: rate-limit, feature-flag risky paths, rollback if recent deploy.\n- Communicate: internal note; (public status Phase 2).\n- Recover: apply forward-fix or rollback.\n- Postmortem within 48h; attach to ADR or `/docs/postmortems/`.\n\n---\n\n## 12.4 JWT Key Rotation (RS256 via JWKS)\n\n**Goal**: rotate signing keys without invalidating legitimate sessions. Rotation window typically **7 days**.\n\n### 12.4.1 Prereqs\n\n- Keys stored in secrets manager or encrypted vars.\n- JWKS endpoint served internally (`/internal/.well-known/jwks.json`).\n- API reads active `kid` from env/config; verifies against JWKS (accepts old+new).\n\n### 12.4.2 Procedure\n\n1. **Generate** new keypair: `kid=new-YYYYMMDD`. Keep old as `kid=old-YYYYMMDD`.\n2.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 33, "token_count": 241, "hash_short": "f15e0830", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_034", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "s.json`).\n- API reads active `kid` from env/config; verifies against JWKS (accepts old+new).\n\n### 12.4.2 Procedure\n\n1. **Generate** new keypair: `kid=new-YYYYMMDD`. Keep old as `kid=old-YYYYMMDD`.\n2. **Publish** new public key to JWKS (append).\n3. **Deploy** API config with `ACTIVE_KID=new-YYYYMMDD`. New tokens are issued with new `kid`.\n4. **Observe**: error rate on auth; ensure both keys validate.\n5. **Wait** until all old **access tokens** expire (e.g., 15 min) + buffer.\n6. **Revoke old refresh families** only if compromised; otherwise maintain until natural expiry.\n7. **Remove** old key from JWKS after **rotation window**; keep private part archived securely.\n\n### 12.4.3 Rollback\n\n- Set `ACTIVE_KID` to previous `kid`; ensure JWKS still contains the old key.\n\n**Audit**: record `key_rotation` event in `audit_log` with `new_kid`, `old_kid`.\n\n---\n\n## 12.5 Session Revocation (Compromise Response)\n\n**Use when** a device is lost or suspicious reuse detected.\n\n1.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 34, "token_count": 243, "hash_short": "770a9cbe", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_035", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "*Audit**: record `key_rotation` event in `audit_log` with `new_kid`, `old_kid`.\n\n---\n\n## 12.5 Session Revocation (Compromise Response)\n\n**Use when** a device is lost or suspicious reuse detected.\n\n1. **Identify** `user_id` / `sid` from alert/log.\n2. **Revoke** session (or family) via admin API: `POST /auth/sessions/revoke` with scope.\n3. **Force logout**: deny refresh for revoked `sid`; access tokens expire naturally (short TTL).\n4. **Notify user** via security email with geo/time hints (no IP in clear-text).\n5. **Optional**: rotate user's 2FA backup codes.\n\n**Verification**: attempt refresh with old token must fail; audit log records revocation.\n\n---\n\n## 12.6 GDPR DSR - Export & Delete\n\n### 12.6.1 Export (Subject Access Request)\n\n1. Verify requester identity (logged-in, email challenge).\n2. Queue export job for `user_id`.\n3. **Assemble bundle**: users, profile, sessions, exercises, points, badges, feed items, media **metadata** (not binaries by default).\n4.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 35, "token_count": 243, "hash_short": "c6a80971", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_036", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "gged-in, email challenge).\n2. Queue export job for `user_id`.\n3. **Assemble bundle**: users, profile, sessions, exercises, points, badges, feed items, media **metadata** (not binaries by default).\n4. Sign bundle hash; store in temporary object store location.\n5. Email secure download link (expires in 24 hours).\n\n### 12.6.2 Delete (Right to Erasure)\n\n1. Verify identity; warn about **irreversibility**.\n2. Mark account `DELETED(PENDING_PURGE)`; disable login.\n3. **Async purge**:\n   - Hard-delete private content: sessions, exercises (user-owned), points, feed items, media objects.\n   - Anonymize `audit_log` (`user_id` null).\n4. **Backups**: schedule purge to propagate in **≤ 14 days**; document completion timestamp.\n5. Send confirmation email when finished.\n\n**Edge cases**: Public/shared items are removed and caches purged. Legal hold is **not** expected in MVP; if needed, add exemption ADR.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 36, "token_count": 225, "hash_short": "f4f4e5dc", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_037", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "mpletion timestamp.\n5. Send confirmation email when finished.\n\n**Edge cases**: Public/shared items are removed and caches purged. Legal hold is **not** expected in MVP; if needed, add exemption ADR.\n\n---\n\n## 12.7 Release Rollback\n\n**Triggers**: p95 latency or 5xx breach post-deploy, migrations failure, critical bug.\n\n### 12.7.1 Checklist\n\n1. **Freeze** new traffic: disable auto-scaler changes.\n2. **Switch** to previous image digests (kept per §10.3.3).\n3. **Re-run readiness** until green.\n4. **Database**: avoid down migrations; prefer forward-fix. If down is safe, run with caution in off-hours.\n5. **Unfreeze**; monitor alerts for 30 minutes.\n\n**Post-rollback**: create **forward-fix** ticket and ADR note.\n\n---\n\n## 12.8 Backup & Restore Drill\n\n- **Backup**: daily full; PITR if supported; encrypted, access-controlled.\n- **Monthly drill (staging)**:\n  1. Provision fresh DB instance.\n  2. Restore latest backup; record **RTO** time.\n  3.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 37, "token_count": 236, "hash_short": "bd9972ad", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_038", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "rill\n\n- **Backup**: daily full; PITR if supported; encrypted, access-controlled.\n- **Monthly drill (staging)**:\n  1. Provision fresh DB instance.\n  2. Restore latest backup; record **RTO** time.\n  3. Start app against restored DB; run migrations if needed.\n  4. Sanity test: login, list sessions, create dummy session.\n  5. Document **RPO** (data freshness) and discrepancies.\n\nFailures are blockers; fix before next release.\n\n---\n\n## 12.9 Partition Rotation & Vacuum Policy\n\n- **sessions** (monthly partitions):\n  - **Create** next month's partition 7 days before month-end.\n  - **Detach/Archive** partitions older than 24 months (move to cheaper storage or drop after retention).\n  - Run `VACUUM (ANALYZE)` weekly and after large deletes.\n\n- **audit_log / points_events** (if partitioned): same cadence when volume high.\n\n**Script**: part-rotate job runs weekly; logs actions to `audit_log` with `action=partition_rotate`.\n\n---\n\n## 12.10 Media AV Failure Handling\n\n1.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 38, "token_count": 242, "hash_short": "fb2eec43", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_039", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "s** (if partitioned): same cadence when volume high.\n\n**Script**: part-rotate job runs weekly; logs actions to `audit_log` with `action=partition_rotate`.\n\n---\n\n## 12.10 Media AV Failure Handling\n\n1. Upload receives `suspect` or `malware` from AV.\n2. Return `422 E.MEDIA.MALWARE` to client; store quarantine metadata (no public access).\n3. Alert on spike in `av_scan_failures_total`.\n4. Auto-purge quarantined objects after 30 days.\n5. Investigate if spike: update allow-list/MIME checks; verify scanner health.\n\n---\n\n## 12.11 Disaster Recovery (DR) - Regional Failure\n\n- **Objective**: RTO ≤ 4 h, RPO ≤ 24 h.\n- **Cold standby** environment definition: infra templates, secrets, and images digests available.\n- **Procedure**:\n  1. Provision DB from last backup in DR region.\n  2. Deploy images by **digest**; set env to point to DR DB and object store.\n  3. Point DNS to DR edge.\n  4. Validate health & critical flows.\n  5.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 39, "token_count": 230, "hash_short": "eb01888e", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_040", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": ":\n  1. Provision DB from last backup in DR region.\n  2. Deploy images by **digest**; set env to point to DR DB and object store.\n  3. Point DNS to DR edge.\n  4. Validate health & critical flows.\n  5. Back-migrate data upon primary recovery if bi-directional required (MVP: single failover, manual reconcile).\n\n**Test**: annual DR exercise; document gaps.\n\n---\n\n## 12.12 Communication Templates (Internal)\n\n- **Incident Start**: â€œSEV-x at HH:MM UTC. Symptom: <latency/5xx>. Last deploy: <sha>. Actions underway: <owner>.â€\n- **Mitigation**: â€œApplied rollback to <digest>. Monitoring. Current error rate: x%.â€\n- **Resolution**: â€œResolved at HH:MM UTC. Root cause: <short>.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 40, "token_count": 169, "hash_short": "2aa01e28", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_041", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "deploy: <sha>. Actions underway: <owner>.â€\n- **Mitigation**: â€œApplied rollback to <digest>. Monitoring. Current error rate: x%.â€\n- **Resolution**: â€œResolved at HH:MM UTC. Root cause: <short>. Follow-up: <ticket/ADR>.â€\n\n---\n\n## 12.13 Runbook Index (Quick Links)\n\n- JWT Key Rotation → §12.4\n- Session Revocation → §12.5\n- DSR Export/Delete → §12.6\n- Release Rollback → §12.7\n- Backup & Restore Drill → §12.8\n- Partition Rotation → §12.9\n- Media AV Failure → §12.10\n- Disaster Recovery → §12.11\n\n---\n\n## 12.14 RACI (MVP, single-owner simplified)\n\n| Activity                | Responsible | Accountable | Consulted | Informed |\n| ----------------------- | ----------- | ----------- | --------- | -------- |\n| Deploy to prod          | Owner       | Owner       | -         | -        |\n| Incident commander      | Owner       | Owner       | -         | -        |\n| Key rotation            | Owner       | Owner       | -         | -        |\n| DSR handling            | Owner       | Owner       | -         | User     |\n| Backups & restore drill | Owner       | Owner       | -         | -        |\n\n---\n\n**Outcome**: These runbooks make operations repeatable, auditable, and aligned with FitVibe's security, privacy, and reliability targets", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 41, "token_count": 312, "hash_short": "e66e0e50", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_042", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "rill | Owner       | Owner       | -         | -        |\n\n---\n\n**Outcome**: These runbooks make operations repeatable, auditable, and aligned with FitVibe's security, privacy, and reliability targets. Keep them **current** with every release and reflect exceptions in ADRs.\n\n---\n\n# 13. Environments & Configuration Matrix\n\nThis section specifies **environment topology**, **configuration schema**, **required/optional variables**, **defaults**, **rotation policies**, **feature flags**, and **change control** for **Local**, **Staging**, and **Production**. It binds to §5.6 (Configuration & Secrets), §9 (NFRs), and §10 (CI/CD).", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 42, "token_count": 157, "hash_short": "fb678dc1", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_043", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "**defaults**, **rotation policies**, **feature flags**, and **change control** for **Local**, **Staging**, and **Production**. It binds to §5.6 (Configuration & Secrets), §9 (NFRs), and §10 (CI/CD).\n\n---\n\n## 13.1 Environments Overview\n\n| Env            | Purpose                         | Infra                                                  | Data           | Access            | API                               | Web                           |\n| -------------- | ------------------------------- | ------------------------------------------------------ | -------------- | ----------------- | --------------------------------- | ----------------------------- |\n| **Local**      | Dev & debugging                 | Docker Compose (API, DB, NGINX, MailHog)               | throwaway      | developer machine |\n| **Staging**    | Pre-production tests, CI deploy | Same topology as prod (smaller size)                   | synthetic/test | owner only        | `https://staging.api.fitvibe.app` | `https://staging.fitvibe.app` |\n| **Production** | User traffic                    | NGINX + API + Worker + Managed Postgres + Object store | real           | owner             | `https://api.fitvibe.app`         | `https://fitvibe.app`         |\n\n---", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 43, "token_count": 311, "hash_short": "8a1ba657", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_044", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ser traffic                    | NGINX + API + Worker + Managed Postgres + Object store | real           | owner             | `https://api.fitvibe.app`         | `https://fitvibe.app`         |\n\n---\n\n\n## 13.2 Configuration Schema (Validated at Boot)\n\nAll services validate configuration on startup. Missing **required** keys cause a **non-zero exit** with a masked error summary.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 44, "token_count": 95, "hash_short": "ae7850c0", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_045", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "p`         |\n\n---\n\n\n## 13.2 Configuration Schema (Validated at Boot)\n\nAll services validate configuration on startup. Missing **required** keys cause a **non-zero exit** with a masked error summary.\n\n| Key                               | Type                                              |           Required | Default                 | Notes                                      |\n| --------------------------------- | ------------------------------------------------- | -----------------: | ----------------------- | ------------------------------------------ |\n| `NODE_ENV`                        | enum(`development`,`test`,`staging`,`production`) |                Yes | `development`           |                                            |\n| `PORT`                            | int                                               |                Yes | `4100`                  | API port                                   |\n| `BASE_URL`                        | url                                               |                Yes | `http://localhost:4100` | external base URL                          |\n| `LOG_LEVEL`                       | enum(`debug`,`info`,`warn`,`error`)               |                Yes | `info`                  | prod must be `info` or higher              |\n| `DATABASE_URL`                    | string                                            |                Yes | -                       | Postgres URL                               |\n| `DB_STATEMENT_TIMEOUT_MS`         | int                                               |                Yes | `2000`                  | API-side timeout                           |\n| `JWT_PRIVATE_KEY`                 | pem                                               | Yes (prod/staging) | dev test key            | **secret**                                 |\n| `JWT_PUBLIC_KEY`                  | pem                                               |                Yes | dev test key            |                                            |\n| `ACTIVE_KID`                      | string                                            |                Yes | `dev-001`               | key id in headers                          |\n| `JWKS_URL`                        | url                                               |                 No | -                       | internal JWKS, optional for dev            |\n| `ACCESS_TOKEN_TTL_MIN`            | int                                               |                Yes | `15`                    | minutes                                    |\n| `REFRESH_TOKEN_TTL_DAYS`          | int                                               |                Yes | `14`                    | days                                       |\n| `TOTP_ENABLED`                    | bool                                              |                Yes | `false`                 | feature flag                               |\n| `SMTP_HOST`                       | string                                            |                Yes | `localhost`             |                                            |\n| `SMTP_PORT`                       | int                                               |                Yes | `1025`                  | MailHog in dev                             |\n| `SMTP_USER`                       | string                                            |                 No | -                       | required in staging/prod                   |\n| `SMTP_PASS`                       | string                                            |                 No | -                       | **secret**                                 |\n| `MAIL_FROM`                       | email                                             |                Yes | `no-reply@fitvibe.app`  | sender                                     |\n| `OBJECT_STORE_URL`                | url                                               |                Yes | `http://minio:9000`     | S3-compatible ok                           |\n| `OBJECT_STORE_BUCKET`             | string                                            |                Yes | `fitvibe`               |                                            |\n| `OBJECT_STORE_ACCESS_KEY`         | string                                            |                 No | -                       | **secret**                                 |\n| `OBJECT_STORE_SECRET_KEY`         | string                                            |                 No | -                       | **secret**                                 |\n| `MAX_UPLOAD_MB`                   | int                                               |                Yes | `5`                     | media limit                                |\n| `CORS_ALLOW_ORIGINS`              | csv                                               |                Yes | `http://localhost:5173` | staging/prod must list exact domains       |\n| `RATE_LIMIT_GLOBAL_PER5M`         | int                                               |                Yes | `300`                   | per IP                                     |\n| `RATE_LIMIT_AUTH_ATTEMPTS`        | int                                               |                Yes | `10`                    | per 15 min, per account+IP                 |\n| `RATE_LIMIT_REG_PERM`             | int                                               |                Yes | `5`                     | registrations per minute, per IP           |\n| `RATE_LIMIT_PWDRESET_PER15M`      | int                                               |                Yes | `5`                     | password reset requests per 15 min, per IP |\n| `RATE_LIMIT_SESSION_WRITES_PER5M` | int                                               |                Yes | `30`                    | session writes per 5 min, per user         |\n| `AV_SCANNER_URL`                  | url                                               |                 No | -                       | if external service                        |\n| `ENABLE_PUBLIC_FEED`              | bool                                              |                Yes | `false`                 | feature flag                               |\n| `ENABLE_ADMIN_GLOBAL_EXERCISES`   | bool                                              |                Yes | `true`                  | feature flag                               |\n| `ANALYTICS_DISABLED`              | bool                                              |                Yes | `false`                 | for privacy/testing                        |\n| `METRICS_BIND_ADDR`               | string                                            |                Yes | `0.0.0.0:9400`          | Prometheus endpoint                        |\n| `TRACING_ENABLED`                 | bool                                              |                Yes | `false`                 | enable OTel exporter                       |\n| `OTEL_EXPORTER_OTLP_ENDPOINT`     | url                                               |                 No | -                       | if `TRACING_ENABLED=true`                  |\n\n> **Note:** Secrets must **never** be logged or returned by diagnostics endpoints", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 45, "token_count": 1799, "hash_short": "e311dc08", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_046", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "|                 No | -                       | if `TRACING_ENABLED=true`                  |\n\n> **Note:** Secrets must **never** be logged or returned by diagnostics endpoints.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 46, "token_count": 44, "hash_short": "15ac5e45", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_047", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "|                 No | -                       | if `TRACING_ENABLED=true`                  |\n\n> **Note:** Secrets must **never** be logged or returned by diagnostics endpoints.\n\n---\n\n## 13.3 Environment Matrices\n\n### 13.3.1 Local (development)\n\n| Key                   | Value                                                                                  |\n| --------------------- | -------------------------------------------------------------------------------------- |\n| `NODE_ENV`            | `development`                                                                          |\n| `BASE_URL`            | `http://localhost:4100`                                                                |\n| `DATABASE_URL`        | `postgres://fitvibe:fitvibe@db:5432/fitvibe_dev`                                       |\n| `SMTP_HOST`           | `mailhog`                                                                              |\n| `SMTP_PORT`           | `1025`                                                                                 |\n| `MAIL_FROM`           | `dev@fitvibe.local`                                                                    |\n| `OBJECT_STORE_URL`    | `http://minio:9000`                                                                    |\n| `OBJECT_STORE_BUCKET` | `fitvibe-dev`                                                                          |\n| `CORS_ALLOW_ORIGINS`  | `http://localhost:5173`                                                                |\n| Feature Flags         | `TOTP_ENABLED=false`, `ENABLE_PUBLIC_FEED=false`, `ENABLE_ADMIN_GLOBAL_EXERCISES=true` |", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 47, "token_count": 406, "hash_short": "9ba40b5f", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_048", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "p://localhost:5173`                                                                |\n| Feature Flags         | `TOTP_ENABLED=false`, `ENABLE_PUBLIC_FEED=false`, `ENABLE_ADMIN_GLOBAL_EXERCISES=true` |\n\n\n### 13.3.2 Staging\n\n| Key                   | Value                                                                                |\n| --------------------- | ------------------------------------------------------------------------------------ |\n| `NODE_ENV`            | `staging`                                                                            |\n| `BASE_URL`            | `https://staging.api.fitvibe.app`                                                    |\n| `DATABASE_URL`        | managed Postgres staging                                                             |\n| `SMTP_HOST`           | provider host                                                                        |\n| `SMTP_USER/PASS`      | set via secrets                                                                      |\n| `MAIL_FROM`           | `no-reply@staging.fitvibe.app`                                                       |\n| `OBJECT_STORE_URL`    | S3 or compatible                                                                     |\n| `OBJECT_STORE_BUCKET` | `fitvibe-staging`                                                                    |\n| `CORS_ALLOW_ORIGINS`  | `https://staging.fitvibe.app`                                                        |\n| Feature Flags         | `TOTP_ENABLED=true`, `ENABLE_PUBLIC_FEED=true`, `ENABLE_ADMIN_GLOBAL_EXERCISES=true` |", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 48, "token_count": 394, "hash_short": "193e2f33", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_049", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "`https://staging.fitvibe.app`                                                        |\n| Feature Flags         | `TOTP_ENABLED=true`, `ENABLE_PUBLIC_FEED=true`, `ENABLE_ADMIN_GLOBAL_EXERCISES=true` |\n\n\n### 13.3.3 Production\n\n| Key                   | Value                                                                                |\n| --------------------- | ------------------------------------------------------------------------------------ |\n| `NODE_ENV`            | `production`                                                                         |\n| `BASE_URL`            | `https://api.fitvibe.app`                                                            |\n| `DATABASE_URL`        | managed Postgres prod                                                                |\n| `SMTP_HOST`           | provider host                                                                        |\n| `SMTP_USER/PASS`      | set via secrets                                                                      |\n| `MAIL_FROM`           | `no-reply@fitvibe.app`                                                               |\n| `OBJECT_STORE_URL`    | S3 or compatible                                                                     |\n| `OBJECT_STORE_BUCKET` | `fitvibe-prod`                                                                       |\n| `CORS_ALLOW_ORIGINS`  | `https://fitvibe.app`                                                                |\n| Feature Flags         | `TOTP_ENABLED=true`, `ENABLE_PUBLIC_FEED=true`, `ENABLE_ADMIN_GLOBAL_EXERCISES=true` |\n\n---", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 49, "token_count": 396, "hash_short": "efa6fd0a", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_050", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "s://fitvibe.app`                                                                |\n| Feature Flags         | `TOTP_ENABLED=true`, `ENABLE_PUBLIC_FEED=true`, `ENABLE_ADMIN_GLOBAL_EXERCISES=true` |\n\n---\n\n\n## 13.4 .env.example (Excerpt)\n\n```dotenv\n# Core\nNODE_ENV=development\nPORT=4100\nBASE_URL=http://localhost:4100\nLOG_LEVEL=info\n\n# Database\nDATABASE_URL=postgres://fitvibe:fitvibe@localhost:5432/fitvibe_dev\nDB_STATEMENT_TIMEOUT_MS=2000\n\n# Auth\nJWT_PRIVATE_KEY=\"-----BEGIN PRIVATE KEY-----\n...dev...\n-----END PRIVATE KEY-----\"\nJWT_PUBLIC_KEY=\"-----BEGIN PUBLIC KEY-----\n...dev...", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 50, "token_count": 144, "hash_short": "184d4f05", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_051", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "@localhost:5432/fitvibe_dev\nDB_STATEMENT_TIMEOUT_MS=2000\n\n# Auth\nJWT_PRIVATE_KEY=\"-----BEGIN PRIVATE KEY-----\n...dev...\n-----END PRIVATE KEY-----\"\nJWT_PUBLIC_KEY=\"-----BEGIN PUBLIC KEY-----\n...dev...\n-----END PUBLIC KEY-----\"\nACTIVE_KID=dev-001\nACCESS_TOKEN_TTL_MIN=15\nREFRESH_TOKEN_TTL_DAYS=14\nTOTP_ENABLED=false\n\n# Mail\nSMTP_HOST=localhost\nSMTP_PORT=1025\nSMTP_USER=\nSMTP_PASS=\nMAIL_FROM=no-reply@fitvibe.local\n\n# Object Store\nOBJECT_STORE_URL=http://localhost:9000\nOBJECT_STORE_BUCKET=fitvibe-dev\nOBJECT_STORE_ACCESS_KEY=\nOBJECT_STORE_SECRET_KEY=\n\n# CORS\nCORS_ALLOW_ORIGINS=http://localhost:5173\n\n# Limits\nMAX_UPLOAD_MB=5\nRATE_LIMIT_GLOBAL_PER5M=300\nRATE_LIMIT_AUTH_ATTEMPTS=10\nRATE_LIMIT_REG_PERM=5\nRATE_LIMIT_PWDRESET_PER15M=5\nRATE_LIMIT_SESSION_WRITES_PER5M=30\n\n# Observability\nMETRICS_BIND_ADDR=0.0.0.0:9400\nTRACING_ENABLED=false\nOTEL_EXPORTER_OTLP_ENDPOINT=\n```\n\n> The repository includes **`.env.example`**; **`.env` is not committed**.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 51, "token_count": 236, "hash_short": "4ec9b314", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_052", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "SION_WRITES_PER5M=30\n\n# Observability\nMETRICS_BIND_ADDR=0.0.0.0:9400\nTRACING_ENABLED=false\nOTEL_EXPORTER_OTLP_ENDPOINT=\n```\n\n> The repository includes **`.env.example`**; **`.env` is not committed**. CI/CD injects secrets via environment-protected variables.\n\n---\n\n## 13.5 Configuration Endpoints & Diagnostics\n\n- **`GET /health/readiness`**: includes config checks (DB reachable, object store ping). **Never** dumps secrets.\n- **`GET /config` (optional, guarded)**: returns **non-secret** runtime flags needed by the client (e.g., feature flags, max upload MB, locales).\n- **Metrics** (`/metrics`): exposes standard metrics (see §5.4).\n\n---\n\n## 13.6 Change Control & Rollout\n\n- **Config changes** tracked via Git for non-secrets, and via secret manager history for secrets.\n- **Two-person rule** optional (Phase 2); MVP requires owner approval for staging/prod.\n- **Rollout**: staging first; verify dashboards and smoke tests; then promote to production.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 52, "token_count": 238, "hash_short": "dab77013", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_053", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "story for secrets.\n- **Two-person rule** optional (Phase 2); MVP requires owner approval for staging/prod.\n- **Rollout**: staging first; verify dashboards and smoke tests; then promote to production.\n- **Audit**: record `config_change` in `audit_log` including changed keys (masked) and actor.\n\n---\n\n## 13.7 Secrets Handling & Rotation\n\n- Secrets stored in secret manager or GH Actions environment secrets.\n- **JWT keys** rotated per §12.4; other secrets rotated **quarterly** or on incident.\n- Avoid long-lived credentials; prefer tokens with scopes.\n- Never print secrets in logs; redact suspicious values in error messages.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 53, "token_count": 156, "hash_short": "31bde1aa", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_054", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "d per §12.4; other secrets rotated **quarterly** or on incident.\n- Avoid long-lived credentials; prefer tokens with scopes.\n- Never print secrets in logs; redact suspicious values in error messages.\n\n---\n\n## 13.8 Feature Flags & Kill-Switches\n\n| Flag                            | Default                              | Scope | Notes                                  |\n| ------------------------------- | ------------------------------------ | ----- | -------------------------------------- |\n| `TOTP_ENABLED`                  | `false` (dev), `true` (staging/prod) | BE+FE | Enables 2FA setup/verify UIs and flows |\n| `ENABLE_PUBLIC_FEED`            | `false` (dev), `true` (staging/prod) | BE+FE | Allows public/link visibility          |\n| `ENABLE_ADMIN_GLOBAL_EXERCISES` | `true`                               | BE+FE | Admin CRUD for global library          |\n| `KILL_SWITCH_ANALYTICS`         | `false`                              | FE    | Hide analytics pages under stress      |\n| `READ_ONLY_MODE`                | `false`                              | BE    | Blocks writes except admin             |\n\n**Kill-switches** are loaded at startup; certain critical ones (e.g., `READ_ONLY_MODE`) can be polled on an interval (e.g., 30s) to toggle without redeploy", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 54, "token_count": 317, "hash_short": "3e185131", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_055", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "| Blocks writes except admin             |\n\n**Kill-switches** are loaded at startup; certain critical ones (e.g., `READ_ONLY_MODE`) can be polled on an interval (e.g., 30s) to toggle without redeploy.\n\n---\n\n## 13.9 Safe Defaults\n\n- **Production hardening** set automatically when `NODE_ENV=production`:\n  - `LOG_LEVEL=info` (no debug), `CORS_ALLOW_ORIGINS` must be explicit domains,\n  - cookies `Secure` and `SameSite`, HSTS enabled, error messages generic,\n  - rate limits enabled with non-zero thresholds, analytics enabled but non-PII.\n\n- **Staging** mimics production; emails are **sandboxed** to a safe domain or disabled for real recipients.\n\n---\n\n## 13.10 Drift Detection\n\n- CI step validates `.env.example` vs runtime config schema and flags **missing/extra keys**.\n- A nightly job hits `/health/readiness` and checks a **config hash** exposed there to detect unexpected drift across replicas.\n\n---\n\n## 13.11 Ownership & Approvals\n\n- **Owner** approves changes in staging/prod.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 55, "token_count": 246, "hash_short": "151a7d2c", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_056", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "job hits `/health/readiness` and checks a **config hash** exposed there to detect unexpected drift across replicas.\n\n---\n\n## 13.11 Ownership & Approvals\n\n- **Owner** approves changes in staging/prod.\n- Emergency changes allowed only to mitigate incidents; an ADR documents rationale and remediation plan within 48 hours.\n\n---\n\n**Outcome**: Configuration is **explicit, validated, and auditable**. Environments remain consistent, secrets safe, and feature flags give controlled flexibility without risking security or reliability.\n\n---\n\n# 14. Risks, Assumptions, and Constraints\n\nThis section tracks **known risks**, **explicit assumptions**, and **hard constraints** for the MVP. Each risk has an owner, mitigation, and verification hook so it can be managed in day-to-day work and reflected in ADRs when design changes are needed.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 56, "token_count": 207, "hash_short": "964fce2e", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_057", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "tions**, and **hard constraints** for the MVP. Each risk has an owner, mitigation, and verification hook so it can be managed in day-to-day work and reflected in ADRs when design changes are needed.\n\n---\n\n## 14.1 Risk Register (MVP)\n\nLegend: **L**=Likelihood (Low/Med/High), **I**=Impact (Low/Med/High), **R**=Risk Level (LÃ—I)\n\n| ID   | Risk                                                                   | L   | I   | R     | Mitigation / Controls                                                                                                      | Contingency / Triggers                                                                               | Owner | Status |\n| ---- | ---------------------------------------------------------------------- | --- | --- | ----- | -------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | ----- | ------ |\n| R-01 | **Bus factor = 1** (solo owner); delayed incident response or releases | H   | H   | **H** | Documented runbooks (§12); CI/CD automation (§10); infra as code; keep rollback one command away; small, frequent releases | If on-call unavailable → extend maintenance window; pause feature work; prioritize automation & docs | Owner | Open   |\n| R-02 | API performance misses p95 < 300 ms under spikes                       | M   | H   | **H** | Hot-index map (§6.3); k6 gates (§9.2.4); caching/ETag; DB timeouts                                                         | Auto-scale API; enable read-only mode for heavy analytics                                            | Owner | Open   |\n| R-03 | Security headers or CORS misconfig in prod                             | M   | H   | **H** | NGINX template checked-in; CI header tests; ZAP baseline (§9.3)                                                            | Immediate config rollback; block deploys until fixed                                                 | Owner | Open   |\n| R-04 | Token reuse/refresh rotation bugs → session hijack window              | L   | H   | **M** | Reuse detection, family revoke; short access TTL; deterministic tests (§11)                                                | Force global logout; rotate keys (§12.4)                                                             | Owner | Open   |\n| R-05 | GDPR DSR delete not fully propagated to backups in ≤14d                | M   | M   | **M** | Delete queue with audit trail; backup purge checklist (§12.6)                                                              | Temporarily disable new signups; manual purge + postmortem                                           | Owner | Open   |\n| R-06 | Media uploads accept malware or PII leaks via EXIF                     | M   | M   | **M** | AV scan + EXIF strip; MIME allow-list; quarantine and alerts (§5.1.6, §12.10)                                              | Block uploads; rotate allow-list; incident notice if required                                        | Owner | Open   |\n| R-07 | Analytics queries exceed 1 MB / time budgets                           | M   | M   | **M** | Enforce server-side slicing; matviews; CI perf gates                                                                       | Temporarily disable analytics endpoints (§9.5)                                                       | Owner | Open   |\n| R-08 | Vendor lock-in: object store / SMTP provider                           | M   | M   | **M** | Adapter pattern; config via env; smoke tests                                                                               | Switch provider via config; replay failed jobs                                                       | Owner | Open   |\n| R-09 | Data corruption from nested session writes                             | L   | H   | **M** | Single-transaction writes; schema constraints; property tests                                                              | Run repair job from audit; restore from backup if needed                                             | Owner | Open   |\n| R-10 | Rate-limit tuning blocks legitimate users or allows abuse              | M   | M   | **M** | Metrics for 429; separate per-IP & per-account buckets; `Retry-After`                                                      | Adjust buckets; add captcha (Phase 2)                                                                | Owner | Open   |\n| R-11 | i18n token coverage gaps or fallback errors                            | M   | L   | **L** | CI coverage check; fallback EN; telemetry in dev                                                                           | Hotfix missing tokens; add lint                                                                      | Owner | Open   |\n| R-12 | Schema migrations cause locks/outage                                   | L   | H   | **M** | Expand/contract, statement timeouts, staging dry-run (§10.4)                                                               | Rollback app; forward-fix migration                                                                  | Owner | Open   |\n| R-13 | Observability cardinality explosion                                    | M   | M   | **M** | Label allow-list; route templates; alerts on series count (§5.4)                                                           | Drop high-card labels; reduce sample rate                                                            | Owner | Open   |\n| R-14 | Legal/ToS exposure from public feed content                            | L   | H   | **M** | Private by default; takedown workflow; audit for admin actions (§4.7, §5.2)                                                | Disable public feed flag; remove offending content                                                   | Owner | Open   |\n| R-15 | Cost overrun (DB size, object storage, egress)                         | M   | M   | **M** | Lifecycle rules; partition/archival; logging sampling                                                                      | Tighten retention; scale down non-critical services                                                  | Owner | Open   |\n\n**Review cadence:** weekly scan; update status and add ADRs for structural mitigations", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 57, "token_count": 1578, "hash_short": "66ef37bb", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_058", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "retention; scale down non-critical services                                                  | Owner | Open   |\n\n**Review cadence:** weekly scan; update status and add ADRs for structural mitigations.\n\n---\n\n## 14.2 Assumptions (Make them explicit)\n\n1. **MVP user base** is modest (≤ a few thousand monthly active), allowing single-node API + managed Postgres to meet SLOs.\n2. **Email delivery** via a reliable SMTP provider with acceptable deliverability from day 1 (DKIM/SPF configured).\n3. **Static i18n** (EN/DE) is sufficient for MVP;\n4. **No legal hold** scenarios for data deletion in MVP; full removal is permissible after identity verification.\n5. **Browser target**: modern evergreen browsers; no IE/legacy edge cases.\n6. **Single region** hosting is acceptable for MVP with DR plan in §12.11.\n7. **Users accept** typical password and 2FA flows; social login is not required in MVP.\n\n> If any assumption breaks, raise an ADR to capture the pivot and its design impact.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 58, "token_count": 244, "hash_short": "72f1dcf8", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_059", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "with DR plan in §12.11.\n7. **Users accept** typical password and 2FA flows; social login is not required in MVP.\n\n> If any assumption breaks, raise an ADR to capture the pivot and its design impact.\n\n---\n\n## 14.3 Constraints (Non-negotiables for MVP)\n\n- **Security/Privacy**: RS256 JWT with refresh rotation; CSP/HSTS/Referrer/Permissions headers; **no PII** in logs/metrics.\n- **GDPR**: DSR export & delete supported; backup purge ≤ **14 days** after deletion completion.\n- **Performance**: API **p95 < 300 ms**; FE **LCP < 2.5 s** (P75); payload caps (req ≤ 2 MB, resp ≤ 1 MB).\n- **Quality**: **Coverage â‰¥ 80%** repo-wide; ZAP baseline no high findings; k6/Lighthouse budgets enforced in CI.\n- **Reliability**: RPO ≤ 24 h; RTO ≤ 4 h; health/readiness endpoints mandatory.\n- **Architecture**: Postgres primary; REST/JSON; `/api/v1` versioning; additive changes only in v1.\n- **Operations**: Blue/green or rolling deploy; migrations follow expand/contract; signed images + SBOM.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 59, "token_count": 245, "hash_short": "8f716ebe", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_060", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "rchitecture**: Postgres primary; REST/JSON; `/api/v1` versioning; additive changes only in v1.\n- **Operations**: Blue/green or rolling deploy; migrations follow expand/contract; signed images + SBOM.\n- **Compliance artifacts**: PRD/TDD/QA kept in sync; RTM updated when features change.\n\n---\n\n## 14.4 Open Questions / TBDs\n\n- _(Resolved)_ Exact token TTLs: **email verification = 15 minutes** (see §4.1.5).\n- **Admin scope** for global exercise library moderation (future: proposals from users?).\n- **Public feed discovery**: will there be search/hashtags in MVP or only direct links/user profiles?\n- **Object storage** choice for prod (S3 vs self-hosted MinIO); cost/performance trade-offs.\n- **Tracing exporter**: enable in prod from day 1 or after initial stabilization?\n- **Access model** for analytics sharing (exportable images/links?).\n\nEach TBD should be resolved via an ADR before release.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 60, "token_count": 224, "hash_short": "4546278a", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_061", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ing exporter**: enable in prod from day 1 or after initial stabilization?\n- **Access model** for analytics sharing (exportable images/links?).\n\nEach TBD should be resolved via an ADR before release.\n\n---\n\n## 14.5 Risk Heatmap (Textual)\n\n```\nImpact\nHigh   : [R-01][R-02][R-03][R-04][R-12][R-14]\nMedium : [R-05][R-06][R-07][R-08][R-09][R-10][R-13][R-15]\nLow    : [R-11]\n\n         Low     Med     High\nLikelihood\nLow      R-04    R-09    R-12\nMedium   R-11    R-05    R-02 R-03 R-06 R-07 R-08 R-10 R-13 R-15\nHigh     R-01    -       -\n```\n\n---\n\n## 14.6 Links to Related ADRs (Planned)\n\n- **ADR-001**: API Versioning Policy (v1 additive; v2 for breaking changes).\n- **ADR-002**: Auth Tokens & Rotation Strategy.\n- **ADR-003**: Data Retention & GDPR Backup Purge Window.\n- **ADR-004**: Media Upload Safety & AV Scanning.\n- **ADR-005**: Partitioning Strategy for `sessions` and `audit_log`.\n- **ADR-006**: Observability Cardinality Policy.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 61, "token_count": 233, "hash_short": "77def0a6", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_062", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ion & GDPR Backup Purge Window.\n- **ADR-004**: Media Upload Safety & AV Scanning.\n- **ADR-005**: Partitioning Strategy for `sessions` and `audit_log`.\n- **ADR-006**: Observability Cardinality Policy.\n- **ADR-007**: Idempotency Policy for Writes\n- **ADR-008**: Materialized Views for Analytics\n- **ADR-009**: Global Exercise Library Ownership Model\n- **ADR-010**: Public/Link/Private Visibility Model\n- **ADR-011**: Internationalization – Hybrid Model with MVP Static-Only Rollout\n- **ADR-012**: Monorepo Structure, Tooling, and Governance\n- **ADR-013**: Modular Backend Architecture (Router → Service → Repository)\n- **ADR-014**: Technology Stack & Runtime Standards\n- **ADR-015**: API Design & Internationalization (Hybrid) – MVP Static, UGC Translation Feature-Flagged\n- **ADR-016**: Security Middleware & Audit Logging\n- **ADR-017**: Avatar Handling & Media Storage (Object Storage + AV Scan)\n- **ADR-018**: CI/CD with GitHub Actions and GHCR\n- **ADR-019**: Caching & Performance Strategy\n- **ADR-020**: Accessibility Compliance (WCAG 2.1 AA) & Inclusive UX\n- **ADR-021**: Standardize Backend Test Runner on Jest 30 + @swc/jest\n\n---\n\n**Maintenance**: Update this register at the end of each sprint/release", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 62, "token_count": 302, "hash_short": "bd5ecbf3", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_063", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ccessibility Compliance (WCAG 2.1 AA) & Inclusive UX\n- **ADR-021**: Standardize Backend Test Runner on Jest 30 + @swc/jest\n\n---\n\n**Maintenance**: Update this register at the end of each sprint/release. Risks that require structural changes must reference an ADR and update PRD/QA acceptance where applicable.\n\n---\n\n# 15. ADR Index & References\n\nThis section catalogs the **Architecture Decision Records (ADRs)** that govern FitVibe's design and implementation, and provides a consolidated **reference list** to source documents. Every material change to architecture, data, security, or contracts must be captured by an ADR and cross-linked from the PRD, TDD, and QA Plan (traceability).\n\n---\n\n## 15.1 ADR Process\n\n- **Format**: MADR style (lightweight Markdown). One decision per file.\n- **Location**: `docs/adr/ADR-XXX-title.md` (three-digit, zero-padded index).\n- **Status lifecycle**: `Proposed → Accepted → Superseded → Deprecated`.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 63, "token_count": 234, "hash_short": "4b171fee", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_064", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "e (lightweight Markdown). One decision per file.\n- **Location**: `docs/adr/ADR-XXX-title.md` (three-digit, zero-padded index).\n- **Status lifecycle**: `Proposed → Accepted → Superseded → Deprecated`.\n- **Change control**: Any PR touching §5 (security), §6 (data), §7 (API), or §9 (NFRs) must reference an **ADR** (new or existing).\n- **Linking**: Each ADR must link the affected sections: PRD §_, TDD §_, QA §\\*, and list impacted tests/gates.\n- **Decision date**: UTC date in header.\n- **Rationale & consequences**: mandatory; list alternatives considered.\n- **Supersession**: if an ADR replaces another, set `Supersedes:`/`Superseded by:` headers.\n\nAll ADR IDs must **match the filename** under `docs/adr/` and every accepted ADR must link back to the exact sections it changes (PRD/TDD/QA).", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 64, "token_count": 198, "hash_short": "d2b993a9", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_065", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "s another, set `Supersedes:`/`Superseded by:` headers.\n\nAll ADR IDs must **match the filename** under `docs/adr/` and every accepted ADR must link back to the exact sections it changes (PRD/TDD/QA).\n\n### 15.1.1 ADR Template (copy/paste)\n\n```markdown\n---\nid: ADR-XXX\ntitle: \"<Short, imperative decision>\"\nstatus: \"Proposed | Accepted | Superseded | Deprecated\"\ndate: \"YYYY-MM-DD\"\nsupersedes: \"ADR-YYY (optional)\"\nsuperseded_by: \"ADR-ZZZ (optional)\"\nowners: [\"Konstantinos Pilpilidis (Dr.)\"]\nlinks:\n  - PRD: \"docs/1. Product Requirements Document.md#<section>\"\n  - TDD: \"docs/2. Technical Design Document.md#<section>\"\n  - QA: \"docs/3.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 65, "token_count": 158, "hash_short": "2ce8a7d6", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_066", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "Z (optional)\"\nowners: [\"Konstantinos Pilpilidis (Dr.)\"]\nlinks:\n  - PRD: \"docs/1. Product Requirements Document.md#<section>\"\n  - TDD: \"docs/2. Technical Design Document.md#<section>\"\n  - QA: \"docs/3. Testing and Quality Assurance Plan.md#<section>\"\n---\n\n## Context\n\n<Problem statement, constraints, drivers, stakeholders>\n\n## Decision\n\n<What is decided; include exact contracts/values if applicable>\n\n## Status & Consequences\n\n<Operational, security, cost, and team impact; migration plan if any>\n\n## Alternatives Considered\n\n- Alternative A : pros/cons\n- Alternative B : pros/cons\n\n## Implementation Notes\n\n<Follow-up tasks, feature flags, rollout, telemetry/alerting>\n\n## Backout Plan\n\n<Rollback steps or superseding ADR plan>\n```\n\n---\n\n## 15.2 ADR Index (Planned & Suggested)\n\n> Populate as decisions are made. The IDs and titles below reflect items already implied by the TDD/PRD/QA and should be created early.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 66, "token_count": 228, "hash_short": "7247e62d", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_067", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "g ADR plan>\n```\n\n---\n\n## 15.2 ADR Index (Planned & Suggested)\n\n> Populate as decisions are made. The IDs and titles below reflect items already implied by the TDD/PRD/QA and should be created early.\n\n| ID      | Title                                                                                    | Status      | Summary                                                                                                                                              | Decision Date | Links                                                         |\n| ------- | ---------------------------------------------------------------------------------------- | ----------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- | ------------------------------------------------------------- |\n| ADR-001 | API Versioning Policy (v1 additive; v2 for breaking changes)                             | ✅ Accepted | `/api/v1` is stable; additive fields only; deprecations use `Deprecation/Sunset` headers; breaking changes land in `/api/v2` with 2-release overlap", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 67, "token_count": 289, "hash_short": "5613be95", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_068", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "changes)                             | ✅ Accepted | `/api/v1` is stable; additive fields only; deprecations use `Deprecation/Sunset` headers; breaking changes land in `/api/v2` with 2-release overlap. | 2025-10-13    | TDD §7.1.4, §7.1.1                                            |\n| ADR-002 | Auth Tokens & Rotation Strategy                                                          | ✅ Accepted | RS256 JWT with 15m access, 14d refresh; refresh rotation + reuse detection; JWKS-based key rotation.                                                 | 2025-10-13    | TDD §5.1.1, §12.4                                             |\n| ADR-003 | Data Retention & GDPR Backup Purge Window                                                | ✅ Accepted | Classification table; DSR delete hard-deletes private content and purges backups ≤14 days; audit trail.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 68, "token_count": 212, "hash_short": "b434489e", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_069", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "| ✅ Accepted | Classification table; DSR delete hard-deletes private content and purges backups ≤14 days; audit trail.                                              | 2025-10-13    | TDD §6.6, §12.6                                               |\n| ADR-004 | Media Upload Safety & AV Scanning                                                        | ✅ Accepted | AV scan before persistence; allow-list MIME; EXIF strip; quarantine on suspect/malware; alerting.                                                    | 2025-10-13    | TDD §5.1.6, §12.10                                            |\n| ADR-005 | Partitioning Strategy for `sessions` (monthly)                                           | ✅ Accepted | Range partition on `planned_at` with default partition; rotate & archive after 24 months.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 69, "token_count": 199, "hash_short": "a52d1885", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_070", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "| ✅ Accepted | Range partition on `planned_at` with default partition; rotate & archive after 24 months.                                                            | 2025-10-13    | TDD §6.4, §12.9                                               |\n| ADR-006 | Observability Cardinality Policy                                                         | ✅ Accepted | Route templates in labels, bounded label sets, no PII; alerts on series count growth.                                                                | 2025-10-13    | TDD §5.4                                                      |\n| ADR-007 | Idempotency Policy for Writes                                                            | ✅ Accepted | `Idempotency-Key` header; 24h storage; 409 on payload mismatch; deterministic replay.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 70, "token_count": 198, "hash_short": "d44ed9ed", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_071", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "| ✅ Accepted | `Idempotency-Key` header; 24h storage; 409 on payload mismatch; deterministic replay.                                                                | 2025-10-13    | TDD §5.7, §7.14                                               |\n| ADR-008 | Materialized Views for Analytics                                                         | ✅ Accepted | Use matviews for `session_summary`, `weekly_aggregates`; incremental refresh on writes + scheduled.                                                  | 2025-10-13    | TDD §4.5, §6.3                                                |\n| ADR-009 | Global Exercise Library Ownership Model                                                  | ✅ Accepted | Admin-owned global records (`owner_id = NULL`); user-owned duplicates allowed via normalized uniqueness.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 71, "token_count": 203, "hash_short": "6ff38ac9", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_072", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "| ✅ Accepted | Admin-owned global records (`owner_id = NULL`); user-owned duplicates allowed via normalized uniqueness.                                             | 2025-10-13    | TDD §4.3, §6.2.6                                              |\n| ADR-010 | Public/Link/Private Visibility Model                                                     | ✅ Accepted | Resource visibility enum with default **private**; link tokens revocable; public feed feature-flagged.                                               | 2025-10-13    | TDD §4.7, §7.8                                                |\n| ADR-011 | Internationalization – Hybrid Model with MVP Static-Only Rollout                         | ✅ Accepted | Static UI catalogs (EN/DE) for MVP; feature-flagged AI translation for UGC with caching, PII redaction, and DSR purge.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 72, "token_count": 206, "hash_short": "f26bea43", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_073", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "nly Rollout                         | ✅ Accepted | Static UI catalogs (EN/DE) for MVP; feature-flagged AI translation for UGC with caching, PII redaction, and DSR purge.                               | 2025-10-14    | [ADR-011](./ADR-011-internationalization-hybrid-approach.md)  |\n| ADR-012 | Monorepo Structure, Tooling, and Governance                                              | ✅ Accepted | pnpm workspaces + optional Turbo; Dockerized CI; governance via CODEOWNERS, changesets, and feature flags.                                           | 2025-10-14    | [ADR-012](./ADR-012-monorepo-structure.md)                    |\n| ADR-013 | Modular Backend Architecture (Router → Service → Repository)                             | ✅ Accepted | Three-layer modules (router/service/repo); strict authz, audit, caching seams; Knex migrations.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 73, "token_count": 210, "hash_short": "8afd1162", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_074", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "sitory)                             | ✅ Accepted | Three-layer modules (router/service/repo); strict authz, audit, caching seams; Knex migrations.                                                      | 2025-10-14    | [ADR-013](./ADR-013-modular-backend-architecture.md)          |\n| ADR-014 | Technology Stack & Runtime Standards                                                     | ✅ Accepted | Node/Express, React/Vite, Postgres + Knex, object storage for media, strong headers/CSRF/RBAC; OpenAPI in CI.                                        | 2025-10-14    | [ADR-014](./ADR-014-technology-stack.md)                      |\n| ADR-015 | API Design & Internationalization (Hybrid) – MVP Static, UGC Translation Feature-Flagged | ✅ Accepted | REST/JSON `/v1`, RFC7807 errors, idempotency, cursor pagination; i18n hybrid at API with feature flag.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 74, "token_count": 211, "hash_short": "478a0801", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_075", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ic, UGC Translation Feature-Flagged | ✅ Accepted | REST/JSON `/v1`, RFC7807 errors, idempotency, cursor pagination; i18n hybrid at API with feature flag.                                               | 2025-10-14    | [ADR-015](./ADR-015-api-design-and-i18n-hybrid.md)            |\n| ADR-016 | Security Middleware & Audit Logging                                                      | ✅ Accepted | CSP/HSTS/Referrer/Permissions, CSRF, RBAC; PII-free audit logs with correlation IDs and tamper-evidence.                                             | 2025-10-14    | [ADR-016](./ADR-016-audit-logging-and-security-middleware.md) |\n| ADR-017 | Avatar Handling & Media Storage (Object Storage + AV Scan)                               | ✅ Accepted | Server-mediated uploads; AV scan; EXIF strip; derivatives; signed URLs; private-by-default.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 75, "token_count": 209, "hash_short": "912f66e9", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_076", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "Scan)                               | ✅ Accepted | Server-mediated uploads; AV scan; EXIF strip; derivatives; signed URLs; private-by-default.                                                          | 2025-10-14    | [ADR-017](./ADR-017-avatar-handling-base64.md)                |\n| ADR-018 | CI/CD with GitHub Actions and GHCR                                                       | ✅ Accepted | GitHub Actions with quality gates; GHCR images with SBOM/provenance; OIDC, signed releases, manual prod gate.                                        | 2025-10-14    | [ADR-018](./ADR-018-ci-cd-github-ghcr.md)                     |\n| ADR-019 | Caching & Performance Strategy                                                           | ✅ Accepted | Layered caching with explicit invalidation; API p95 < 300 ms; LCP < 2.5 s; fail on >10% regression.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 76, "token_count": 211, "hash_short": "5233da93", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_077", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "| ✅ Accepted | Layered caching with explicit invalidation; API p95 < 300 ms; LCP < 2.5 s; fail on >10% regression.                                                  | 2025-10-14    | [ADR-019](./ADR-019-caching-and-performance-strategy.md)      |\n| ADR-020 | Accessibility Compliance (WCAG 2.1 AA) & Inclusive UX                                    | ✅ Accepted | Semantics-first components, keyboard flows, contrast, alt text; Lighthouse/axe in CI with ≥90 score.                                                 | 2025-10-14    | [ADR-020](./ADR-020-accessibility-compliance.md)              |\n| ADR-021 | Standardize Backend Test Runner on Jest 30 + @swc/jest                                   | ✅ Accepted | Adopt _Jest 30_ with _@swc/jest_ for the backend test runner (unit + integration with Supertest), replacing ts-jest.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 77, "token_count": 206, "hash_short": "08bf61fc", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_078", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "t                                   | ✅ Accepted | Adopt _Jest 30_ with _@swc/jest_ for the backend test runner (unit + integration with Supertest), replacing ts-jest.                                 | 2025-10-14    | [ADR-021](./ADR-021-test-runner-backend-jest30-sw.md)         |\n\n> When an ADR is **Accepted**, update the `Status` column and add its file path in the Links cell (e.g., `docs/adr/ADR-001-api-versioning.md`).\n\n---\n\n## 15.3 Reference Documents (Repository Canon)\n\n| Doc                                       | Purpose                                  | Path                                            |\n| ----------------------------------------- | ---------------------------------------- | ----------------------------------------------- |\n| **PRD** - Product Requirements Document   | WHAT & WHY                               | `docs/1. Product Requirements Document.md`      |\n| **TDD** - Technical Design Document       | HOW (architecture, data, APIs)           | `docs/2.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 78, "token_count": 248, "hash_short": "74a0c05e", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_079", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "ment   | WHAT & WHY                               | `docs/1. Product Requirements Document.md`      |\n| **TDD** - Technical Design Document       | HOW (architecture, data, APIs)           | `docs/2. Technical Design Document.md`          |\n| **QA Plan** - Testing & Quality Assurance | HOW WELL (tests, gates, RTM)             | `docs/3. Testing and Quality Assurance Plan.md` |\n| **SECURITY** - Security & Privacy Policy  | Normative security posture, GDPR anchors | `docs/SECURITY.md`                              |\n| **Tasks.md / Roadmap**                    | Delivery planning, milestones            | `docs/Tasks.md`                                 |\n| **Changelog**                             | User-visible changes per release         | `CHANGELOG.md`                                  |\n| **Contributing**                          | Repo standards, coding guide             | `docs/CONTRIBUTING.md`                          |\n\n---\n\n## 15.4 How to Add a New ADR (Checklist)\n\n1.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 79, "token_count": 246, "hash_short": "9beb78ec", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_080", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "|\n| **Contributing**                          | Repo standards, coding guide             | `docs/CONTRIBUTING.md`                          |\n\n---\n\n## 15.4 How to Add a New ADR (Checklist)\n\n1. **Create file** `docs/adr/ADR-XYZ-title.md` from the template in §15.1.1.\n2. Fill **Context → Decision → Consequences → Alternatives**.\n3. Cross-link affected sections in PRD/TDD/QA.\n4. Add to table in §15.2 with `Proposed` status.\n5. Submit PR; on approval, set status to `Accepted` and add decision date.\n6. If superseding a prior ADR, update both records' headers accordingly.\n7. Ensure related **tests/gates** are updated (coverage, perf, a11y, security).\n\n---\n\n## 15.5 Governance & Review Cadence\n\n- **Owner** approves ADRs; complex ones can include an optional design review meeting.\n- ADRs that impact external contracts (APIs, data retention, privacy) require **explicit mention** in the release notes.", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 80, "token_count": 225, "hash_short": "7aca0b19", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc_chunk_081", "doc_id": ".._.._docs_2.Technical_Design_Document_2e.Technical_Design_Document_misc", "text": "r** approves ADRs; complex ones can include an optional design review meeting.\n- ADRs that impact external contracts (APIs, data retention, privacy) require **explicit mention** in the release notes.\n- Conduct a **quarterly sweep** to retire deprecated ADRs and confirm no drift between ADRs and implementation.\n\n---\n\n**Outcome**: With ADRs rigorously maintained and referenced here, architectural intent stays **explicit, auditable, and synchronized** with the PRD, TDD, and QA Plan.\n\n---\n\n- See also [Tech Stack](./2a.Technical_Design_Document_TechStack.md)\n- See also [Modules](./2b.Technical_Design_Document_Modules.md)\n- See also [Data](./2c.Technical_Design_Document_Data.md)\n- See also [Design & Architecture](./2d.Technical_Design_Document_APIDesign.md)", "source_file": "../../docs/2.Technical_Design_Document/2e.Technical_Design_Document_misc.md", "category": "technical", "chunk_index": 81, "token_count": 190, "hash_short": "c7e6599a", "version": 1.0, "title": "0. Introduction", "mtime": "2025-11-30T03:53:28.227540", "ingested_at": "2025-11-30T04:00:42.088197", "tags": ["technical", "md"]}
