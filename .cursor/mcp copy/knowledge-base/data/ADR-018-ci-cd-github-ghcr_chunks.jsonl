{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr_chunk_000", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr", "text": "# ADR-018: CI/CD with GitHub Actions and GHCR\n\n**Date:** 2025-10-14  \n**Status:** Accepted  \n**Author:** Reviewer  \n**Cross-References:** PRD §7 Engineering Standards; PRD §5 NFRs (security/perf); TDD §9–§10 Build/Run/Deploy; QA §2–§14 CI gates (tests, perf, a11y, security)\n\n---\n\n\n## Context\n\nWe require a deterministic, secure, and budget-enforcing delivery pipeline. The PRD, TDD, and QA plan define mandatory stages (lint, type-check, unit/integration/E2E tests), performance/a11y/security gates, and containerized releases. This ADR standardizes the CI/CD implementation on **GitHub Actions** with **GHCR** for images, **OIDC** for cloud access, and signed/supported artifacts (SBOM, SLSA provenance).\n\n---\n\n## Decision\n\n1. **Triggers & Branch Strategy**\n   - **All PRs**: run full CI (quality gates, tests, security, performance, accessibility).\n   - **Push to `main`, `dev`, `stage`**: run full CI + build images + publish tags (E2E and build jobs enabled).", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-018-ci-cd-github-ghcr.md", "category": "technical", "chunk_index": 0, "token_count": 241, "hash_short": "32ddbc7c", "version": 1.0, "title": "ADR-018: CI/CD with GitHub Actions and GHCR", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:44.142059", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr_chunk_001", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr", "text": "ll PRs**: run full CI (quality gates, tests, security, performance, accessibility).\n   - **Push to `main`, `dev`, `stage`**: run full CI + build images + publish tags (E2E and build jobs enabled).\n   - **Release tags (`vX.Y.Z`)**: publish immutable images, SBOM, and provenance; deploy to staging → manual approval → production.\n   - Protected branches with required checks; linear history via squash merges.\n\n2. **Workflow Structure & Stages**\n\n   The CI pipeline is structured as **multiple parallel and sequential jobs** for efficiency and clarity:\n\n   **Primary Quality Gates** (run on all PRs and pushes, in parallel):\n   - **`quality`** job: lint (`pnpm lint:check`), typecheck (`pnpm typecheck`), unit tests (backend/frontend with coverage), coverage gate (`pnpm test:coverage:gate`), QA baseline validation, i18n check, feature flags check, build (`pnpm build`).\n   - **`database_tests`** job: migration tests and seed tests (separate from unit tests for isolation).", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-018-ci-cd-github-ghcr.md", "category": "technical", "chunk_index": 1, "token_count": 243, "hash_short": "ee15ad5d", "version": 1.0, "title": "ADR-018: CI/CD with GitHub Actions and GHCR", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:44.142059", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr_chunk_002", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr", "text": "rage:gate`), QA baseline validation, i18n check, feature flags check, build (`pnpm build`).\n   - **`database_tests`** job: migration tests and seed tests (separate from unit tests for isolation).\n\n   **Secondary Jobs** (run after quality gates pass, mostly in parallel):\n   - **`openapi_spec`**: Generate and validate OpenAPI schema.\n   - **`integration`**: Integration tests with ephemeral Postgres/Redis via services; migrations/seeds per run.\n   - **`metrics_contract`**: Validate Prometheus metrics exposure.\n   - **`security`**: Dependency audit (`pnpm audit --prod --audit-level=high`), OSV scanner, Snyk scan, TruffleHog secret scanning, static secret scan, Trivy container scan.\n   - **`zap_baseline`**: OWASP ZAP baseline scan (if target URL configured).\n   - **`performance`**: k6 smoke test, performance budget assertion (API p95 < 300ms, LCP < 2.5s, no >10% regression), Lighthouse CI.\n   - **`accessibility`**: Axe accessibility suite for WCAG 2.1 AA compliance.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-018-ci-cd-github-ghcr.md", "category": "technical", "chunk_index": 2, "token_count": 243, "hash_short": "f30fffdd", "version": 1.0, "title": "ADR-018: CI/CD with GitHub Actions and GHCR", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:44.142059", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr_chunk_003", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr", "text": "ance`**: k6 smoke test, performance budget assertion (API p95 < 300ms, LCP < 2.5s, no >10% regression), Lighthouse CI.\n   - **`accessibility`**: Axe accessibility suite for WCAG 2.1 AA compliance.\n   - **`qa_summary`**: Aggregate coverage and performance metrics, generate QA summary.\n\n   **Conditional Jobs** (run only on push to `main`/`stage`):\n   - **`e2e`**: Playwright E2E tests against preview server; artifacts (screenshots, traces) uploaded.\n   - **`build`**: Build multi-arch Docker images (linux/amd64, linux/arm64), generate SBOMs (via Docker buildx), sign images with cosign (keyless OIDC), create GitHub release, upload container artifacts.\n\n   > See `.github/workflows/ci.yml` for the complete job definitions and dependencies.\n\n3. **Artifacts & Supply Chain Security**\n   - **SBOM** generated per image and attached to release.\n   - **Provenance** (SLSA generator for GitHub) publishes attestations.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-018-ci-cd-github-ghcr.md", "category": "technical", "chunk_index": 3, "token_count": 228, "hash_short": "484d7c1a", "version": 1.0, "title": "ADR-018: CI/CD with GitHub Actions and GHCR", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:44.142059", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr_chunk_004", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr", "text": "tions and dependencies.\n\n3. **Artifacts & Supply Chain Security**\n   - **SBOM** generated per image and attached to release.\n   - **Provenance** (SLSA generator for GitHub) publishes attestations.\n   - **Cosign** image signing (keyless via OIDC) and policy verification at deploy time.\n\n4. **Secrets & Cloud Access**\n   - Use **GitHub Environments** and **OIDC federation** for cloud credentials (no long-lived keys).\n   - Secrets are rotated and scoped per environment; runners have minimal permissions.\n\n5. **Caching & Speed**\n   - **pnpm** and **turbo** caches keyed by lockfile + task graph.\n   - **Docker layer cache** enabled with `--cache-from` for repeatable, fast builds.\n   - Matrix jobs for Node versions where helpful (LTS + current) on CI-only lanes.\n\n6. **Testing Data & Ephemeral Infra**\n   - Compose services: Postgres, Redis, MinIO, Mailhog.\n   - DB migrations/seeds executed anew per job; tests clean up state.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-018-ci-cd-github-ghcr.md", "category": "technical", "chunk_index": 4, "token_count": 232, "hash_short": "0a186053", "version": 1.0, "title": "ADR-018: CI/CD with GitHub Actions and GHCR", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:44.142059", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr_chunk_005", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr", "text": "TS + current) on CI-only lanes.\n\n6. **Testing Data & Ephemeral Infra**\n   - Compose services: Postgres, Redis, MinIO, Mailhog.\n   - DB migrations/seeds executed anew per job; tests clean up state.\n   - Artifacts (JUnit, coverage, Playwright traces, k6 results) uploaded for PR review.\n\n7. **Policy Gates & Budgets**\n   - **Fail build** when any gate is breached: lints/warnings, type errors, unit/integration/E2E failures, Lighthouse <90, ZAP High/Critical, perf budgets or **>10% regression**.\n   - Required checks configured in branch protection to enforce gates.\n\n8. **Releases & Rollbacks**\n   - Semantic versioning with conventional commits + changesets.\n   - **Blue/green or canary** supported via environment config; rollback = re-deploy previous tag.\n   - Release notes include OpenAPI artifact links and migration notes.\n\n9. **Observability & Notifications**\n   - Publish test & audit summaries to PR comments.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-018-ci-cd-github-ghcr.md", "category": "technical", "chunk_index": 5, "token_count": 229, "hash_short": "a4a62f6f", "version": 1.0, "title": "ADR-018: CI/CD with GitHub Actions and GHCR", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:44.142059", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr_chunk_006", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr", "text": "rollback = re-deploy previous tag.\n   - Release notes include OpenAPI artifact links and migration notes.\n\n9. **Observability & Notifications**\n   - Publish test & audit summaries to PR comments.\n   - On deployment, post release links, image digests, and SLO snapshot (latency, error rate).\n   - Alerts wired to on-call for failed post-deploy checks.\n\n10. **Compliance & Retention**\n    - Retain logs and artifacts for ≥ 30 days (PR) and ≥ 180 days (release) as per policy.\n    - Access controls applied to environments; audit trail maintained for approvals.\n\n---\n\n## Consequences\n\n**Positive**\n\n- Reproducible, secure pipeline with explicit quality budgets.\n- Faster feedback via caches and matrices; safer releases through canary + manual production gate.\n- Strong supply chain controls (SBOM, provenance, signing).\n\n**Negative / Trade-offs**\n\n- Additional CI minutes for perf/a11y/security gates (intentional).\n- Slight configuration complexity for OIDC and attestations.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-018-ci-cd-github-ghcr.md", "category": "technical", "chunk_index": 6, "token_count": 243, "hash_short": "0878c119", "version": 1.0, "title": "ADR-018: CI/CD with GitHub Actions and GHCR", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:44.142059", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr_chunk_007", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr", "text": "ain controls (SBOM, provenance, signing).\n\n**Negative / Trade-offs**\n\n- Additional CI minutes for perf/a11y/security gates (intentional).\n- Slight configuration complexity for OIDC and attestations.\n\n**Operational**\n\n- Keep lockfiles and base images updated; rotate caches; review budgets quarterly.\n- Record baselines for perf to keep regression signal healthy.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-018-ci-cd-github-ghcr.md", "category": "technical", "chunk_index": 7, "token_count": 90, "hash_short": "5d29c6da", "version": 1.0, "title": "ADR-018: CI/CD with GitHub Actions and GHCR", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:44.142059", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr_chunk_008", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr", "text": "plexity for OIDC and attestations.\n\n**Operational**\n\n- Keep lockfiles and base images updated; rotate caches; review budgets quarterly.\n- Record baselines for perf to keep regression signal healthy.", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-018-ci-cd-github-ghcr.md", "category": "technical", "chunk_index": 8, "token_count": 49, "hash_short": "3ca95d50", "version": 1.0, "title": "ADR-018: CI/CD with GitHub Actions and GHCR", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:44.142059", "tags": ["technical", "md"]}
{"chunk_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr_chunk_009", "doc_id": ".._.._docs_2.Technical_Design_Document_2.f.Architectural_Decision_Documentation_ADR-018-ci-cd-github-ghcr", "text": "---\n\n## Alternatives Considered\n\n| Option                | Description                | Reason Rejected                                                  |\n| --------------------- | -------------------------- | ---------------------------------------------------------------- |\n| Third-party CI        | CircleCI/GitLab            | GitHub-native reduces friction and integrates with GHCR and GHAS |\n| Push-on-merge deploys | Auto prod on `main`        | Violates need for manual approval and staged verifications       |\n| No SBOM/provenance    | Skip supply chain metadata | Fails compliance and traceability goals in PRD/TDD               |\n\n---\n\n## References\n\n- PRD: Engineering standards, performance/security budgets\n- TDD: Build/run/deploy conventions, container strategy\n- QA: CI gates, regression policy, a11y/security/perf tooling\n\n---\n\n## Status Log\n\n| Version | Date       | Change                                                                                 | Author   |\n| ------- | ---------- | -------------------------------------------------------------------------------------- | -------- |\n| v1.0    | 2025-10-14 | Initial ADR for CI/CD on GitHub Actions with GHCR, SBOM, provenance, and quality gates | Reviewer |", "source_file": "../../docs/2.Technical_Design_Document/2.f.Architectural_Decision_Documentation/ADR-018-ci-cd-github-ghcr.md", "category": "technical", "chunk_index": 9, "token_count": 309, "hash_short": "248993db", "version": 1.0, "title": "ADR-018: CI/CD with GitHub Actions and GHCR", "mtime": "2025-11-30T03:53:28.087942", "ingested_at": "2025-11-30T04:00:44.142059", "tags": ["technical", "md"]}
