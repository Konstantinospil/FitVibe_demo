{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_000", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "﻿---\ntitle: \"FitVibe — Testing & Quality Assurance Plan\"\nversion: \"v3.0\"\nstatus: \"Approved (MVP → GA baseline)\"\nreview_cadence: \"Per release and quarterly\"\ndate: \"2025-10-26\"\nlicense: \"MIT\"\n---\n\n# Appendix E — Metrics Contract Checklist\n\n# E.1 Objectives\n\nDefine a **machine-verifiable contract** for app observability so that each build exposes the **required Prometheus metrics** with the correct **names, types, labels, and buckets**. CI must **fail** when the contract is not satisfied.\n\nHard gates:\n\n- HTTP request histogram & counters exposed with standard labels.\n- DB query histogram exposed with mandated buckets.\n- RUM LCP gauge exposed from frontend collector.\n- Scrape endpoints reachable and non-empty.\n- Example series present for smoke routes with non-zero samples.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 0, "token_count": 195, "hash_short": "a17c0067", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_001", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "histogram exposed with mandated buckets.\n- RUM LCP gauge exposed from frontend collector.\n- Scrape endpoints reachable and non-empty.\n- Example series present for smoke routes with non-zero samples.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 1, "token_count": 49, "hash_short": "a0d42ddc", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_002", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "---\n\n# E.2 Required Metrics (names, types, labels)\n\n## E.2.1 HTTP Server\n\n- **Name:** `http_request_duration_seconds` (Histogram)\n  - **Labels (required):** `method`, `route`, `status_code`\n  - **Buckets (mandated):** `0.05, 0.1, 0.2, 0.3, 0.4, 0.6, 0.8, 1, 1.5, 2, 3, 5`\n  - **Objectives:** p50, p95, p99 via `histogram_quantile`\n  - **Cardinality controls:** `route` must use **templated paths** (e.g., `/api/v1/sessions/{id}`)\n\n- **Name:** `http_requests_total` (Counter)\n  - **Labels:** `method`, `route`, `status_code`\n\n- **Name:** `http_request_size_bytes` (Histogram) _optional but recommended_\n  - **Labels:** `method`, `route`\n\n## E.2.2 Database\n\n- **Name:** `db_query_duration_ms` (Histogram)\n  - **Labels (required):** `operation` (e.g., `select|insert|update|delete`), `table`\n  - **Buckets (mandated, in ms):** `5, 10, 25, 50, 100, 200, 400, 600, 1000, 2000`\n  - **Unit note:** Expose in **seconds** if library requires; CI normalizes to ms for thresholds.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 2, "token_count": 242, "hash_short": "c16d44e4", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_003", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "delete`), `table`\n  - **Buckets (mandated, in ms):** `5, 10, 25, 50, 100, 200, 400, 600, 1000, 2000`\n  - **Unit note:** Expose in **seconds** if library requires; CI normalizes to ms for thresholds.\n\n- **Name:** `db_connections` (Gauge)\n  - **Labels:** `state` (e.g., `active|idle`)\n\n## E.2.3 Frontend RUM\n\n- **Name:** `frontend_lcp_ms` (Gauge)\n  - **Labels (required):** `route`, `device` (`mobile|desktop`), `country` (2-letter, optional SLO cut)\n  - **Aggregation requirement:** provide **p75** per route; CI derives from raw samples if exported as summary\n\n- **Name:** `frontend_errors_total` (Counter)\n  - **Labels:** `route`, `type` (`js|xhr|promise|console`)\n\n## E.2.4 Process/Runtime (baseline)\n\n- `process_cpu_seconds_total` (Counter)\n- `process_resident_memory_bytes` (Gauge)\n- `nodejs_eventloop_lag_seconds` or equivalent for runtime\n\n---\n\n# E.3 Exposition Format (Prometheus text)\n\nSample (HTTP):\n\n```\n# HELP http_request_duration_seconds HTTP request latency histogram\n\n# TYPE http_request_duration_seconds histogram\nhttp_request_duration_seconds_bucket{method=\"GET\",route=\"/api/v1/sessions/{id}\",status_code=\"200\",le=\"0.05\"} 12\nhttp_request_duration_seconds_bucket{method=\"GET\",route=\"/api/v1/sessions/{id}\",status_code=\"200\",le=\"0.1\"} 34\n...\nhttp_request_duration_seconds_sum{method=\"GET\",route=\"/api/v1/sessions/{id}\",status_code=\"200\"} 4.21\nhttp_request_duration_seconds_count{method=\"GET\",route=\"/api/v1/sessions/{id}\",status_code=\"200\"} 120\n```\n\nSample (DB):\n\n```", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 3, "token_count": 370, "hash_short": "bf898877", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_004", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "nds_sum{method=\"GET\",route=\"/api/v1/sessions/{id}\",status_code=\"200\"} 4.21\nhttp_request_duration_seconds_count{method=\"GET\",route=\"/api/v1/sessions/{id}\",status_code=\"200\"} 120\n```\n\nSample (DB):\n\n```\n\n\n# TYPE db_query_duration_ms histogram\ndb_query_duration_ms_bucket{operation=\"select\",table=\"sessions\",le=\"50\"} 105\ndb_query_duration_ms_bucket{operation=\"select\",table=\"sessions\",le=\"100\"} 300\ndb_query_duration_ms_sum{operation=\"select\",table=\"sessions\"} 12345\ndb_query_duration_ms_count{operation=\"select\",table=\"sessions\"} 800\n```\n\nSample (RUM):\n\n```\n# TYPE frontend_lcp_ms gauge\nfrontend_lcp_ms{route=\"/dashboard\",device=\"mobile\",country=\"DE\"} 2100\n```\n\n---\n\n# E.4 Scrape Targets & Config\n\nTargets must expose `/metrics` on:\n\n- **API pods:** `fitvibe-api:8080/metrics`\n- **Frontend collector:** `fitvibe-rum:9090/metrics`\n\nPrometheus scrape job example:\n\n```yaml\nscrape_configs:\n  - job_name: fitvibe-api\n    kubernetes_sd_configs: [{ {} }]\n    relabel_configs:\n      - source_labels: [__meta_kubernetes_pod_label_app]\n        regex: fitvibe-api\n        action: keep\n    metrics_path: /metrics\n    scheme: http\n    scrape_interval: 15s\n  - job_name: fitvibe-rum\n    kubernetes_sd_configs: [{ {} }]\n    relabel_configs:\n      - source_labels: [__meta_kubernetes_pod_label_app]\n        regex: fitvibe-rum\n        action: keep\n    metrics_path: /metrics\n    scrape_interval: 30s\n```\n\n---", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 4, "token_count": 347, "hash_short": "7b8b9e9f", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_005", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "gs: [{ {} }]\n    relabel_configs:\n      - source_labels: [__meta_kubernetes_pod_label_app]\n        regex: fitvibe-rum\n        action: keep\n    metrics_path: /metrics\n    scrape_interval: 30s\n```\n\n---\n\n\n# E.5 CI Verification (Contract Tests)\n\n**Step 1 — Reachability & non-empty:**\n\n```bash\ncurl -fsS $API_METRICS | head -n 5\ncurl -fsS $RUM_METRICS | head -n 5\n```\n\n**Step 2 — Name/type/label checks (Node):**\n\n```js\nimport fs from 'node:fs';\nimport {{ parseTextFormat }} from 'prom-text-parser';\nconst api = parseTextFormat(fs.readFileSync('api.metrics','utf8'));\n\nfunction assertMetric(name, type){{\n  const m = api.find(x => x.name===name);\n  if(!m || m.type!==type) throw new Error(`Missing or wrong type: ${{name}}`);\n  return m;\n}}\nconst http = assertMetric('http_request_duration_seconds','histogram');\n['method','route','status_code'].forEach(l=>{{\n  if(!http.series.some(s=>Object.keys(s.labels).includes(l))) throw new Error(`Missing label ${{l}}`);\n}});\n```\n\n**Step 3 — Bucket policy checks:**\n\n```js\nconst requiredBuckets = [0.05, 0.1, 0.2, 0.3, 0.4, 0.6, 0.8, 1, 1.5, 2, 3, 5].map(String);\nconst getBuckets = (m) =>\n  [...new Set(m.series.filter((s) => \"le\" in s.labels).map((s) => s.labels.le))].sort(\n    (a, b) => parseFloat(a) - parseFloat(b),\n  );\nconst buckets = getBuckets(http);\nif (JSON.stringify(buckets) !== JSON.stringify(requiredBuckets))\n  throw new Error(\"HTTP buckets mismatch\");\n```\n\n**Step 4 — Example series present (smoke routes):**\n\n```js\nconst hasRoute200 = http.series.some(\n  (s) => s.labels.route === \"/api/v1/sessions/{id}\" && s.labels.status_code === \"200\",\n);\nif (!hasRoute200) throw new Error(\"No 200 /sessions series found\");\n```\n\n**Step 5 — RUM presence & sample sanity:**\n\n```js\nconst rum = parseTextFormat(fs.readFileSync(\"rum.metrics\", \"utf8\")).find(\n  (x) => x.name === \"frontend_lcp_ms\",\n);\nif (!rum) throw new Error(\"Missing frontend_lcp_ms\");\nconst ok = rum.series.some((s) => s.labels.route === \"/dashboard\" && Number(s.value) > 0);\nif (!ok) throw new Error(\"No positive LCP sample\");\n```\n\n**Exit non‑zero on any failure** to block the pipeline", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 5, "token_count": 523, "hash_short": "23d0ba0d", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_006", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "nst ok = rum.series.some((s) => s.labels.route === \"/dashboard\" && Number(s.value) > 0);\nif (!ok) throw new Error(\"No positive LCP sample\");\n```\n\n**Exit non‑zero on any failure** to block the pipeline.\n\n---\n\n# E.6 PromQL Checks (used in CI and dashboards)\n\n- **HTTP p95 (per route):**\n  ```promql\n  histogram_quantile(0.95, sum by (le, route) (rate(http_request_duration_seconds_bucket[5m])))\n  ```\n- **DB p95 (by table):**\n  ```promql\n  histogram_quantile(0.95, sum by (le, table) (rate(db_query_duration_ms_bucket[5m])))\n  ```\n- **RUM LCP p75 (per route, device):**\n  ```promql\n  quantile_over_time(0.75, frontend_lcp_ms{{route=\"/dashboard\",device=\"mobile\"}}[1h])\n  ```\n\n**Budgets (gates):**\n\n- API p95 per group (auth ≤200ms, CRUD ≤300ms, feed ≤400ms, analytics ≤600ms).\n- RUM LCP p75 < 2500ms for tracked routes on mobile.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 6, "token_count": 206, "hash_short": "5d04ada3", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_007", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "e=\"/dashboard\",device=\"mobile\"}}[1h])\n  ```\n\n**Budgets (gates):**\n\n- API p95 per group (auth ≤200ms, CRUD ≤300ms, feed ≤400ms, analytics ≤600ms).\n- RUM LCP p75 < 2500ms for tracked routes on mobile.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 7, "token_count": 49, "hash_short": "cbb6c439", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_008", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "---\n\n# E.7 Alerting Rules (SLO & Budget)\n\n```yaml\ngroups:\n  - name: fitvibe-slo\n    rules:\n      - alert: APIP95LatencyHigh\n        expr: histogram_quantile(0.95, sum by (le) (rate(http_request_duration_seconds_bucket{{route=~\"/api/v1/(auth|crud|feed|analytics).*\"}}[5m]))) > 0.6\n        for: 15m\n        labels: { { severity: warning } }\n        annotations:\n          summary: \"API p95 above budget\"\n      - alert: DBQuerySlow\n        expr: histogram_quantile(0.95, sum by (le, table) (rate(db_query_duration_ms_bucket[5m]))) > 600\n        for: 15m\n        labels: { { severity: warning } }\n      - alert: RUM_LCP_Degradation\n        expr: quantile_over_time(0.75, frontend_lcp_ms[30m]) > 2500\n        for: 30m\n        labels: { { severity: warning } }\n```\n\n---\n\n# E.8 Evidence & Artifacts (per pipeline)\n\n- `reports/metrics/api.metrics` & `reports/metrics/rum.metrics` (raw scrape)\n- `reports/metrics/contract.json` (pass/fail log with reasons)\n- Dashboard snapshot PNG/JSON (optional)\n- CI summary with PromQL checks and thresholds\n\n---", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 8, "token_count": 260, "hash_short": "4cd79f6e", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_009", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "`reports/metrics/rum.metrics` (raw scrape)\n- `reports/metrics/contract.json` (pass/fail log with reasons)\n- Dashboard snapshot PNG/JSON (optional)\n- CI summary with PromQL checks and thresholds\n\n---\n\n\n# E.9 Versioning & Change Control\n\n- Any change to metric **names, labels, or buckets** requires:\n  1. Update of this appendix and a minor version bump.\n  2. CI contract test update in the same PR.\n  3. Dashboard & alert rule revision if matching.\n\n- Deprecations: keep legacy metric exported for **one minor** with `deprecated=\"true\"` label.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 9, "token_count": 135, "hash_short": "b7d202ce", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_010", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "on bump.\n  2. CI contract test update in the same PR.\n  3. Dashboard & alert rule revision if matching.\n\n- Deprecations: keep legacy metric exported for **one minor** with `deprecated=\"true\"` label.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 10, "token_count": 49, "hash_short": "014f94b9", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_011", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "---\n\n# E.10 Checklist (Quick)\n\n- [ ] `/metrics` reachable (API & RUM)\n- [ ] `http_request_duration_seconds` histogram present with **required labels** and **mandated buckets**\n- [ ] `http_requests_total` present\n- [ ] `db_query_duration_ms` histogram present with **required labels** and **mandated buckets**\n- [ ] `frontend_lcp_ms` present with **route** & **device** labels; samples > 0\n- [ ] Example series for smoke routes (200s) present\n- [ ] Contract tests passed (CI failed otherwise)\n- [ ] Alert rules loaded without errors\n\n---\n\n# E.11 Extended Observability Contract\n\n## E.11.1 Distributed Tracing\n\n### Required Trace Propagation\n\n**Trace ID must propagate:** HTTP → API Handler → DB Query → Queue Job\n\n**Validation (CI):**\n\n```ts\n// tests/observability/trace-propagation.test.ts\nimport { trace } from \"@opentelemetry/api\";\n\ntest(\"Trace ID propagates to DB spans\", async () => {\n  const tracer = trace.getTracer(\"test\");\n\n  await tracer.startActiveSpan(\"test-request\", async (span) => {\n    const traceId = span.spanContext().traceId;\n\n    // Make API request\n    const res = await fetch(\"/api/v1/sessions\", {\n      headers: { traceparent: `00-${traceId}-...` },\n    });\n\n    // Verify DB span has same trace ID\n    const spans = await getExportedSpans();\n    const dbSpan = spans.find((s) => s.name === \"db.query\");\n\n    expect(dbSpan.traceId).toBe(traceId);\n    span.end();\n  });\n});\n```", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 11, "token_count": 349, "hash_short": "dd07d003", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_012", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "pan has same trace ID\n    const spans = await getExportedSpans();\n    const dbSpan = spans.find((s) => s.name === \"db.query\");\n\n    expect(dbSpan.traceId).toBe(traceId);\n    span.end();\n  });\n});\n```\n\n\n### Sampling Configuration\n\n**Policy:** 10% sampling rate in production\n\n**Validation:**\n\n```ts\ntest(\"Sampling rate is 10%\", () => {\n  const config = require(\"../../../apps/backend/src/tracing/config\");\n  expect(config.samplingRate).toBe(0.1);\n});\n```\n\n### Span Attributes (Required Fields)\n\n**HTTP spans:**\n\n- `http.method`, `http.route`, `http.status_code`, `http.user_agent`\n\n**DB spans:**\n\n- `db.statement` (parameterized, no PII), `db.operation`, `db.name`\n\n**Error spans:**\n\n- `error.type`, `error.message`, `error.stack` (sanitized)\n\n**Contract test:**\n\n```ts\ntest(\"API spans include required attributes\", async () => {\n  await fetch(\"/api/v1/users/me\");\n  const spans = await getExportedSpans();\n  const apiSpan = spans.find((s) => s.name === \"GET /api/v1/users/me\");\n\n  expect(apiSpan.attributes).toMatchObject({\n    \"http.method\": \"GET\",\n    \"http.route\": \"/api/v1/users/me\",\n    \"http.status_code\": 200,\n  });\n});\n```", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 12, "token_count": 282, "hash_short": "1ddb7872", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_013", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "ind((s) => s.name === \"GET /api/v1/users/me\");\n\n  expect(apiSpan.attributes).toMatchObject({\n    \"http.method\": \"GET\",\n    \"http.route\": \"/api/v1/users/me\",\n    \"http.status_code\": 200,\n  });\n});\n```\n\n\n## E.11.2 Structured Logging\n\n### Log Schema (JSON)\n\n**Required fields:**\n\n```json\n{\n  \"level\": \"info|warn|error\",\n  \"timestamp\": \"2025-10-26T10:00:00.000Z\",\n  \"message\": \"User logged in\",\n  \"trace_id\": \"abc123...\",\n  \"user_id\": \"uuid-...\", // Optional, only if authenticated\n  \"context\": {\n    // Freeform, but no PII\n    \"route\": \"/api/v1/auth/login\",\n    \"duration_ms\": 145\n  }\n}\n```\n\n### PII Guard (CI)\n\n**Automated scan for PII patterns in logs:**\n\n```js\n// tests/observability/log-pii-scan.test.ts\nimport { spawn } from \"child_process\";\n\ntest(\"Logs contain no PII\", async () => {\n  // Run app with log output to file\n  const app = spawn(\"node\", [\"dist/main.js\"], {\n    env: { LOG_LEVEL: \"debug\", LOG_FILE: \"reports/app.log\" },\n  });\n\n  // Trigger test requests\n  await fetch(\"/api/v1/users/me\");\n  app.kill();\n\n  // Scan logs for PII patterns\n  const logs = fs.readFileSync(\"reports/app.log\", \"utf8\");\n  const emailPattern = /\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b/g;\n  const phonePattern = /\\b\\d{3}[-.]?\\d{3}[-.]?\\d{4}\\b/g;\n\n  expect(logs).not.toMatch(emailPattern);\n  expect(logs).not.toMatch(phonePattern);\n});\n```", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 13, "token_count": 334, "hash_short": "2261d57d", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_014", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b/g;\n  const phonePattern = /\\b\\d{3}[-.]?\\d{3}[-.]?\\d{4}\\b/g;\n\n  expect(logs).not.toMatch(emailPattern);\n  expect(logs).not.toMatch(phonePattern);\n});\n```\n\n\n### Log Contract Test\n\n```ts\ntest(\"All logs are valid JSON with required fields\", () => {\n  const logs = fs\n    .readFileSync(\"reports/app.log\", \"utf8\")\n    .split(\"\\n\")\n    .filter(Boolean)\n    .map(JSON.parse);\n\n  for (const log of logs) {\n    expect(log).toHaveProperty(\"level\");\n    expect(log).toHaveProperty(\"timestamp\");\n    expect(log).toHaveProperty(\"message\");\n    expect([\"info\", \"warn\", \"error\", \"debug\"]).toContain(log.level);\n  }\n});\n```\n\n## E.11.3 Alert Rule Validation\n\n### Syntax Check (CI)\n\n**Tool:** `promtool` (Prometheus command-line tool)\n\n```yaml\n# .github/workflows/ci.yml (in observability job)\n- name: Validate Prometheus alert rules\n  run: |\n    curl -LO https://github.com/prometheus/prometheus/releases/download/v2.45.0/prometheus-2.45.0.linux-amd64.tar.gz\n    tar xvfz prometheus-*.tar.gz\n    ./prometheus-*/promtool check rules monitoring/alerts/*.yml\n```", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 14, "token_count": 272, "hash_short": "7633fd8c", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_015", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "://github.com/prometheus/prometheus/releases/download/v2.45.0/prometheus-2.45.0.linux-amd64.tar.gz\n    tar xvfz prometheus-*.tar.gz\n    ./prometheus-*/promtool check rules monitoring/alerts/*.yml\n```\n\n\n# Appendix F — DR Drill Runbook (extract)\n\n# F.1 Objectives & Success Criteria\n\n**Purpose.** Validate that FitVibe can recover from a catastrophic failure **within policy**, and that privacy obligations (**erasure-replay**) are satisfied for data subject deletions since the backup snapshot.\n\n**Success criteria (hard gates):**\n\n- **RPO ≤ 24h** — data currency of restored environment relative to drill start.\n- **RTO ≤ 4h** — time from _drill kickoff_ to **healthy app** in staging-DR.\n- **Delete propagation ≤ 14 days** — all records present in `erasure_ledger` since the backup timestamp are **absent** after replay.\n- Evidence bundle is complete, signed by required approvers, and archived.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 15, "token_count": 224, "hash_short": "1b2a332f", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_016", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "e propagation ≤ 14 days** — all records present in `erasure_ledger` since the backup timestamp are **absent** after replay.\n- Evidence bundle is complete, signed by required approvers, and archived.\n\n---\n\n# F.2 RACI & Participants\n\n| Activity             | DevOps | DBA | Privacy Officer | QA Lead | Security | Product Owner |\n| -------------------- | ------ | --- | --------------- | ------- | -------- | ------------- |\n| Plan & kickoff       | R      | C   | C               | C       | I        | I             |\n| Select backups       | R      | A   | I               | I       | I        | I             |\n| Restore DB & storage | A      | R   | I               | I       | I        | I             |\n| App/bootstrap config | R      | C   | I               | I       | I        | I             |\n| Health checks        | R      | C   | I               | A       | I        | I             |\n| Erasure-replay       | C      | R   | A               | C       | I        | I             |\n| Evidence bundle      | R      | C   | A               | A       | I        | I             |\n| Sign-off             | A      | C   | A               | A       | I        | A             |\n\n**R = Responsible, A = Accountable, C = Consulted, I = Informed**\n\n---", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 16, "token_count": 313, "hash_short": "d014ab6f", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_017", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "| I        | I             |\n| Sign-off             | A      | C   | A               | A       | I        | A             |\n\n**R = Responsible, A = Accountable, C = Consulted, I = Informed**\n\n---\n\n\n# F.3 Preconditions & Controls\n\n- Staging-DR environment exists (isolated VPC/namespace) with:\n  - Sufficient compute/storage quotas\n  - Access to secrets via **Vault**/**KMS**\n  - **Read-only** production access disabled (except for fetching backups)\n- **Backups** available:\n  - **Database**: nightly logical dumps + weekly physical snapshots\n  - **Object storage**: versioned buckets with lifecycle policy\n  - **Configs**: encrypted snapshots (in Git and secure secrets store)\n- **Erasure ledger** (`compliance.erasure_ledger`) captures deletions with `{subject_id, domain, deleted_at, scope}`\n- Tooling installed: `psql`, `pg_restore`, `aws` (or cloud-cli), `jq`, `sha256sum`, `k6` (optional smoke), `kubectl`/`helm`\n- Time sync: use UTC for all timestamps\n\n---\n\n# F.4 Data Classification & Anonymization Policy\n\n- **No production PII** is copied into developer-accessible namespaces", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 17, "token_count": 271, "hash_short": "6e794acc", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_018", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "optional smoke), `kubectl`/`helm`\n- Time sync: use UTC for all timestamps\n\n---\n\n# F.4 Data Classification & Anonymization Policy\n\n- **No production PII** is copied into developer-accessible namespaces.\n- Restored staging-DR uses **synthetic** users for health checks.\n- If prod-like payloads are needed for perf smoke, apply **anonymization transforms** (hash emails, null phone, mask names).\n- Access to staging-DR is scoped to drill participants; audit logs enabled.\n\n---\n\n# F.5 Backup Selection\n\n1. List latest successful DB backups:\n   ```bash\n   aws s3 ls s3://fitvibe-backups/db/ --recursive | tail -n 20\n   ```\n2. Choose the most recent backup **≤24h** old relative to kickoff.\n3. Record: `BACKUP_DB_URI`, backup `created_at`, size, checksum.\n4. Select corresponding **object storage** snapshot prefix (same date).\n\n---\n\n# F.6 Drill Timeline & Measurements\n\n- **t0 (Kickoff UTC):** announce start in #ops-dr channel.\n- **t1 (Restore start):** when DB restore begins.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 18, "token_count": 243, "hash_short": "50bf5ec3", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_019", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "**object storage** snapshot prefix (same date).\n\n---\n\n# F.6 Drill Timeline & Measurements\n\n- **t0 (Kickoff UTC):** announce start in #ops-dr channel.\n- **t1 (Restore start):** when DB restore begins.\n- **t2 (Restore end):** DB ready for read/write tests.\n- **t3 (App healthy):** all health checks/smokes pass in staging-DR.\n- **RTO = t3 - t0**, **RPO = now - backup.created_at**.\n\nCapture timestamps with a shared script (see F.14).\n\n---\n\n# F.7 Environment Provisioning (Staging-DR)\n\n```bash\nkubectl create ns staging-dr || true\nhelm upgrade --install fitvibe-dr charts/fitvibe   --namespace staging-dr   -f charts/values-dr.yaml   --set image.tag=DR-SNAPSHOT   --set env=staging-dr\n```\n\n- Inject app secrets via Vault/KMS references (no plain-text secrets).\n- Disable **external analytics** and notification webhooks.\n\n---\n\n# F.8 Database Restore Procedure\n\n> Assumes **PostgreSQL** with logical dump (`.dump` or `.sql`).\n\n1. **Provision fresh DB** (managed PG or container).\n2.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 19, "token_count": 244, "hash_short": "c723d0f7", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_020", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "analytics** and notification webhooks.\n\n---\n\n# F.8 Database Restore Procedure\n\n> Assumes **PostgreSQL** with logical dump (`.dump` or `.sql`).\n\n1. **Provision fresh DB** (managed PG or container).\n2. **Restore:**\n   ```bash\n   export PGPASSWORD=$PG_RESTORE_PASSWORD\n   time pg_restore --no-owner --no-acl      --dbname=$PGDATABASE --host=$PGHOST --username=$PGUSER      /backups/fitvibe-YYYYMMDD.dump\n   ```\n3. **Schema guard:** verify required migrations applied:\n   ```bash\n   psql \"$PGURL\" -c \"select version from schema_version order by applied_at desc limit 1;\"\n   ```\n4.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 20, "token_count": 144, "hash_short": "7704b459", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_021", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "s/fitvibe-YYYYMMDD.dump\n   ```\n3. **Schema guard:** verify required migrations applied:\n   ```bash\n   psql \"$PGURL\" -c \"select version from schema_version order by applied_at desc limit 1;\"\n   ```\n4. **Integrity checks:**\n   - Row counts for critical tables vs manifest\n   - Index presence (GIN on `exercises.tags`, composite indexes on `sessions`)\n   ```bash\n   psql \"$PGURL\" -f tests/db/contracts/assert_indexes.sql\n   ```\n\n---\n\n# F.9 Object Storage Restore\n\nRestore versioned assets (avatars/exports) to **dr-bucket** with a readonly policy:\n\n```bash\naws s3 sync s3://fitvibe-objects/ s3://fitvibe-objects-dr/   --delete --exact-timestamps --storage-class STANDARD-IA\n```\n\n- Disable any public ACLs.\n- Validate count & checksums against manifest.\n\n---\n\n# F.10 Application Bootstrap & Health Checks\n\n1.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 21, "token_count": 201, "hash_short": "848f2c15", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_022", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "cts-dr/   --delete --exact-timestamps --storage-class STANDARD-IA\n```\n\n- Disable any public ACLs.\n- Validate count & checksums against manifest.\n\n---\n\n# F.10 Application Bootstrap & Health Checks\n\n1. Apply config map and secret refs; roll deployment:\n   ```bash\n   kubectl rollout restart deploy -n staging-dr fitvibe-web fitvibe-api\n   kubectl -n staging-dr wait deploy/fitvibe-api --for=condition=Available=True --timeout=600s\n   ```\n2. **Smoke tests**:\n   - `/healthz` → `200`\n   - Register→Verify (fake mailer)→Login→Plan→Complete→Dashboard (Playwright/k6 smoke)\n3. **Security headers** present (HSTS, CSP, cookies).\n\n---\n\n# F.11 Erasure-Replay Procedure (GDPR Delete Propagation)\n\n**Goal:** ensure subjects deleted **after** the backup time are also **deleted** in staging-DR.\n\n1. **Identify window:** `backup_ts = backup.created_at`.\n2.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 22, "token_count": 210, "hash_short": "95638975", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_023", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "eplay Procedure (GDPR Delete Propagation)\n\n**Goal:** ensure subjects deleted **after** the backup time are also **deleted** in staging-DR.\n\n1. **Identify window:** `backup_ts = backup.created_at`.\n2. **Fetch ledger slice:**\n   ```sql\n   select subject_id, domain, deleted_at\n   from compliance.erasure_ledger\n   where deleted_at >= :backup_ts\n   order by deleted_at asc;\n   ```\n3. **Replay deletions (pseudo-SQL):**\n\n   ```sql\n   -- Example for sessions\n   delete from sessions where user_id in (:subjects);\n   delete from session_exercises where session_id not in (select id from sessions);\n   -- Example for profiles\n   update users set deleted_at = now(), email = null, alias = concat('deleted_', id)\n   where id in (:subjects);\n   ```\n\n   - For object storage, remove PII-related keys:\n     ```bash\n     aws s3 rm s3://fitvibe-objects-dr/ --recursive --exclude \"*\" --include \"users/*/{subjects}/*\"\n     ```\n\n4.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 23, "token_count": 228, "hash_short": "9a2d7856", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_024", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "in (:subjects);\n   ```\n\n   - For object storage, remove PII-related keys:\n     ```bash\n     aws s3 rm s3://fitvibe-objects-dr/ --recursive --exclude \"*\" --include \"users/*/{subjects}/*\"\n     ```\n\n4. **Verify absence:** for each subject in the ledger slice:\n   - No rows in `users` except anonymized stub.\n   - No PII-bearing records in domain tables.\n   - No assets under the user prefix in object storage.\n5. **Record totals:** `N_subjects`, tables touched, objects removed.\n\n**Gate:** all subjects in ledger slice absent/anonymized → **Pass**.\n\n---\n\n# F.12 Consistency, Compliance & Observability Checks\n\n- **Referential integrity:** no orphans (`session_exercises` → `sessions`).\n- **Metrics contract** exposed at `/metrics` (HTTP/DB histograms).\n- **Audit trails:** operations logged; admin actions attributed.\n- **A11y/Perf quick checks** (optional): Lighthouse budget sanity.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 24, "token_count": 220, "hash_short": "78160cd6", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_025", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "- **Metrics contract** exposed at `/metrics` (HTTP/DB histograms).\n- **Audit trails:** operations logged; admin actions attributed.\n- **A11y/Perf quick checks** (optional): Lighthouse budget sanity.\n\n---\n\n# F.13 Acceptance & Sign‑Off\n\n- **RTO (≤4h):** measured t3−t0 → Pass/Fail\n- **RPO (≤24h):** now−backup.created_at → Pass/Fail\n- **Erasure-propagation (≤14d):** verified with query suite → Pass/Fail\n- **Security headers present:** Pass/Fail\n\n**Approvals required:** DevOps, Privacy Officer, QA Lead, Product Owner.", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 25, "token_count": 129, "hash_short": "20118381", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_026", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "Pass/Fail\n- **Erasure-propagation (≤14d):** verified with query suite → Pass/Fail\n- **Security headers present:** Pass/Fail\n\n**Approvals required:** DevOps, Privacy Officer, QA Lead, Product Owner.\n\n---\n\n# F.14 Evidence Bundle Manifest (what to archive)\n\n```\n/reports/dr/YYYY-MM-DD/\n├─ 00_metadata.json                 # backup URIs, checksums, env, team\n├─ 01_timeline.json                 # t0..t3 UTC timestamps, RTO/RPO\n├─ 02_db_restore.log                # pg_restore transcript\n├─ 03_db_contracts.html             # index/FK/schema checks\n├─ 04_object_storage_sync.log\n├─ 05_health_checks.json            # healthz, smoke results\n├─ 06_security_headers.html         # ZAP/headers snapshot\n├─ 07_erasure_ledger_slice.csv\n├─ 08_erasure_replay.sql            # exact statements executed\n├─ 09_erasure_verification.csv      # counts per subject/table\n├─ 10_summary.md                    # result, issues, follow-ups\n└─ signatures/\n   ├─ privacy_officer.sig\n   ├─ qa_lead.sig\n   └─ devops_lead.sig\n```\n\nArchive in WORM location with 1-year retention", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 26, "token_count": 262, "hash_short": "e37e0ef7", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_027", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "le\n├─ 10_summary.md                    # result, issues, follow-ups\n└─ signatures/\n   ├─ privacy_officer.sig\n   ├─ qa_lead.sig\n   └─ devops_lead.sig\n```\n\nArchive in WORM location with 1-year retention.\n\n---\n\n# F.15 Automation Scripts (snippets)\n\n**Timeline capture:**\n\n```bash\njq -n --arg t0 \"$(date -u +%FT%TZ)\" '{{\"t0\":$t0}}' > /reports/dr/01_timeline.json\n# ... add t1..t3 afterward using jq --slurpfile\n```\n\n**RPO/RTO calc (Node):**\n\n```js\nconst meta = require(\"./00_metadata.json\");\nconst tl = require(\"./01_timeline.json\");\nconst rpoHours = (Date.parse(tl.t0) - Date.parse(meta.backup_created_at)) / 36e5;\nconst rtoHours = (Date.parse(tl.t3) - Date.parse(tl.t0)) / 36e5;\nconsole.log({ rpoHours, rtoHours });\nprocess.exit(rpoHours <= 24 && rtoHours <= 4 ?", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 27, "token_count": 190, "hash_short": "03c7777c", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_028", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": ".t0) - Date.parse(meta.backup_created_at)) / 36e5;\nconst rtoHours = (Date.parse(tl.t3) - Date.parse(tl.t0)) / 36e5;\nconsole.log({ rpoHours, rtoHours });\nprocess.exit(rpoHours <= 24 && rtoHours <= 4 ? 0 : 1);\n```\n\n**Erasure verification (SQL skeleton):**\n\n```sql\n-- confirm no PII for subjects\nselect subject_id, count(*) as remaining\nfrom (\n  select user_id as subject_id from sessions where user_id in (:subjects)\n  union all\n  select id as subject_id from users where id in (:subjects) and email is not null\n) q\ngroup by subject_id;\n```\n\n---\n\n# F.16 Rollback & Lessons Learned\n\n- If any gate fails, keep staging-DR up for analysis; file issues with **labels:** `dr-failure`, `rto-breach`, `rpo-breach`, `erasure-gap`.\n- Run a targeted **re-drill** within 10 business days after remediation.\n- Add missing automation to CI (e.g., daily ledger delta check, restore smoke).", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 28, "token_count": 218, "hash_short": "d3f80fd0", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_029", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "`, `rto-breach`, `rpo-breach`, `erasure-gap`.\n- Run a targeted **re-drill** within 10 business days after remediation.\n- Add missing automation to CI (e.g., daily ledger delta check, restore smoke).\n\n---\n\n# F.17 Risks & Mitigations (DR-specific)\n\n| Risk               | Likelihood | Impact | Mitigation                                     |\n| ------------------ | ---------- | ------ | ---------------------------------------------- |\n| Backup corrupted   | Low        | High   | Checksums + restore test of last N backups     |\n| Ledger gaps        | Low        | High   | Transactional writes; alert on failed writes   |\n| Secret mismatch    | Medium     | Medium | Vault version pinning; preflight secret diff   |\n| Index drift        | Medium     | Medium | DB contract tests in CI; assert post-restore   |\n| Object restore lag | Medium     | Low    | Parallel sync; manifest; checksum verification |\n| Human error        | Medium     | Medium | Pair ops; runbook checklists; dry-runs         |\n\n---", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 29, "token_count": 250, "hash_short": "20d769cf", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
{"chunk_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF_chunk_030", "doc_id": ".._.._docs_4.Testing_and_Quality_Assurance_Plan_4d.Testing_and_Quality_Assurance_Plan_ApEF", "text": "re   |\n| Object restore lag | Medium     | Low    | Parallel sync; manifest; checksum verification |\n| Human error        | Medium     | Medium | Pair ops; runbook checklists; dry-runs         |\n\n---\n\n\n# F.18 Checklists (Quick)\n\n**Kickoff**\n\n- [ ] t0 recorded\n- [ ] Backup ≤24h chosen; checksum verified\n- [ ] Scope & roles confirmed\n\n**Restore**\n\n- [ ] DB restored; schema/migrations verified\n- [ ] Objects restored; counts & checksums match\n\n**Health**\n\n- [ ] App healthy in staging-DR (t3 recorded)\n- [ ] Headers/CSP verified\n\n**Erasure**\n\n- [ ] Ledger slice exported\n- [ ] Replay executed\n- [ ] Verification shows 0 PII remnants\n\n**Wrap-up**\n\n- [ ] Evidence bundle archived\n- [ ] Signatures collected\n- [ ] Postmortem scheduled\n\n---", "source_file": "../../docs/4.Testing_and_Quality_Assurance_Plan/4d.Testing_and_Quality_Assurance_Plan_ApEF.md", "category": "testing", "chunk_index": 30, "token_count": 184, "hash_short": "567ea5b7", "version": 1.0, "title": "Appendix E — Metrics Contract Checklist", "mtime": "2025-10-28T11:51:38.381181", "ingested_at": "2025-11-30T04:00:43.813585", "tags": ["testing", "md"]}
