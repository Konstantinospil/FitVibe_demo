# Architecture Decision Record (ADR) Index

**Sources of truth:** PRD, TDD, and QA plan.  
Legend â€” Status: âœ… Accepted Â· ğŸ“ Proposed Â· â³ Deferred Â· âœ–ï¸ Superseded

---

## ADR Catalog

| ID      | Title                                                                                    | Status      | Summary                                                                                                                                              | Decision Date | Links                                                         |
| ------- | ---------------------------------------------------------------------------------------- | ----------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- | ------------------------------------------------------------- |
| ADR-001 | API Versioning Policy (v1 additive; v2 for breaking changes)                             | ğŸ“ Proposed | `/api/v1` is stable; additive fields only; deprecations use `Deprecation/Sunset` headers; breaking changes land in `/api/v2` with 2-release overlap. | 2025-10-13    | TDD Â§7.1.4, Â§7.1.1                                            |
| ADR-002 | Auth Tokens & Rotation Strategy                                                          | ğŸ“ Proposed | RS256 JWT with 15m access, 14d refresh; refresh rotation + reuse detection; JWKS-based key rotation.                                                 | 2025-10-13    | TDD Â§5.1.1, Â§12.4                                             |
| ADR-003 | Data Retention & GDPR Backup Purge Window                                                | ğŸ“ Proposed | Classification table; DSR delete hard-deletes private content and purges backups â‰¤14 days; audit trail.                                              | 2025-10-13    | TDD Â§6.6, Â§12.6                                               |
| ADR-004 | Media Upload Safety & AV Scanning                                                        | ğŸ“ Proposed | AV scan before persistence; allow-list MIME; EXIF strip; quarantine on suspect/malware; alerting.                                                    | 2025-10-13    | TDD Â§5.1.6, Â§12.10                                            |
| ADR-005 | Partitioning Strategy for `sessions` (monthly)                                           | ğŸ“ Proposed | Range partition on `planned_at` with default partition; rotate & archive after 24 months.                                                            | 2025-10-13    | TDD Â§6.4, Â§12.9                                               |
| ADR-006 | Observability Cardinality Policy                                                         | ğŸ“ Proposed | Route templates in labels, bounded label sets, no PII; alerts on series count growth.                                                                | 2025-10-13    | TDD Â§5.4                                                      |
| ADR-007 | Idempotency Policy for Writes                                                            | ğŸ“ Proposed | `Idempotency-Key` header; 24h storage; 409 on payload mismatch; deterministic replay.                                                                | 2025-10-13    | TDD Â§5.7, Â§7.14                                               |
| ADR-008 | Materialized Views for Analytics                                                         | ğŸ“ Proposed | Use matviews for `session_summary`, `weekly_aggregates`; incremental refresh on writes + scheduled.                                                  | 2025-10-13    | TDD Â§4.5, Â§6.3                                                |
| ADR-009 | Global Exercise Library Ownership Model                                                  | ğŸ“ Proposed | Admin-owned global records (`owner_id = NULL`); user-owned duplicates allowed via normalized uniqueness.                                             | 2025-10-13    | TDD Â§4.3, Â§6.2.6                                              |
| ADR-010 | Public/Link/Private Visibility Model                                                     | ğŸ“ Proposed | Resource visibility enum with default **private**; link tokens revocable; public feed feature-flagged.                                               | 2025-10-13    | TDD Â§4.7, Â§7.8                                                |
| ADR-011 | Internationalization â€“ Hybrid Model with MVP Static-Only Rollout                         | âœ… Accepted | Static UI catalogs (EN/DE) for MVP; feature-flagged AI translation for UGC with caching, PII redaction, and DSR purge.                               | 2025-10-14    | [ADR-011](./ADR-011-internationalization-hybrid-approach.md)  |
| ADR-012 | Monorepo Structure, Tooling, and Governance                                              | âœ… Accepted | pnpm workspaces + optional Turbo; Dockerized CI; governance via CODEOWNERS, changesets, and feature flags.                                           | 2025-10-14    | [ADR-012](./ADR-012-monorepo-structure.md)                    |
| ADR-013 | Modular Backend Architecture (Router â†’ Service â†’ Repository)                             | âœ… Accepted | Three-layer modules (router/service/repo); strict authz, audit, caching seams; Knex migrations.                                                      | 2025-10-14    | [ADR-013](./ADR-013-modular-backend-architecture.md)          |
| ADR-014 | Technology Stack & Runtime Standards                                                     | âœ… Accepted | Node/Express, React/Vite, Postgres + Knex, object storage for media, strong headers/CSRF/RBAC; OpenAPI in CI.                                        | 2025-10-14    | [ADR-014](./ADR-014-technology-stack.md)                      |
| ADR-015 | API Design & Internationalization (Hybrid) â€“ MVP Static, UGC Translation Feature-Flagged | âœ… Accepted | REST/JSON `/v1`, RFC7807 errors, idempotency, cursor pagination; i18n hybrid at API with feature flag.                                               | 2025-10-14    | [ADR-015](./ADR-015-api-design-and-i18n-hybrid.md)            |
| ADR-016 | Security Middleware & Audit Logging                                                      | âœ… Accepted | CSP/HSTS/Referrer/Permissions, CSRF, RBAC; PII-free audit logs with correlation IDs and tamper-evidence.                                             | 2025-10-14    | [ADR-016](./ADR-016-audit-logging-and-security-middleware.md) |
| ADR-017 | Avatar Handling & Media Storage (Object Storage + AV Scan)                               | âœ… Accepted | Server-mediated uploads; AV scan; EXIF strip; derivatives; signed URLs; private-by-default.                                                          | 2025-10-14    | [ADR-017](./ADR-017-avatar-handling-base64.md)                |
| ADR-018 | CI/CD with GitHub Actions and GHCR                                                       | âœ… Accepted | GitHub Actions with quality gates; GHCR images with SBOM/provenance; OIDC, signed releases, manual prod gate.                                        | 2025-10-14    | [ADR-018](./ADR-018-ci-cd-github-ghcr.md)                     |
| ADR-019 | Caching & Performance Strategy                                                           | âœ… Accepted | Layered caching with explicit invalidation; API p95 < 300 ms; LCP < 2.5 s; fail on >10% regression.                                                  | 2025-10-14    | [ADR-019](./ADR-019-caching-and-performance-strategy.md)      |
| ADR-020 | Accessibility Compliance (WCAG 2.1 AA) & Inclusive UX                                    | âœ… Accepted | Semantics-first components, keyboard flows, contrast, alt text; Lighthouse/axe in CI with â‰¥90 score.                                                 | 2025-10-14    | [ADR-020](./ADR-020-accessibility-compliance.md)              |
| ADR-021 | Standardize Backend Test Runner on Jest 30 + @swc/jest                                   | âœ… Accepted | Adopt _Jest 30_ with _@swc/jest_ for the backend test runner (unit + integration with Supertest), replacing ts-jest.                                 | 2025-10-14    | [ADR-021](./ADR-021-test-runner-backend-jest30-sw.md)         |

---

## Maintenance Notes

- When an ADR changes state, update both the fileâ€™s **Status Log** and this index.
- Superseded ADRs remain listed with a link to the successor.
- Add PRD/TDD section numbers in _Links_ for quick traceability.
